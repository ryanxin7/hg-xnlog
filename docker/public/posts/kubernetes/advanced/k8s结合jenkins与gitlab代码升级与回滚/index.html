<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>k8s结合Jenkins与gitlab代码升级与回滚 - Ryan&#39;s Notebook</title><meta name="author" content="Ryan">
<meta name="author-link" content="https://github.com/ryanxin7">
<meta name="description" content="k8s结合Jenkins与gitlab代码升级与回滚 一、jenkins环境准备 1.1 安装jdk17 tar -xf jdk-17.0.9_linux-x64.tar.gz -C /opt ## 配置环境变量 vim /etc/profile.d/java.sh JAVA_HOME=/opt/jdk-17.0.9 CLASSPATH=.:$JAVA_HOME/lib/jrt-fs.jar PATH=$PATH:$JAVA_HOME/bin source /etc/" /><meta name="keywords" content='Kubernetes, 持续集成' /><meta itemprop="name" content="k8s结合Jenkins与gitlab代码升级与回滚">
<meta itemprop="description" content="k8s结合Jenkins与gitlab代码升级与回滚 一、jenkins环境准备 1.1 安装jdk17 tar -xf jdk-17.0.9_linux-x64.tar.gz -C /opt ## 配置环境变量 vim /etc/profile.d/java.sh JAVA_HOME=/opt/jdk-17.0.9 CLASSPATH=.:$JAVA_HOME/lib/jrt-fs.jar PATH=$PATH:$JAVA_HOME/bin source /etc/"><meta itemprop="datePublished" content="2023-12-04T00:00:00+00:00" />
<meta itemprop="dateModified" content="2023-12-04T00:00:00+00:00" />
<meta itemprop="wordCount" content="3636"><meta itemprop="image" content="https://hg-xnlog.github.io/logo.png"/>
<meta itemprop="keywords" content="Kubernetes,持续集成," /><meta property="og:title" content="k8s结合Jenkins与gitlab代码升级与回滚" />
<meta property="og:description" content="k8s结合Jenkins与gitlab代码升级与回滚 一、jenkins环境准备 1.1 安装jdk17 tar -xf jdk-17.0.9_linux-x64.tar.gz -C /opt ## 配置环境变量 vim /etc/profile.d/java.sh JAVA_HOME=/opt/jdk-17.0.9 CLASSPATH=.:$JAVA_HOME/lib/jrt-fs.jar PATH=$PATH:$JAVA_HOME/bin source /etc/" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E7%BB%93%E5%90%88jenkins%E4%B8%8Egitlab%E4%BB%A3%E7%A0%81%E5%8D%87%E7%BA%A7%E4%B8%8E%E5%9B%9E%E6%BB%9A/" /><meta property="og:image" content="https://hg-xnlog.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-04T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-12-04T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://hg-xnlog.github.io/logo.png"/>

<meta name="twitter:title" content="k8s结合Jenkins与gitlab代码升级与回滚"/>
<meta name="twitter:description" content="k8s结合Jenkins与gitlab代码升级与回滚 一、jenkins环境准备 1.1 安装jdk17 tar -xf jdk-17.0.9_linux-x64.tar.gz -C /opt ## 配置环境变量 vim /etc/profile.d/java.sh JAVA_HOME=/opt/jdk-17.0.9 CLASSPATH=.:$JAVA_HOME/lib/jrt-fs.jar PATH=$PATH:$JAVA_HOME/bin source /etc/"/>
<meta name="application-name" content="Ryan’s Notebook">
<meta name="apple-mobile-web-app-title" content="Ryan’s Notebook"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E7%BB%93%E5%90%88jenkins%E4%B8%8Egitlab%E4%BB%A3%E7%A0%81%E5%8D%87%E7%BA%A7%E4%B8%8E%E5%9B%9E%E6%BB%9A/" /><link rel="prev" href="https://hg-xnlog.github.io/posts/notes/windows%E7%B3%BB%E7%BB%9F%E6%9F%A5%E6%89%BE%E8%AE%BF%E9%97%AE%E7%9B%AE%E7%9A%84%E7%AB%AF%E5%8F%A3%E7%9A%84%E8%BF%9B%E7%A8%8B/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "k8s结合Jenkins与gitlab代码升级与回滚",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/hg-xnlog.github.io\/posts\/kubernetes\/advanced\/k8s%E7%BB%93%E5%90%88jenkins%E4%B8%8Egitlab%E4%BB%A3%E7%A0%81%E5%8D%87%E7%BA%A7%E4%B8%8E%E5%9B%9E%E6%BB%9A\/"
    },"genre": "posts","keywords": "Kubernetes, 持续集成","wordcount":  3636 ,
    "url": "https:\/\/hg-xnlog.github.io\/posts\/kubernetes\/advanced\/k8s%E7%BB%93%E5%90%88jenkins%E4%B8%8Egitlab%E4%BB%A3%E7%A0%81%E5%8D%87%E7%BA%A7%E4%B8%8E%E5%9B%9E%E6%BB%9A\/","datePublished": "2023-12-04T00:00:00+00:00","dateModified": "2023-12-04T00:00:00+00:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "Ryan"
      },"description": ""
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="wide"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper" data-github-corner="right">
    <div class="header-title">
      <a href="/" title="Ryan&#39;s Notebook"><img loading="lazy" src="/images/pow.png" srcset="/images/pow.png, /images/pow.png 1.5x, /images/pow.png 2x" sizes="auto" data-title="Ryan&#39;s Notebook" data-alt="Ryan&#39;s Notebook" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">Ryan’s Notebook</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 所有文章</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/friends/"
                title="友情链接"
                
              ><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden="true"></i> 友链</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/about/"
                
                
              ><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden="true"></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="搜索文章标题或内容……" id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="Ryan&#39;s Notebook"><img loading="lazy" src="/images/pow.png" srcset="/images/pow.png, /images/pow.png 1.5x, /images/pow.png 2x" sizes="auto" data-title="/images/pow.png" data-alt="/images/pow.png" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">Ryan’s Notebook</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="搜索文章标题或内容……" id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              取消
            </a>
          </li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 所有文章</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/friends/"
                  title="友情链接"
                  
                ><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden="true"></i> 友链</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/about/"
                  
                  
                ><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden="true"></i> 关于</a></li><li
              class="menu-item text-center"
            ><a
                  class="menu-link"
                  href="https://github.com/ryanxin7/hg-xnlog"
                  title="GitHub"
                  rel="noopener noreferrer" target="_blank"
                ><i class='fa-brands fa-github fa-fw' aria-hidden='true'></i> </a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="切换主题"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="container"><aside class="toc" id="toc-auto"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside>

  <aside class="aside-custom">
    </aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>k8s结合Jenkins与gitlab代码升级与回滚</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><a href="https://github.com/ryanxin7" title="作者"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="/images/avatar.png" srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x" sizes="auto" data-title="Ryan" data-alt="Ryan" class="avatar" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/>&nbsp;Ryan</a></span>
          <span class="post-category">收录于 <a href="/categories/kubernetes/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> Kubernetes</a></span></div>
      <div class="post-meta-line"><span title="发布于 2023-12-04 00:00:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden="true"></i><time datetime="2023-12-04">2023-12-04</time></span>&nbsp;<span title="更新于 2023-12-04 00:00:00"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden="true"></i><time datetime="2023-12-04">2023-12-04</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>约 3636 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>预计阅读 8 分钟</span>&nbsp;<span id="busuanzi_container_page_pv" class="busuanzi_visitors comment-visitors" data-flag-title="k8s结合Jenkins与gitlab代码升级与回滚">
            <i class="fa-regular fa-eye fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_page_pv">-</span>&nbsp;次阅读
          </span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#k8s结合jenkins与gitlab代码升级与回滚">k8s结合Jenkins与gitlab代码升级与回滚</a></li>
    <li><a href="#一jenkins环境准备">一、jenkins环境准备</a>
      <ul>
        <li><a href="#11-安装jdk17">1.1 安装jdk17</a></li>
        <li><a href="#12-安装jenkins">1.2 安装jenkins</a></li>
        <li><a href="#13-初始化jenkins">1.3 初始化Jenkins</a></li>
        <li><a href="#14-创建任务测试jenkins">1.4 创建任务测试Jenkins</a></li>
        <li><a href="#15-安装jenkins-gitlab插件">1.5 安装Jenkins gitlab插件</a></li>
        <li><a href="#16-创建基于参数化构建">1.6 创建基于参数化构建</a></li>
        <li><a href="#17-创建jenkins与gitlab基于密钥免密">1.7 创建Jenkins与Gitlab基于密钥免密</a></li>
        <li><a href="#18-测试代码clone">1.8 测试代码Clone</a></li>
      </ul>
    </li>
    <li><a href="#二gitlab环境准备">二、Gitlab环境准备</a>
      <ul>
        <li><a href="#21-安装gitlib-ce">2.1 安装Gitlib CE</a></li>
        <li><a href="#22-修改gitlab-对外发布地址">2.2 修改Gitlab 对外发布地址</a></li>
        <li><a href="#23-创建项目和组">2.3 创建项目和组</a></li>
      </ul>
    </li>
    <li><a href="#三持续继承与部署">三、持续继承与部署</a>
      <ul>
        <li><a href="#31--构建jdk17-镜像">3.1  构建JDK17 镜像</a></li>
        <li><a href="#32-构建tomcat-基础业务镜像">3.2 构建tomcat 基础业务镜像</a></li>
        <li><a href="#33--准备业务自动化构建文件">3.3  准备业务自动化构建文件</a></li>
      </ul>
    </li>
    <li><a href="#34-创建任务流水线实现自动化部署">3.4 创建任务流水线实现自动化部署</a>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><h2 id="k8s结合jenkins与gitlab代码升级与回滚">k8s结合Jenkins与gitlab代码升级与回滚</h2>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231204161922579.png" srcset="https://cdn1.ryanxin.live/image-20231204161922579.png, https://cdn1.ryanxin.live/image-20231204161922579.png 1.5x, https://cdn1.ryanxin.live/image-20231204161922579.png 2x" sizes="auto" data-title="image-20231204161922579" data-alt="image-20231204161922579" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h2 id="一jenkins环境准备">一、jenkins环境准备</h2>
<h3 id="11-安装jdk17">1.1 安装jdk17</h3>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231129103240413.png" srcset="https://cdn1.ryanxin.live/image-20231129103240413.png, https://cdn1.ryanxin.live/image-20231129103240413.png 1.5x, https://cdn1.ryanxin.live/image-20231129103240413.png 2x" sizes="auto" data-title="image-20231129103240413" data-alt="image-20231129103240413" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<div class="highlight" id="id-1"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">tar -xf jdk-17.0.9_linux-x64.tar.gz -C /opt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## 配置环境变量</span>
</span></span><span class="line"><span class="cl">vim /etc/profile.d/java.sh
</span></span><span class="line"><span class="cl"><span class="nv">JAVA_HOME</span><span class="o">=</span>/opt/jdk-17.0.9
</span></span><span class="line"><span class="cl"><span class="nv">CLASSPATH</span><span class="o">=</span>.:<span class="nv">$JAVA_HOME</span>/lib/jrt-fs.jar
</span></span><span class="line"><span class="cl"><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$JAVA_HOME</span>/bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">source</span> /etc/profile.d/java.sh</span></span></code></pre></div><div class="highlight" id="id-2"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">##检查版本</span>
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9# java -version
</span></span><span class="line"><span class="cl">java version <span class="s2">&#34;17.0.9&#34;</span> 2023-10-17 LTS
</span></span><span class="line"><span class="cl">Java<span class="o">(</span>TM<span class="o">)</span> SE Runtime Environment <span class="o">(</span>build 17.0.9+11-LTS-201<span class="o">)</span>
</span></span><span class="line"><span class="cl">Java HotSpot<span class="o">(</span>TM<span class="o">)</span> 64-Bit Server VM <span class="o">(</span>build 17.0.9+11-LTS-201, mixed mode, sharing<span class="o">)</span></span></span></code></pre></div><h3 id="12-安装jenkins">1.2 安装jenkins</h3>
<p>下载：https://mirrors.tuna.tsinghua.edu.cn/jenkins/debian-stable/jenkins_2.414.3_all.deb</p>
<div class="highlight" id="id-3"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@ceamg-server:/tmp# dpkg -i jenkins_2.414.3_all.deb
</span></span><span class="line"><span class="cl">Selecting previously unselected package jenkins.
</span></span><span class="line"><span class="cl"><span class="o">(</span>Reading database ... <span class="m">75661</span> files and directories currently installed.<span class="o">)</span>
</span></span><span class="line"><span class="cl">Preparing to unpack jenkins_2.414.3_all.deb ...
</span></span><span class="line"><span class="cl">Unpacking jenkins <span class="o">(</span>2.414.3<span class="o">)</span> ...
</span></span><span class="line"><span class="cl">dpkg: dependency problems prevent configuration of jenkins:
</span></span><span class="line"><span class="cl"> jenkins depends on net-tools<span class="p">;</span> however:
</span></span><span class="line"><span class="cl">  Package net-tools is not installed.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">dpkg: error processing package jenkins <span class="o">(</span>--install<span class="o">)</span>:
</span></span><span class="line"><span class="cl"> dependency problems - leaving unconfigured
</span></span><span class="line"><span class="cl">Processing triggers <span class="k">for</span> systemd <span class="o">(</span>245.4-4ubuntu3.11<span class="o">)</span> ...
</span></span><span class="line"><span class="cl">Errors were encountered <span class="k">while</span> processing:
</span></span><span class="line"><span class="cl"> jenkins
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="c1">## 出现依赖问题</span>
</span></span><span class="line"><span class="cl">root@ceamg-server:/tmp# dpkg -r jenkins
</span></span><span class="line"><span class="cl"><span class="o">(</span>Reading database ... <span class="m">75675</span> files and directories currently installed.<span class="o">)</span>
</span></span><span class="line"><span class="cl">Removing jenkins <span class="o">(</span>2.414.3<span class="o">)</span> ...</span></span></code></pre></div><div class="highlight" id="id-4"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">## 安装依赖</span>
</span></span><span class="line"><span class="cl">root@ceamg-server:/tmp# apt install  net-tools
</span></span><span class="line"><span class="cl">Reading package lists... Done
</span></span><span class="line"><span class="cl">Building dependency tree
</span></span><span class="line"><span class="cl">Reading state information... Done
</span></span><span class="line"><span class="cl">The following NEW packages will be installed:
</span></span><span class="line"><span class="cl">  net-tools
</span></span><span class="line"><span class="cl"><span class="m">0</span> upgraded, <span class="m">1</span> newly installed, <span class="m">0</span> to remove and <span class="m">264</span> not upgraded.
</span></span><span class="line"><span class="cl">Need to get <span class="m">196</span> kB of archives.
</span></span><span class="line"><span class="cl">After this operation, <span class="m">864</span> kB of additional disk space will be used.
</span></span><span class="line"><span class="cl">Get:1 http://mirrors.tuna.tsinghua.edu.cn/ubuntu focal/main amd64 net-tools amd64 1.60+git20180626.aebd88e-1ubuntu1 <span class="o">[</span><span class="m">196</span> kB<span class="o">]</span>
</span></span><span class="line"><span class="cl">Fetched <span class="m">196</span> kB in 2s <span class="o">(</span><span class="m">121</span> kB/s<span class="o">)</span>
</span></span><span class="line"><span class="cl">Selecting previously unselected package net-tools.
</span></span><span class="line"><span class="cl"><span class="o">(</span>Reading database ... <span class="m">75664</span> files and directories currently installed.<span class="o">)</span>
</span></span><span class="line"><span class="cl">Preparing to unpack .../net-tools_1.60+git20180626.aebd88e-1ubuntu1_amd64.deb ...
</span></span><span class="line"><span class="cl">Unpacking net-tools <span class="o">(</span>1.60+git20180626.aebd88e-1ubuntu1<span class="o">)</span> ...
</span></span><span class="line"><span class="cl">Setting up net-tools <span class="o">(</span>1.60+git20180626.aebd88e-1ubuntu1<span class="o">)</span> ...
</span></span><span class="line"><span class="cl">Processing triggers <span class="k">for</span> man-db <span class="o">(</span>2.9.1-1<span class="o">)</span> ...</span></span></code></pre></div><div class="highlight" id="id-5"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">## 在Jenkins中配置java路径</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vim /lib/systemd/system/jenkins.service
</span></span><span class="line"><span class="cl"><span class="c1"># The Java home directory. When left empty, JENKINS_JAVA_CMD and PATH are consulted.</span>
</span></span><span class="line"><span class="cl"><span class="nv">Environment</span><span class="o">=</span><span class="s2">&#34;JAVA_HOME=/opt/jdk-17.0.9&#34;</span></span></span></code></pre></div><div class="highlight" id="id-6"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">## 重启Jenkins</span>
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9# systemctl restart jenkins.service
</span></span><span class="line"><span class="cl">Warning: The unit file, <span class="nb">source</span> configuration file or drop-ins of jenkins.service changed on disk. Run <span class="s1">&#39;systemctl daemon-reload&#39;</span> to reload units.
</span></span><span class="line"><span class="cl">Job <span class="k">for</span> jenkins.service failed because the control process exited with error code.
</span></span><span class="line"><span class="cl">See <span class="s2">&#34;systemctl status jenkins.service&#34;</span> and <span class="s2">&#34;journalctl -xe&#34;</span> <span class="k">for</span> details.
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9#
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9# systemctl daemon-reload
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9#
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9# systemctl restart jenkins.service
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9#
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9# systemctl status jenkins.service
</span></span><span class="line"><span class="cl">● jenkins.service - Jenkins Continuous Integration Server
</span></span><span class="line"><span class="cl">     Loaded: loaded <span class="o">(</span>/lib/systemd/system/jenkins.service<span class="p">;</span> enabled<span class="p">;</span> vendor preset: enabled<span class="o">)</span>
</span></span><span class="line"><span class="cl">    Drop-In: /etc/systemd/system/jenkins.service.d
</span></span><span class="line"><span class="cl">             └─override.conf
</span></span><span class="line"><span class="cl">     Active: active <span class="o">(</span>running<span class="o">)</span> since Fri 2023-12-01 06:03:29 UTC<span class="p">;</span> 49s ago
</span></span><span class="line"><span class="cl">   Main PID: <span class="m">1083179</span> <span class="o">(</span>java<span class="o">)</span>
</span></span><span class="line"><span class="cl">      Tasks: <span class="m">59</span> <span class="o">(</span>limit: 9447<span class="o">)</span>
</span></span><span class="line"><span class="cl">     Memory: 2.1G
</span></span><span class="line"><span class="cl">     CGroup: /system.slice/jenkins.service
</span></span><span class="line"><span class="cl">             └─1083179 /opt/jdk-17.0.9/bin/java -Djava.awt.headless<span class="o">=</span><span class="nb">true</span> -jar /usr/share/java/jenkins.war --webroot<span class="o">=</span>/var/cache/jenkins/war --httpPort<span class="o">=</span>&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Dec <span class="m">01</span> 06:03:11 ceamg-server jenkins<span class="o">[</span>1083179<span class="o">]</span>: Jenkins initial setup is required. An admin user has been created and a password generated.
</span></span><span class="line"><span class="cl">Dec <span class="m">01</span> 06:03:11 ceamg-server jenkins<span class="o">[</span>1083179<span class="o">]</span>: Please use the following password to proceed to installation:
</span></span><span class="line"><span class="cl">Dec <span class="m">01</span> 06:03:11 ceamg-server jenkins<span class="o">[</span>1083179<span class="o">]</span>: aad0ca64ee9a499cb00ea803b0563694
</span></span><span class="line"><span class="cl">Dec <span class="m">01</span> 06:03:11 ceamg-server jenkins<span class="o">[</span>1083179<span class="o">]</span>: This may also be found at: /var/lib/jenkins/secrets/initialAdminPassword
</span></span><span class="line"><span class="cl">Dec <span class="m">01</span> 06:03:11 ceamg-server jenkins<span class="o">[</span>1083179<span class="o">]</span>: *************************************************************
</span></span><span class="line"><span class="cl">Dec <span class="m">01</span> 06:03:11 ceamg-server jenkins<span class="o">[</span>1083179<span class="o">]</span>: *************************************************************
</span></span><span class="line"><span class="cl">Dec <span class="m">01</span> 06:03:11 ceamg-server jenkins<span class="o">[</span>1083179<span class="o">]</span>: *************************************************************
</span></span><span class="line"><span class="cl">Dec <span class="m">01</span> 06:03:29 ceamg-server jenkins<span class="o">[</span>1083179<span class="o">]</span>: 2023-12-01 06:03:29.569+0000 <span class="o">[</span><span class="nv">id</span><span class="o">=</span>48<span class="o">]</span>        INFO        jenkins.InitReactorRunner<span class="nv">$1</span><span class="c1">#onAttained: Complet&gt;</span>
</span></span><span class="line"><span class="cl">Dec <span class="m">01</span> 06:03:29 ceamg-server jenkins<span class="o">[</span>1083179<span class="o">]</span>: 2023-12-01 06:03:29.584+0000 <span class="o">[</span><span class="nv">id</span><span class="o">=</span>26<span class="o">]</span>        INFO        hudson.lifecycle.Lifecycle#onReady: Jenkins is &gt;
</span></span><span class="line"><span class="cl">Dec <span class="m">01</span> 06:03:29 ceamg-server systemd<span class="o">[</span>1<span class="o">]</span>: Started Jenkins Continuous Integration Server.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## 检查Jenkins服务启动情况</span>
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9#
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9# netstat -lntup
</span></span><span class="line"><span class="cl">Active Internet connections <span class="o">(</span>only servers<span class="o">)</span>
</span></span><span class="line"><span class="cl">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:41991           0.0.0.0:*               LISTEN      -
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:41643           0.0.0.0:*               LISTEN      625/rpc.mountd
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:54605           0.0.0.0:*               LISTEN      625/rpc.mountd
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:111             0.0.0.0:*               LISTEN      1/init
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.1:20180         0.0.0.0:*               LISTEN      82703/VMToolsAgentA
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.1:20181         0.0.0.0:*               LISTEN      82703/VMToolsAgentA
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.1:33397         0.0.0.0:*               LISTEN      82686/G2HProxy
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.53:53           0.0.0.0:*               LISTEN      621/systemd-resolve
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.1:20182         0.0.0.0:*               LISTEN      82686/G2HProxy
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:22              0.0.0.0:*               LISTEN      1666/sshd: /usr/sbi
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.1:6010          0.0.0.0:*               LISTEN      29129/sshd: ceamg@p
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:2049            0.0.0.0:*               LISTEN      -
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:58913           0.0.0.0:*               LISTEN      625/rpc.mountd
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> :::34469                :::*                    LISTEN      625/rpc.mountd
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> :::35597                :::*                    LISTEN      -
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> :::60909                :::*                    LISTEN      625/rpc.mountd
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> :::111                  :::*                    LISTEN      1/init
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> :::8080                 :::*                    LISTEN      1083179/java</span></span></code></pre></div><p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231201143838772.png" srcset="https://cdn1.ryanxin.live/image-20231201143838772.png, https://cdn1.ryanxin.live/image-20231201143838772.png 1.5x, https://cdn1.ryanxin.live/image-20231201143838772.png 2x" sizes="auto" data-title="image-20231201143838772" data-alt="image-20231201143838772" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<div class="highlight" id="id-7"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">## 获取管理员密码</span>
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9# cat /var/lib/jenkins/secrets/initialAdminPassword
</span></span><span class="line"><span class="cl">aad0ca64ee9a499cb00ea803b0563694</span></span></code></pre></div><h3 id="13-初始化jenkins">1.3 初始化Jenkins</h3>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231201144616862.png" srcset="https://cdn1.ryanxin.live/image-20231201144616862.png, https://cdn1.ryanxin.live/image-20231201144616862.png 1.5x, https://cdn1.ryanxin.live/image-20231201144616862.png 2x" sizes="auto" data-title="image-20231201144616862" data-alt="image-20231201144616862" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231201144709325.png" srcset="https://cdn1.ryanxin.live/image-20231201144709325.png, https://cdn1.ryanxin.live/image-20231201144709325.png 1.5x, https://cdn1.ryanxin.live/image-20231201144709325.png 2x" sizes="auto" data-title="image-20231201144709325" data-alt="image-20231201144709325" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="14-创建任务测试jenkins">1.4 创建任务测试Jenkins</h3>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231201154407514.png" srcset="https://cdn1.ryanxin.live/image-20231201154407514.png, https://cdn1.ryanxin.live/image-20231201154407514.png 1.5x, https://cdn1.ryanxin.live/image-20231201154407514.png 2x" sizes="auto" data-title="image-20231201154407514" data-alt="image-20231201154407514" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231201154614638.png" srcset="https://cdn1.ryanxin.live/image-20231201154614638.png, https://cdn1.ryanxin.live/image-20231201154614638.png 1.5x, https://cdn1.ryanxin.live/image-20231201154614638.png 2x" sizes="auto" data-title="image-20231201154614638" data-alt="image-20231201154614638" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="15-安装jenkins-gitlab插件">1.5 安装Jenkins gitlab插件</h3>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231201155058023.png" srcset="https://cdn1.ryanxin.live/image-20231201155058023.png, https://cdn1.ryanxin.live/image-20231201155058023.png 1.5x, https://cdn1.ryanxin.live/image-20231201155058023.png 2x" sizes="auto" data-title="image-20231201155058023" data-alt="image-20231201155058023" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231201155159325.png" srcset="https://cdn1.ryanxin.live/image-20231201155159325.png, https://cdn1.ryanxin.live/image-20231201155159325.png 1.5x, https://cdn1.ryanxin.live/image-20231201155159325.png 2x" sizes="auto" data-title="image-20231201155159325" data-alt="image-20231201155159325" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="16-创建基于参数化构建">1.6 创建基于参数化构建</h3>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231201161908459.png" srcset="https://cdn1.ryanxin.live/image-20231201161908459.png, https://cdn1.ryanxin.live/image-20231201161908459.png 1.5x, https://cdn1.ryanxin.live/image-20231201161908459.png 2x" sizes="auto" data-title="image-20231201161908459" data-alt="image-20231201161908459" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231201162914825.png" srcset="https://cdn1.ryanxin.live/image-20231201162914825.png, https://cdn1.ryanxin.live/image-20231201162914825.png 1.5x, https://cdn1.ryanxin.live/image-20231201162914825.png 2x" sizes="auto" data-title="image-20231201162914825" data-alt="image-20231201162914825" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231201171418209.png" srcset="https://cdn1.ryanxin.live/image-20231201171418209.png, https://cdn1.ryanxin.live/image-20231201171418209.png 1.5x, https://cdn1.ryanxin.live/image-20231201171418209.png 2x" sizes="auto" data-title="https://cdn1.ryanxin.live/image-20231201171418209.png" data-alt="https://cdn1.ryanxin.live/image-20231201171418209.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="17-创建jenkins与gitlab基于密钥免密">1.7 创建Jenkins与Gitlab基于密钥免密</h3>
<div class="highlight" id="id-8"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@ceamg-server:/data# ssh-keygen
</span></span><span class="line"><span class="cl">Generating public/private rsa key pair.
</span></span><span class="line"><span class="cl">Enter file in which to save the key <span class="o">(</span>/root/.ssh/id_rsa<span class="o">)</span>:
</span></span><span class="line"><span class="cl">Enter passphrase <span class="o">(</span>empty <span class="k">for</span> no passphrase<span class="o">)</span>:
</span></span><span class="line"><span class="cl">Enter same passphrase again:
</span></span><span class="line"><span class="cl">Your identification has been saved in /root/.ssh/id_rsa
</span></span><span class="line"><span class="cl">Your public key has been saved in /root/.ssh/id_rsa.pub
</span></span><span class="line"><span class="cl">The key fingerprint is:
</span></span><span class="line"><span class="cl">SHA256:aZCal90HsZPHoIcJj4ggYFdSDU3UJ51+shAMTOt4bVU root@ceamg-server
</span></span><span class="line"><span class="cl">The key<span class="err">&#39;</span>s randomart image is:
</span></span><span class="line"><span class="cl">+---<span class="o">[</span>RSA 3072<span class="o">]</span>----+
</span></span><span class="line"><span class="cl"><span class="p">|</span><span class="o">=</span>. oo+X<span class="o">=</span>+ + .E   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>o..... O.O X.    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  . . +.<span class="o">=</span> @.o    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     oo+.<span class="o">=</span>.* .   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>    o.ooSoo <span class="o">=</span>    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     ....  o     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>                 <span class="p">|</span>
</span></span><span class="line"><span class="cl">+----<span class="o">[</span>SHA256<span class="o">]</span>-----+
</span></span><span class="line"><span class="cl">root@ceamg-server:/data#
</span></span><span class="line"><span class="cl">root@ceamg-server:/data# cat /root/.ssh/
</span></span><span class="line"><span class="cl">authorized_keys  id_rsa           id_rsa.pub
</span></span><span class="line"><span class="cl">root@ceamg-server:/data# cat /root/.ssh/id_rsa.pub
</span></span><span class="line"><span class="cl">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDNRtj7OYSloUzmkhC/o9IohtoqKT9hhXlfM9t8VxnQZKqoCSlnZrlrpSk32Ds9JcKfpytu5x2iwPsF/Ytb8wS4dTBKc/89FyO+U1cOMxXakNBL9lYIbyxNrVs2GAWRwJyyYsfa8kOTLvkPejRm2d5HeQKLqbbTChHsubFQDHDLjz0DVNPx9J5t4Z33Dn8cSjAjMtKVLCgb810gOW0S60RMFLSSmoEzDwWG4Kv7vbOgugNDhQS3UVfOY1DU6/b8OMrWzaPLySaUXe0CjDf3sDgMU3LG2CsHaJ9eIqBwI5YQ84RanCINfbuyrlFW4Mu3FF1B2lxfZlen/O0vcfOq0sJX990/1xO136xkngWzElOEIkCpVCUqMyIj4BS0qdYu+IUw3+diKcsOC9nbJ1E3zootRiTUD6oejbAB1aSy4g0JaavfGJjpoJXLSWV09wk8Osivrf3MXme7vhzLNzF9vraiwenNUM/BAvYSVAJQyQNvksGFrLFm4U9KXG5WqpDLTP8<span class="o">=</span> root@ceamg-server</span></span></code></pre></div><p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231201163530046.png" srcset="https://cdn1.ryanxin.live/image-20231201163530046.png, https://cdn1.ryanxin.live/image-20231201163530046.png 1.5x, https://cdn1.ryanxin.live/image-20231201163530046.png 2x" sizes="auto" data-title="image-20231201163530046" data-alt="image-20231201163530046" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="18-测试代码clone">1.8 测试代码Clone</h3>
<div class="highlight" id="id-9"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@ceamg-server:/opt# git clone  http://10.1.0.140/xxteam/xinn.git
</span></span><span class="line"><span class="cl">Cloning into <span class="s1">&#39;xinn&#39;</span>...
</span></span><span class="line"><span class="cl">Username <span class="k">for</span> <span class="s1">&#39;http://10.1.0.140&#39;</span>: xin1
</span></span><span class="line"><span class="cl">Password <span class="k">for</span> <span class="s1">&#39;http://xin1@10.1.0.140&#39;</span>:
</span></span><span class="line"><span class="cl">remote: Enumerating objects: 6, <span class="k">done</span>.
</span></span><span class="line"><span class="cl">remote: Counting objects: 100% <span class="o">(</span>6/6<span class="o">)</span>, <span class="k">done</span>.
</span></span><span class="line"><span class="cl">remote: Compressing objects: 100% <span class="o">(</span>4/4<span class="o">)</span>, <span class="k">done</span>.
</span></span><span class="line"><span class="cl">remote: Total <span class="m">6</span> <span class="o">(</span>delta 0<span class="o">)</span>, reused <span class="m">0</span> <span class="o">(</span>delta 0<span class="o">)</span>, pack-reused <span class="m">0</span>
</span></span><span class="line"><span class="cl">Unpacking objects: 100% <span class="o">(</span>6/6<span class="o">)</span>, 3.03 KiB <span class="p">|</span> 57.00 KiB/s, <span class="k">done</span>.</span></span></code></pre></div><div class="highlight" id="id-10"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@ceamg-server:/opt# rm -rf xinn/
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt#
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt# git clone git@10.1.0.140:xxteam/xinn.git
</span></span><span class="line"><span class="cl">Cloning into <span class="s1">&#39;xinn&#39;</span>...
</span></span><span class="line"><span class="cl">The authenticity of host <span class="s1">&#39;10.1.0.140 (10.1.0.140)&#39;</span> can<span class="s1">&#39;t be established.
</span></span></span><span class="line"><span class="cl"><span class="s1">ECDSA key fingerprint is SHA256:lhRjKQBhgEhjbqcfKBb6oyle8C9EIOzu48QUoaeISIE.
</span></span></span><span class="line"><span class="cl"><span class="s1">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span></span></span><span class="line"><span class="cl"><span class="s1">Warning: Permanently added &#39;</span>10.1.0.140<span class="s1">&#39; (ECDSA) to the list of known hosts.
</span></span></span><span class="line"><span class="cl"><span class="s1">remote: Enumerating objects: 6, done.
</span></span></span><span class="line"><span class="cl"><span class="s1">remote: Counting objects: 100% (6/6), done.
</span></span></span><span class="line"><span class="cl"><span class="s1">remote: Compressing objects: 100% (4/4), done.
</span></span></span><span class="line"><span class="cl"><span class="s1">remote: Total 6 (delta 0), reused 0 (delta 0), pack-reused 0
</span></span></span><span class="line"><span class="cl"><span class="s1">Receiving objects: 100% (6/6), done.
</span></span></span><span class="line"><span class="cl"><span class="s1">root@ceamg-server:/opt#
</span></span></span><span class="line"><span class="cl"><span class="s1">root@ceamg-server:/opt# rm -rf xinn/
</span></span></span><span class="line"><span class="cl"><span class="s1">root@ceamg-server:/opt#
</span></span></span><span class="line"><span class="cl"><span class="s1">root@ceamg-server:/opt# git clone git@10.1.0.140:xxteam/xinn.git
</span></span></span><span class="line"><span class="cl"><span class="s1">Cloning into &#39;</span>xinn<span class="err">&#39;</span>...
</span></span><span class="line"><span class="cl">remote: Enumerating objects: 6, <span class="k">done</span>.
</span></span><span class="line"><span class="cl">remote: Counting objects: 100% <span class="o">(</span>6/6<span class="o">)</span>, <span class="k">done</span>.
</span></span><span class="line"><span class="cl">remote: Compressing objects: 100% <span class="o">(</span>4/4<span class="o">)</span>, <span class="k">done</span>.
</span></span><span class="line"><span class="cl">remote: Total <span class="m">6</span> <span class="o">(</span>delta 0<span class="o">)</span>, reused <span class="m">0</span> <span class="o">(</span>delta 0<span class="o">)</span>, pack-reused <span class="m">0</span>
</span></span><span class="line"><span class="cl">Receiving objects: 100% <span class="o">(</span>6/6<span class="o">)</span>, <span class="k">done</span>.</span></span></code></pre></div><h2 id="二gitlab环境准备">二、Gitlab环境准备</h2>
<h3 id="21-安装gitlib-ce">2.1 安装Gitlib CE</h3>
<p>下载:https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu/pool/focal/main/g/gitlab-ce/gitlab-ce_16.5.2-ce.0_amd64.deb</p>
<div class="highlight" id="id-11"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@ceamg-server:~# dpkg -i /tmp/gitlab-ce_16.5.2-ce.0_amd64.deb
</span></span><span class="line"><span class="cl">Selecting previously unselected package gitlab-ce.
</span></span><span class="line"><span class="cl"><span class="o">(</span>Reading database ... <span class="m">75661</span> files and directories currently installed.<span class="o">)</span>
</span></span><span class="line"><span class="cl">Preparing to unpack .../gitlab-ce_16.5.2-ce.0_amd64.deb ...
</span></span><span class="line"><span class="cl">Unpacking gitlab-ce <span class="o">(</span>16.5.2-ce.0<span class="o">)</span> ...
</span></span><span class="line"><span class="cl">Setting up gitlab-ce <span class="o">(</span>16.5.2-ce.0<span class="o">)</span> ...
</span></span><span class="line"><span class="cl">It looks like GitLab has not been configured yet<span class="p">;</span> skipping the upgrade script.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       *.                  *.
</span></span><span class="line"><span class="cl">      ***                 ***
</span></span><span class="line"><span class="cl">     *****               *****
</span></span><span class="line"><span class="cl">    .******             *******
</span></span><span class="line"><span class="cl">    ********            ********
</span></span><span class="line"><span class="cl">   ,,,,,,,,,***********,,,,,,,,,
</span></span><span class="line"><span class="cl">  ,,,,,,,,,,,*********,,,,,,,,,,,
</span></span><span class="line"><span class="cl">  .,,,,,,,,,,,*******,,,,,,,,,,,,
</span></span><span class="line"><span class="cl">      ,,,,,,,,,*****,,,,,,,,,.
</span></span><span class="line"><span class="cl">         ,,,,,,,****,,,,,,
</span></span><span class="line"><span class="cl">            .,,,***,,,,
</span></span><span class="line"><span class="cl">                ,*,.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     _______ __  __          __
</span></span><span class="line"><span class="cl">    / ____<span class="o">(</span>_<span class="o">)</span> /_/ /   ____ _/ /_
</span></span><span class="line"><span class="cl">   / / __/ / __/ /   / __ <span class="sb">`</span>/ __ <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  / /_/ / / /_/ /___/ /_/ / /_/ /
</span></span><span class="line"><span class="cl">  <span class="se">\_</span>___/_/<span class="se">\_</span>_/_____/<span class="se">\_</span>_,_/_.___/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Thank you <span class="k">for</span> installing GitLab!
</span></span><span class="line"><span class="cl">GitLab was unable to detect a valid hostname <span class="k">for</span> your instance.
</span></span><span class="line"><span class="cl">Please configure a URL <span class="k">for</span> your GitLab instance by setting <span class="sb">`</span>external_url<span class="sb">`</span>
</span></span><span class="line"><span class="cl">configuration in /etc/gitlab/gitlab.rb file.
</span></span><span class="line"><span class="cl">Then, you can start your GitLab instance by running the following command:
</span></span><span class="line"><span class="cl">  sudo gitlab-ctl reconfigure
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">For a comprehensive list of configuration options please see the Omnibus GitLab readme
</span></span><span class="line"><span class="cl">https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/README.md
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Help us improve the installation experience, <span class="nb">let</span> us know how we did with a <span class="m">1</span> minute survey:
</span></span><span class="line"><span class="cl">https://gitlab.fra1.qualtrics.com/jfe/form/SV_6kVqZANThUQ1bZb?installation<span class="o">=</span>omnibus<span class="p">&amp;</span><span class="nv">release</span><span class="o">=</span>16-5</span></span></code></pre></div><h3 id="22-修改gitlab-对外发布地址">2.2 修改Gitlab 对外发布地址</h3>
<div class="highlight" id="id-12"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">vim /etc/gitlab/gitlab.rb
</span></span><span class="line"><span class="cl">external_url <span class="s1">&#39;http://10.1.0.140&#39;</span></span></span></code></pre></div><div class="highlight" id="id-13"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">##更新配置</span>
</span></span><span class="line"><span class="cl">gitlab-ctl reconfigure</span></span></code></pre></div><div class="highlight" id="id-14"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">## 获取root密码</span>
</span></span><span class="line"><span class="cl">root@gitlab:~# cat /etc/gitlab/initial_root_password
</span></span><span class="line"><span class="cl"><span class="c1"># WARNING: This value is valid only in the following conditions</span>
</span></span><span class="line"><span class="cl"><span class="c1">#          1. If provided manually (either via `GITLAB_ROOT_PASSWORD` environment variable or via `gitlab_rails[&#39;initial_root_password&#39;]` setting in `gitlab.rb`, it was provided before database was seeded for the first time (usually, the first reconfigure run).</span>
</span></span><span class="line"><span class="cl"><span class="c1">#          2. Password hasn&#39;t been changed manually, either via UI or via command line.</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1">#          If the password shown here doesn&#39;t work, you must reset the admin password following https://docs.gitlab.com/ee/security/reset_user_password.html#reset-your-root-password.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Password: I5qRTkn+LrdefGIo43ifT0cBHQUuEAHoJDuZuaS4CG8<span class="o">=</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># NOTE: This file will be automatically deleted in the first reconfigure run after 24 hours.</span></span></span></code></pre></div><p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231201155418428.png" srcset="https://cdn1.ryanxin.live/image-20231201155418428.png, https://cdn1.ryanxin.live/image-20231201155418428.png 1.5x, https://cdn1.ryanxin.live/image-20231201155418428.png 2x" sizes="auto" data-title="image-20231201155418428" data-alt="image-20231201155418428" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="23-创建项目和组">2.3 创建项目和组</h3>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231201155619418.png" srcset="https://cdn1.ryanxin.live/image-20231201155619418.png, https://cdn1.ryanxin.live/image-20231201155619418.png 1.5x, https://cdn1.ryanxin.live/image-20231201155619418.png 2x" sizes="auto" data-title="image-20231201155619418" data-alt="image-20231201155619418" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231201155704811.png" srcset="https://cdn1.ryanxin.live/image-20231201155704811.png, https://cdn1.ryanxin.live/image-20231201155704811.png 1.5x, https://cdn1.ryanxin.live/image-20231201155704811.png 2x" sizes="auto" data-title="image-20231201155704811" data-alt="image-20231201155704811" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231201155912403.png" srcset="https://cdn1.ryanxin.live/image-20231201155912403.png, https://cdn1.ryanxin.live/image-20231201155912403.png 1.5x, https://cdn1.ryanxin.live/image-20231201155912403.png 2x" sizes="auto" data-title="image-20231201155912403" data-alt="image-20231201155912403" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231201160625876.png" srcset="https://cdn1.ryanxin.live/image-20231201160625876.png, https://cdn1.ryanxin.live/image-20231201160625876.png 1.5x, https://cdn1.ryanxin.live/image-20231201160625876.png 2x" sizes="auto" data-title="image-20231201160625876" data-alt="image-20231201160625876" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231201160735931.png" srcset="https://cdn1.ryanxin.live/image-20231201160735931.png, https://cdn1.ryanxin.live/image-20231201160735931.png 1.5x, https://cdn1.ryanxin.live/image-20231201160735931.png 2x" sizes="auto" data-title="image-20231201160735931" data-alt="image-20231201160735931" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231201163209885.png" srcset="https://cdn1.ryanxin.live/image-20231201163209885.png, https://cdn1.ryanxin.live/image-20231201163209885.png 1.5x, https://cdn1.ryanxin.live/image-20231201163209885.png 2x" sizes="auto" data-title="image-20231201163209885" data-alt="image-20231201163209885" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<!-- raw HTML omitted -->
<h2 id="三持续继承与部署">三、持续继承与部署</h2>
<h3 id="31--构建jdk17-镜像">3.1  构建JDK17 镜像</h3>
<h4 id="311-下载jdk17程序包">3.1.1 下载JDK17程序包</h4>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231129103240413.png" srcset="https://cdn1.ryanxin.live/image-20231129103240413.png, https://cdn1.ryanxin.live/image-20231129103240413.png 1.5x, https://cdn1.ryanxin.live/image-20231129103240413.png 2x" sizes="auto" data-title="https://cdn1.ryanxin.live/image-20231129103240413.png" data-alt="https://cdn1.ryanxin.live/image-20231129103240413.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h4 id="312-准备dockerfile文件">3.1.2 准备Dockerfile文件</h4>
<div class="highlight" id="id-15"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> ubuntu:latest</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">MAINTAINER</span><span class="s"> xinn.cc</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /usr/local/java17</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ADD</span> ./jdk-17.0.9_linux-x64.tar.gz  /usr/local/java17/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/local/java17/jdk-17.0.9<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">CLASSPATH</span><span class="o">=</span>.:<span class="nv">$JAVA_HOME</span>/lib/jrt-fs.jar<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$JAVA_HOME</span>/bin</span></span></code></pre></div><h4 id="313-准备构建脚本">3.1.3 准备构建脚本</h4>
<div class="highlight" id="id-16"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nv">TAG</span><span class="o">=</span><span class="nv">$1</span>
</span></span><span class="line"><span class="cl">docker  build -t harbor.ceamg.com/baseimages/jdk17_0.9:<span class="si">${</span><span class="nv">TAG</span><span class="si">}</span> .
</span></span><span class="line"><span class="cl">docker push harbor.ceamg.com/baseimages/jdk17_0.9:<span class="si">${</span><span class="nv">TAG</span><span class="si">}</span></span></span></code></pre></div><h4 id="314-制作镜像">3.1.4 制作镜像</h4>
<div class="highlight" id="id-17"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@harbor01<span class="o">[</span>11:10:31<span class="o">]</span>/dockerfile/jdk-17.0.9 <span class="c1">#:ls</span>
</span></span><span class="line"><span class="cl">build_image_command.sh  Dockerfile  jdk-17.0.9_linux-x64.tar.gz
</span></span><span class="line"><span class="cl">root@harbor01<span class="o">[</span>11:10:33<span class="o">]</span>/dockerfile/jdk-17.0.9 <span class="c1">#:</span>
</span></span><span class="line"><span class="cl">root@harbor01<span class="o">[</span>11:10:33<span class="o">]</span>/dockerfile/jdk-17.0.9 <span class="c1">#:sh build_image_command.sh x1</span>
</span></span><span class="line"><span class="cl">DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
</span></span><span class="line"><span class="cl">            Install the buildx component to build images with BuildKit:
</span></span><span class="line"><span class="cl">            https://docs.docker.com/go/buildx/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Sending build context to Docker daemon  182.5MB
</span></span><span class="line"><span class="cl">Step 1/7 : FROM ubuntu:latest
</span></span><span class="line"><span class="cl"> ---&gt; 6b7dfa7e8fdb
</span></span><span class="line"><span class="cl">Step 2/7 : MAINTAINER xinn.cc
</span></span><span class="line"><span class="cl"> ---&gt; Running in 3aed1c94bf06
</span></span><span class="line"><span class="cl">Removing intermediate container 3aed1c94bf06
</span></span><span class="line"><span class="cl"> ---&gt; 4d15526cf2a0
</span></span><span class="line"><span class="cl">Step 3/7 : WORKDIR /usr/local/java17
</span></span><span class="line"><span class="cl"> ---&gt; Running in a86d42bd6a1a
</span></span><span class="line"><span class="cl">Removing intermediate container a86d42bd6a1a
</span></span><span class="line"><span class="cl"> ---&gt; d7c03d0d10cd
</span></span><span class="line"><span class="cl">Step 4/7 : ADD ./jdk-17.0.9_linux-x64.tar.gz  /usr/local/java17/
</span></span><span class="line"><span class="cl"> ---&gt; 881b04611e31
</span></span><span class="line"><span class="cl">Step 5/7 : ENV <span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/local/java/jdk-17.0.9
</span></span><span class="line"><span class="cl"> ---&gt; Running in 6703b928fb0d
</span></span><span class="line"><span class="cl">Removing intermediate container 6703b928fb0d
</span></span><span class="line"><span class="cl"> ---&gt; dbb88d39fcb0
</span></span><span class="line"><span class="cl">Step 6/7 : ENV <span class="nv">CLASSPATH</span><span class="o">=</span>.:<span class="nv">$JAVA_HOME</span>/lib/jrt-fs.jar
</span></span><span class="line"><span class="cl"> ---&gt; Running in 2ee6e6746a43
</span></span><span class="line"><span class="cl">Removing intermediate container 2ee6e6746a43
</span></span><span class="line"><span class="cl"> ---&gt; a89b458baee1
</span></span><span class="line"><span class="cl">Step 7/7 : ENV <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$JAVA_HOME</span>/bin
</span></span><span class="line"><span class="cl"> ---&gt; Running in 6feaa6d5e20c
</span></span><span class="line"><span class="cl">Removing intermediate container 6feaa6d5e20c
</span></span><span class="line"><span class="cl"> ---&gt; 13b6bed2c720
</span></span><span class="line"><span class="cl">Successfully built 13b6bed2c720
</span></span><span class="line"><span class="cl">Successfully tagged harbor.ceamg.com/baseimages/jdk17_0.9:x1
</span></span><span class="line"><span class="cl">The push refers to repository <span class="o">[</span>harbor.ceamg.com/baseimages/jdk17_0.9<span class="o">]</span>
</span></span><span class="line"><span class="cl">c807951d4c31: Pushed
</span></span><span class="line"><span class="cl">b524ae647412: Pushed
</span></span><span class="line"><span class="cl">6515074984c6: Mounted from baseimages/ubuntu
</span></span><span class="line"><span class="cl">x1: digest: sha256:e43e2bf6ff777ea917f274f26abcc060a369be765ecba6be46e4aa89ff7a17ad size: <span class="m">949</span></span></span></code></pre></div><h4 id="314-测试镜像">3.1.4 测试镜像</h4>
<div class="highlight" id="id-18"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">##临时运行容器</span>
</span></span><span class="line"><span class="cl">docker run -it harbor.ceamg.com/baseimages/jdk17_0.9:x1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">##进入容器查看java版本</span>
</span></span><span class="line"><span class="cl">root@17b96c96a4aa:/usr/local/java17# java -version
</span></span><span class="line"><span class="cl">java version <span class="s2">&#34;17.0.9&#34;</span> 2023-10-17 LTS
</span></span><span class="line"><span class="cl">Java<span class="o">(</span>TM<span class="o">)</span> SE Runtime Environment <span class="o">(</span>build 17.0.9+11-LTS-201<span class="o">)</span>
</span></span><span class="line"><span class="cl">Java HotSpot<span class="o">(</span>TM<span class="o">)</span> 64-Bit Server VM <span class="o">(</span>build 17.0.9+11-LTS-201, mixed mode, sharing<span class="o">)</span></span></span></code></pre></div><h3 id="32-构建tomcat-基础业务镜像">3.2 构建tomcat 基础业务镜像</h3>
<h4 id="321-下载tomcat程序包">3.2.1 下载Tomcat程序包</h4>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231204165359159.png" srcset="https://cdn1.ryanxin.live/image-20231204165359159.png, https://cdn1.ryanxin.live/image-20231204165359159.png 1.5x, https://cdn1.ryanxin.live/image-20231204165359159.png 2x" sizes="auto" data-title="image-20231204165359159" data-alt="image-20231204165359159" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h4 id="322-准备dockerfile文件">3.2.2 准备Dockerfile文件</h4>
<div class="highlight" id="id-19"><pre tabindex="0" class="chroma"><code class="language-docker" data-lang="docker"><span class="line"><span class="cl"><span class="c"># Use a base image with Java 17 and Tomcat</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> harbor.ceamg.com/baseimages/jdk17_0.9:x1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Tomcat version to be installed</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> TOMCAT_VERSION 10.1.16<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> ./apache-tomcat-10.1.16.tar.gz /tmp/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># 在容器中解压缩Tomcat文件</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> tar -xf /tmp/apache-tomcat-<span class="si">${</span><span class="nv">TOMCAT_VERSION</span><span class="si">}</span>.tar.gz -C /opt/ <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    mv /opt/apache-tomcat-<span class="si">${</span><span class="nv">TOMCAT_VERSION</span><span class="si">}</span> /opt/tomcat <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    rm apache-tomcat-<span class="si">${</span><span class="nv">TOMCAT_VERSION</span><span class="si">}</span>.tar.gz<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set environment variables</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> CATALINA_HOME /opt/tomcat<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> PATH <span class="nv">$CATALINA_HOME</span>/bin:<span class="nv">$PATH</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> ./index.html /<span class="nv">$CATALINA_HOME</span>/webapps/ROOT<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose the port that Tomcat runs on</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 8080</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set the working directory inside the container</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> $CATALINA_HOME</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Start Tomcat</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;catalina.sh&#34;</span><span class="p">,</span> <span class="s2">&#34;run&#34;</span><span class="p">]</span></span></span></code></pre></div><h4 id="323-制作镜像">3.2.3 制作镜像</h4>
<div class="highlight" id="id-20"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@harbor01<span class="o">[</span>14:40:49<span class="o">]</span>/dockerfile/tomcat17 <span class="c1">#:sh build_image_command.sh x1</span>
</span></span><span class="line"><span class="cl">DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
</span></span><span class="line"><span class="cl">            Install the buildx component to build images with BuildKit:
</span></span><span class="line"><span class="cl">            https://docs.docker.com/go/buildx/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Sending build context to Docker daemon  12.49MB
</span></span><span class="line"><span class="cl">Step 1/10 : FROM harbor.ceamg.com/baseimages/jdk17_0.9:x1
</span></span><span class="line"><span class="cl"> ---&gt; 2831b54b6401
</span></span><span class="line"><span class="cl">Step 2/10 : ENV TOMCAT_VERSION 10.1.16
</span></span><span class="line"><span class="cl"> ---&gt; Using cache
</span></span><span class="line"><span class="cl"> ---&gt; b08960efe9a8
</span></span><span class="line"><span class="cl">Step 3/10 : COPY ./apache-tomcat-10.1.16.tar.gz /tmp/
</span></span><span class="line"><span class="cl"> ---&gt; Using cache
</span></span><span class="line"><span class="cl"> ---&gt; 7d3ddba62f34
</span></span><span class="line"><span class="cl">Step 4/10 : RUN tar -xf /tmp/apache-tomcat-<span class="si">${</span><span class="nv">TOMCAT_VERSION</span><span class="si">}</span>.tar.gz -C /opt/ <span class="o">&amp;&amp;</span>     mv /opt/apache-tomcat-<span class="si">${</span><span class="nv">TOMCAT_VERSION</span><span class="si">}</span> /opt/tomcat <span class="o">&amp;&amp;</span>     rm -rf /tmp/apache-tomcat-<span class="si">${</span><span class="nv">TOMCAT_VERSION</span><span class="si">}</span>.tar.gz
</span></span><span class="line"><span class="cl"> ---&gt; Running in ab9db765a511
</span></span><span class="line"><span class="cl">Removing intermediate container ab9db765a511
</span></span><span class="line"><span class="cl"> ---&gt; be00e79b1f2d
</span></span><span class="line"><span class="cl">Step 5/10 : ENV CATALINA_HOME /opt/tomcat
</span></span><span class="line"><span class="cl"> ---&gt; Running in 8428bb9c55e7
</span></span><span class="line"><span class="cl">Removing intermediate container 8428bb9c55e7
</span></span><span class="line"><span class="cl"> ---&gt; 75ee07ece0e3
</span></span><span class="line"><span class="cl">Step 6/10 : ENV PATH <span class="nv">$CATALINA_HOME</span>/bin:<span class="nv">$PATH</span>
</span></span><span class="line"><span class="cl"> ---&gt; Running in fbe785a46542
</span></span><span class="line"><span class="cl">Removing intermediate container fbe785a46542
</span></span><span class="line"><span class="cl"> ---&gt; c9b94571fb95
</span></span><span class="line"><span class="cl">Step 7/10 : COPY ./index.html /<span class="nv">$CATALINA_HOME</span>/webapps/
</span></span><span class="line"><span class="cl"> ---&gt; 4c1b4b949844
</span></span><span class="line"><span class="cl">Step 8/10 : EXPOSE <span class="m">8080</span>
</span></span><span class="line"><span class="cl"> ---&gt; Running in c66aafe5856d
</span></span><span class="line"><span class="cl">Removing intermediate container c66aafe5856d
</span></span><span class="line"><span class="cl"> ---&gt; 466e08e303eb
</span></span><span class="line"><span class="cl">Step 9/10 : WORKDIR <span class="nv">$CATALINA_HOME</span>
</span></span><span class="line"><span class="cl"> ---&gt; Running in 2a6b3b867c19
</span></span><span class="line"><span class="cl">Removing intermediate container 2a6b3b867c19
</span></span><span class="line"><span class="cl"> ---&gt; 79cf969913dc
</span></span><span class="line"><span class="cl">Step 10/10 : CMD <span class="o">[</span><span class="s2">&#34;catalina.sh&#34;</span>, <span class="s2">&#34;run&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"> ---&gt; Running in d465b3338a80
</span></span><span class="line"><span class="cl">Removing intermediate container d465b3338a80
</span></span><span class="line"><span class="cl"> ---&gt; 3b7659ab3a5c
</span></span><span class="line"><span class="cl">Successfully built 3b7659ab3a5c
</span></span><span class="line"><span class="cl">Successfully tagged harbor.ceamg.com/baseimages/webapp-tomcat:x1
</span></span><span class="line"><span class="cl">The push refers to repository <span class="o">[</span>harbor.ceamg.com/baseimages/webapp-tomcat<span class="o">]</span>
</span></span><span class="line"><span class="cl">83f5ae443ab3: Pushed
</span></span><span class="line"><span class="cl">ead28053bfb3: Pushed
</span></span><span class="line"><span class="cl">a256fbd2326d: Pushed
</span></span><span class="line"><span class="cl">c807951d4c31: Mounted from baseimages/jdk17_0.9
</span></span><span class="line"><span class="cl">b524ae647412: Mounted from baseimages/jdk17_0.9
</span></span><span class="line"><span class="cl">6515074984c6: Mounted from baseimages/jdk17_0.9
</span></span><span class="line"><span class="cl">x1: digest: sha256:c0fae36668191a3950f37e6a54dbacb090b5ccddaef16e8c74083df9c534c4ac size: <span class="m">1580</span></span></span></code></pre></div><h4 id="324-测试业务镜像">3.2.4 测试业务镜像</h4>
<div class="highlight" id="id-21"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">## 测试运行tomcat镜像</span>
</span></span><span class="line"><span class="cl">docker run --rm -d -p 8080:8080 harbor.ceamg.com/baseimages/webapp-tomcat:x1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">##停止并删除这个临时运行的容器</span>
</span></span><span class="line"><span class="cl">docker stop 593673c9d
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">##进入容器</span>
</span></span><span class="line"><span class="cl">docker <span class="nb">exec</span> -it 593673c9d bash</span></span></code></pre></div><h3 id="33--准备业务自动化构建文件">3.3  准备业务自动化构建文件</h3>
<h4 id="331-创建服务文件目录">3.3.1 创建服务文件目录</h4>
<div class="highlight" id="id-22"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir /opt/k8s-data/yaml/ -r
</span></span><span class="line"><span class="cl">mkdir /opt/k8s-data/dockerfile/xinn -r</span></span></code></pre></div><h4 id="332-创建tomcat-业务deployment文件">3.3.2 创建Tomcat 业务deployment文件</h4>
<div class="highlight" id="id-23"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">vim /opt/k8s-data/yaml/xinn-web1.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">xinn-web1-deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">xinn</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">xinn-web1-tomcat</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">xinn-web1-tomcat</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">xinn-web1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">harbor.ceamg.com/baseimages/webapp-tomcat:x1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">xinn-web1-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">xinn</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">xinn-web1-tomcat</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="m">9988</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">NodePort</span></span></span></code></pre></div><h4 id="333-创建jenkins自动化构建脚本">3.3.3 创建Jenkins自动化构建脚本</h4>
<div class="highlight" id="id-24"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">#Author: ZhangShiJie</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Date: 2019-08-03</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Version: v1</span>
</span></span><span class="line"><span class="cl"><span class="c1">#记录脚本开始执行时间</span>
</span></span><span class="line"><span class="cl"><span class="nv">starttime</span><span class="o">=</span><span class="k">$(</span>date +<span class="s1">&#39;%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#变量</span>
</span></span><span class="line"><span class="cl"><span class="nv">SHELL_DIR</span><span class="o">=</span><span class="s2">&#34;/root/scripts&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">SHELL_NAME</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$0</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">K8S_CONTROLLER1</span><span class="o">=</span><span class="s2">&#34;10.1.0.32&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">K8S_CONTROLLER2</span><span class="o">=</span><span class="s2">&#34;10.1.0.33&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">DATE</span><span class="o">=</span><span class="k">$(</span>date +%Y-%m-%d_%H_%M_%S<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">METHOD</span><span class="o">=</span><span class="nv">$1</span>
</span></span><span class="line"><span class="cl"><span class="nv">Branch</span><span class="o">=</span><span class="nv">$2</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nb">test</span> -z <span class="nv">$Branch</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nv">Branch</span><span class="o">=</span>develop
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> Code_Clone<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">Git_URL</span><span class="o">=</span><span class="s2">&#34;git@10.1.0.140:xxteam/xinn.git&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">DIR_NAME</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="si">${</span><span class="nv">Git_URL</span><span class="si">}</span> <span class="p">|</span> awk -F <span class="s2">&#34;/&#34;</span> <span class="s1">&#39;{print $2}&#39;</span> <span class="p">|</span> awk -F <span class="s2">&#34;.&#34;</span> <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">DATA_DIR</span><span class="o">=</span><span class="s2">&#34;/data/gitdata/&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">Git_Dir</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">DATA_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">DIR_NAME</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">cd</span> <span class="si">${</span><span class="nv">DATA_DIR</span><span class="si">}</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;即将清空上一版本代码并获取当前分支最新代码&#34;</span> <span class="o">&amp;&amp;</span> sleep <span class="m">1</span> <span class="o">&amp;&amp;</span> rm -rf <span class="si">${</span><span class="nv">DIR_NAME</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;即将开始从分支</span><span class="si">${</span><span class="nv">Branch</span><span class="si">}</span><span class="s2"> 获取代码&#34;</span> <span class="o">&amp;&amp;</span> sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">    git clone -b <span class="si">${</span><span class="nv">Branch</span><span class="si">}</span> <span class="si">${</span><span class="nv">Git_URL</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;分支</span><span class="si">${</span><span class="nv">Branch</span><span class="si">}</span><span class="s2"> 克隆完成，即将进行代码编译!&#34;</span> <span class="o">&amp;&amp;</span> sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#cd ${Git_Dir} &amp;&amp; mvn clean package</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#echo &#34;代码编译完成，即将开始将IP地址等信息替换为测试环境&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#####################################################</span>
</span></span><span class="line"><span class="cl">    sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">    <span class="nb">cd</span> <span class="si">${</span><span class="nv">Git_Dir</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">    tar czf <span class="si">${</span><span class="nv">DIR_NAME</span><span class="si">}</span>.tar.gz ./*
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#将打包好的压缩文件拷贝到k8s 控制端服务器</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> Copy_File<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;压缩文件打包完成，即将拷贝到k8s 控制端服务器</span><span class="si">${</span><span class="nv">K8S_CONTROLLER1</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">&amp;&amp;</span> sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">    scp <span class="si">${</span><span class="nv">Git_Dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">DIR_NAME</span><span class="si">}</span>.tar.gz root@<span class="si">${</span><span class="nv">K8S_CONTROLLER1</span><span class="si">}</span>:/opt/k8s-data/dockerfile/xinn
</span></span><span class="line"><span class="cl">    ssh root@<span class="si">${</span><span class="nv">K8S_CONTROLLER1</span><span class="si">}</span> <span class="s2">&#34;cd /opt/k8s-data/dockerfile/xinn &amp;&amp; tar xf </span><span class="si">${</span><span class="nv">DIR_NAME</span><span class="si">}</span><span class="s2">.tar.gz ./&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;压缩文件拷贝完成,服务器</span><span class="si">${</span><span class="nv">K8S_CONTROLLER1</span><span class="si">}</span><span class="s2">即将开始制作Docker 镜像!&#34;</span> <span class="o">&amp;&amp;</span> sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#到控制端执行脚本制作并上传镜像</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> Make_Image<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;开始制作Docker镜像并上传到Harbor服务器&#34;</span> <span class="o">&amp;&amp;</span> sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">    ssh root@<span class="si">${</span><span class="nv">K8S_CONTROLLER1</span><span class="si">}</span> <span class="s2">&#34;cd /opt/k8s-data/dockerfile/xinn &amp;&amp; bash build-command.sh </span><span class="si">${</span><span class="nv">DATE</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;Docker镜像制作完成并已经上传到harbor服务器&#34;</span> <span class="o">&amp;&amp;</span> sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#到控制端更新k8s yaml文件中的镜像版本号,从而保持yaml文件中的镜像版本号和k8s中版本号一致</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> Update_k8s_yaml<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;即将更新k8s yaml文件中镜像版本&#34;</span> <span class="o">&amp;&amp;</span> sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">    ssh root@<span class="si">${</span><span class="nv">K8S_CONTROLLER1</span><span class="si">}</span> <span class="s2">&#34;cd /opt/k8s-data/yaml &amp;&amp; sed -i &#39;s/image: harbor.ceamg.*/image: harbor.ceamg.com\/baseimages\/xinn-web1:</span><span class="si">${</span><span class="nv">DATE</span><span class="si">}</span><span class="s2">/g&#39; xinn-web1.yaml&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;k8s yaml文件镜像版本更新完成,即将开始更新容器中镜像版本&#34;</span> <span class="o">&amp;&amp;</span> sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#到控制端更新k8s中容器的版本号,有两种更新办法，一是指定镜像版本更新，二是apply执行修改过的yaml文件</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> Update_k8s_container<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#第一种方法</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#ssh root@${K8S_CONTROLLER1} &#34;kubectl set image deployment/linux36-nginx-deployment linux36-nginx-container=harbor.magedu.net/linux36/nginx-web1:${DATE} -n linux36&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#第二种方法,推荐使用第一种</span>
</span></span><span class="line"><span class="cl">    ssh root@<span class="si">${</span><span class="nv">K8S_CONTROLLER1</span><span class="si">}</span> <span class="s2">&#34;cd /opt/k8s-data/yaml &amp;&amp; kubectl apply -f xinn-web1.yaml --record&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;k8s 镜像更新完成&#34;</span> <span class="o">&amp;&amp;</span> sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;当前业务镜像版本: harbor.ceamg.com/baseimages/xinn-web1:</span><span class="si">${</span><span class="nv">DATE</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#计算脚本累计执行时间，如果不需要的话可以去掉下面四行</span>
</span></span><span class="line"><span class="cl">    <span class="nv">endtime</span><span class="o">=</span><span class="k">$(</span>date +<span class="s1">&#39;%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">start_seconds</span><span class="o">=</span><span class="k">$(</span>date --date<span class="o">=</span><span class="s2">&#34;</span><span class="nv">$starttime</span><span class="s2">&#34;</span> +%s<span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">end_seconds</span><span class="o">=</span><span class="k">$(</span>date --date<span class="o">=</span><span class="s2">&#34;</span><span class="nv">$endtime</span><span class="s2">&#34;</span> +%s<span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;本次业务镜像更新总计耗时：&#34;</span><span class="k">$((</span>end_seconds <span class="o">-</span> start_seconds<span class="k">))</span><span class="s2">&#34;s&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#基于k8s 内置版本管理回滚到上一个版本</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> rollback_last_version<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;即将回滚之上一个版本&#34;</span>
</span></span><span class="line"><span class="cl">    ssh root@<span class="si">${</span><span class="nv">K8S_CONTROLLER1</span><span class="si">}</span> <span class="s2">&#34;kubectl rollout undo deployment/xinn-web1-deployment -n xinn&#34;</span>
</span></span><span class="line"><span class="cl">    sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;已执行回滚至上一个版本&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#使用帮助</span>
</span></span><span class="line"><span class="cl">usage<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;部署使用方法为 </span><span class="si">${</span><span class="nv">SHELL_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">SHELL_NAME</span><span class="si">}</span><span class="s2"> deploy &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;回滚到上一版本使用方法为 </span><span class="si">${</span><span class="nv">SHELL_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">SHELL_NAME</span><span class="si">}</span><span class="s2"> rollback_last_version&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#主函数</span>
</span></span><span class="line"><span class="cl">main<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="si">${</span><span class="nv">METHOD</span><span class="si">}</span> in
</span></span><span class="line"><span class="cl">    deploy<span class="o">)</span>
</span></span><span class="line"><span class="cl">        Code_Clone
</span></span><span class="line"><span class="cl">        Copy_File
</span></span><span class="line"><span class="cl">        Make_Image
</span></span><span class="line"><span class="cl">        Update_k8s_yaml
</span></span><span class="line"><span class="cl">        Update_k8s_container
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    rollback_last_version<span class="o">)</span>
</span></span><span class="line"><span class="cl">        rollback_last_version
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    *<span class="o">)</span>
</span></span><span class="line"><span class="cl">        usage
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    <span class="k">esac</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">main <span class="nv">$1</span> <span class="nv">$2</span> <span class="nv">$3</span></span></span></code></pre></div><h4 id="334-测试k8s节点访问harbor拉取镜像">3.3.4 测试K8S节点访问harbor拉取镜像</h4>
<div class="highlight" id="id-25"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@k8s-made-01-32:/etc/docker/certs.d# tree ../certs.d/
</span></span><span class="line"><span class="cl">../certs.d/
</span></span><span class="line"><span class="cl">└── harbor.ceamg.com
</span></span><span class="line"><span class="cl">    ├── ca.crt
</span></span><span class="line"><span class="cl">    ├── harbor.ceamg.com.cert
</span></span><span class="line"><span class="cl">    ├── harbor.ceamg.com.crt
</span></span><span class="line"><span class="cl">    ├── harbor.ceamg.com.key
</span></span><span class="line"><span class="cl">    └── hosts.toml</span></span></code></pre></div><div class="highlight" id="id-26"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@k8s-made-01-32:/opt/k8s-data/dockerfile/xinn# docker login harbor.ceamg.com
</span></span><span class="line"><span class="cl">Username: xcd
</span></span><span class="line"><span class="cl">Password:
</span></span><span class="line"><span class="cl">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
</span></span><span class="line"><span class="cl">Configure a credential helper to remove this warning. See
</span></span><span class="line"><span class="cl">https://docs.docker.com/engine/reference/commandline/login/#credentials-store
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Login Succeeded</span></span></code></pre></div><h2 id="34-创建任务流水线实现自动化部署">3.4 创建任务流水线实现自动化部署</h2>
<h4 id="341-配置流水线参数">3.4.1 配置流水线参数</h4>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231204170355263.png" srcset="https://cdn1.ryanxin.live/image-20231204170355263.png, https://cdn1.ryanxin.live/image-20231204170355263.png 1.5x, https://cdn1.ryanxin.live/image-20231204170355263.png 2x" sizes="auto" data-title="image-20231204170355263" data-alt="image-20231204170355263" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231204170413225.png" srcset="https://cdn1.ryanxin.live/image-20231204170413225.png, https://cdn1.ryanxin.live/image-20231204170413225.png 1.5x, https://cdn1.ryanxin.live/image-20231204170413225.png 2x" sizes="auto" data-title="image-20231204170413225" data-alt="image-20231204170413225" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h4 id="342-更改gitlab中项目代码">3.4.2 更改Gitlab中项目代码</h4>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231204170623240.png" srcset="https://cdn1.ryanxin.live/image-20231204170623240.png, https://cdn1.ryanxin.live/image-20231204170623240.png 1.5x, https://cdn1.ryanxin.live/image-20231204170623240.png 2x" sizes="auto" data-title="image-20231204170623240" data-alt="image-20231204170623240" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h4 id="343-执行项目构建">3.4.3 执行项目构建</h4>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231204170712275.png" srcset="https://cdn1.ryanxin.live/image-20231204170712275.png, https://cdn1.ryanxin.live/image-20231204170712275.png 1.5x, https://cdn1.ryanxin.live/image-20231204170712275.png 2x" sizes="auto" data-title="image-20231204170712275" data-alt="image-20231204170712275" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h4 id="354-项目构建过程">3.5.4 项目构建过程</h4>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231204170751079.png" srcset="https://cdn1.ryanxin.live/image-20231204170751079.png, https://cdn1.ryanxin.live/image-20231204170751079.png 1.5x, https://cdn1.ryanxin.live/image-20231204170751079.png 2x" sizes="auto" data-title="image-20231204170751079" data-alt="image-20231204170751079" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231204170832969.png" srcset="https://cdn1.ryanxin.live/image-20231204170832969.png, https://cdn1.ryanxin.live/image-20231204170832969.png 1.5x, https://cdn1.ryanxin.live/image-20231204170832969.png 2x" sizes="auto" data-title="image-20231204170832969" data-alt="image-20231204170832969" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h4 id="355-服务访问测试">3.5.5 服务访问测试</h4>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231204170909547.png" srcset="https://cdn1.ryanxin.live/image-20231204170909547.png, https://cdn1.ryanxin.live/image-20231204170909547.png 1.5x, https://cdn1.ryanxin.live/image-20231204170909547.png 2x" sizes="auto" data-title="image-20231204170909547" data-alt="image-20231204170909547" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
</div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="更新于 2023-12-04 00:00:00">更新于 2023-12-04&nbsp;</span>
      </div><div class="post-info-license">
          <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>
        </div></div>
    <div class="post-info-line">
      <div class="post-info-md"><span><a href="/posts/kubernetes/advanced/k8s%E7%BB%93%E5%90%88jenkins%E4%B8%8Egitlab%E4%BB%A3%E7%A0%81%E5%8D%87%E7%BA%A7%E4%B8%8E%E5%9B%9E%E6%BB%9A/index.md" title="阅读原始文档" class="link-to-markdown">阅读原始文档</a></span></div>
      <div class="post-info-share">
        <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E7%BB%93%E5%90%88jenkins%E4%B8%8Egitlab%E4%BB%A3%E7%A0%81%E5%8D%87%E7%BA%A7%E4%B8%8E%E5%9B%9E%E6%BB%9A/" data-title="k8s结合Jenkins与gitlab代码升级与回滚" data-hashtags="Kubernetes,持续集成"><i class="fa-brands fa-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E7%BB%93%E5%90%88jenkins%E4%B8%8Egitlab%E4%BB%A3%E7%A0%81%E5%8D%87%E7%BA%A7%E4%B8%8E%E5%9B%9E%E6%BB%9A/" data-hashtag="Kubernetes"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 WhatsApp" data-sharer="whatsapp" data-url="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E7%BB%93%E5%90%88jenkins%E4%B8%8Egitlab%E4%BB%A3%E7%A0%81%E5%8D%87%E7%BA%A7%E4%B8%8E%E5%9B%9E%E6%BB%9A/" data-title="k8s结合Jenkins与gitlab代码升级与回滚" data-web><i class="fa-brands fa-whatsapp fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E7%BB%93%E5%90%88jenkins%E4%B8%8Egitlab%E4%BB%A3%E7%A0%81%E5%8D%87%E7%BA%A7%E4%B8%8E%E5%9B%9E%E6%BB%9A/" data-title="k8s结合Jenkins与gitlab代码升级与回滚"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E7%BB%93%E5%90%88jenkins%E4%B8%8Egitlab%E4%BB%A3%E7%A0%81%E5%8D%87%E7%BA%A7%E4%B8%8E%E5%9B%9E%E6%BB%9A/" data-title="k8s结合Jenkins与gitlab代码升级与回滚"><i class="fa-brands fa-weibo fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Myspace" data-sharer="myspace" data-url="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E7%BB%93%E5%90%88jenkins%E4%B8%8Egitlab%E4%BB%A3%E7%A0%81%E5%8D%87%E7%BA%A7%E4%B8%8E%E5%9B%9E%E6%BB%9A/" data-title="k8s结合Jenkins与gitlab代码升级与回滚" data-description=""><i data-svg-src="/lib/simple-icons/icons/myspace.min.svg" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Blogger" data-sharer="blogger" data-url="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E7%BB%93%E5%90%88jenkins%E4%B8%8Egitlab%E4%BB%A3%E7%A0%81%E5%8D%87%E7%BA%A7%E4%B8%8E%E5%9B%9E%E6%BB%9A/" data-title="k8s结合Jenkins与gitlab代码升级与回滚" data-description=""><i class="fa-brands fa-blogger fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Evernote" data-sharer="evernote" data-url="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E7%BB%93%E5%90%88jenkins%E4%B8%8Egitlab%E4%BB%A3%E7%A0%81%E5%8D%87%E7%BA%A7%E4%B8%8E%E5%9B%9E%E6%BB%9A/" data-title="k8s结合Jenkins与gitlab代码升级与回滚"><i class="fa-brands fa-evernote fa-fw" aria-hidden="true"></i></a>
  </span>
      </div>
    </div>
  </div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/tags/kubernetes/' class="post-tag">Kubernetes</a><a href='/tags/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/' class="post-tag">持续集成</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/notes/windows%E7%B3%BB%E7%BB%9F%E6%9F%A5%E6%89%BE%E8%AE%BF%E9%97%AE%E7%9B%AE%E7%9A%84%E7%AB%AF%E5%8F%A3%E7%9A%84%E8%BF%9B%E7%A8%8B/" class="post-nav-item" rel="prev" title="Windows 系统查找访问目的端口号的进程"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>Windows 系统查找访问目的端口号的进程</a></div>
</div>
</article></main><footer class="footer">
    <div class="footer-container"><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2021 - 2023</span><span class="author" itemprop="copyrightHolder">
              <a href="https://github.com/ryanxin7"target="_blank" rel="external nofollow noopener noreferrer">Ryan</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div><div class="footer-line statistics"><span class="site-time" title='网站运行中……'><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden="true"></i><span class="run-times ms-1">网站运行中……</span></span></div><div class="footer-line visitor">
          <span id="busuanzi_container_site_uv" title='总访客数'><i class="fa-regular fa-user fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='总访问量'><i class="fa-regular fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><a href="https://github.com/ryanxin7" title="在 GitHub 上查看源代码"target="_blank" rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><div id="mask"></div><div class="reading-progress-bar" style="left: 0;top: 0;"></div><noscript>
    <div class="noscript-warning">FixIt 主题在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/algoliasearch/algoliasearch-lite.umd.min.js" defer></script><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async defer></script><script src="/lib/pace/pace.min.js" async defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","editLockTitle":"锁定可编辑代码块","editUnLockTitle":"解锁可编辑代码块","editable":true,"maxShownLines":80},"comment":{"enable":false},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验。"},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"enablePWA":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"HFAFNY4NX2","algoliaIndex":"xn-log","algoliaSearchKey":"bd08388586b2f88b20753c17c60ba92f","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"siteTime":"2021-09-09T09:09:09+09:00"};</script><script src="/js/theme.min.js" defer></script></body>
</html>
