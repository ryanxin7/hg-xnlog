<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title> - Ryan&#39;s Notebook</title><meta name="author" content="Ryan">
<meta name="author-link" content="https://github.com/ryanxin7">
<meta name="description" content="安装java root@ceamg-server:/opt/jdk-17.0.9# java -version java version &#34;17.0.9&#34; 2023-10-17 LTS Java(TM) SE Runtime Environment (build 17.0.9&#43;11-LTS-201) Java HotSpot(TM) 64-Bit Server VM (build 17.0.9&#43;11-LTS-201, mixed mode, sharing)安装Jenkins root@ceamg-server:/tmp# dpkg -i jenkins_2.414.3_all.deb Selecting previously unselected package jenkins. (Reading database ... 75661 files and directories currently installed.) Preparing to unpack jenkins_2.414.3_all.deb ... Unpacking" /><meta name="keywords" content='Hugo, FixIt' /><meta itemprop="name" content="">
<meta itemprop="description" content="安装java root@ceamg-server:/opt/jdk-17.0.9# java -version java version &#34;17.0.9&#34; 2023-10-17 LTS Java(TM) SE Runtime Environment (build 17.0.9&#43;11-LTS-201) Java HotSpot(TM) 64-Bit Server VM (build 17.0.9&#43;11-LTS-201, mixed mode, sharing)安装Jenkins root@ceamg-server:/tmp# dpkg -i jenkins_2.414.3_all.deb Selecting previously unselected package jenkins. (Reading database ... 75661 files and directories currently installed.) Preparing to unpack jenkins_2.414.3_all.deb ... Unpacking">

<meta itemprop="wordCount" content="1999"><meta itemprop="image" content="https://hg-xnlog.github.io/logo.png"/>
<meta itemprop="keywords" content="" /><meta property="og:title" content="" />
<meta property="og:description" content="安装java root@ceamg-server:/opt/jdk-17.0.9# java -version java version &#34;17.0.9&#34; 2023-10-17 LTS Java(TM) SE Runtime Environment (build 17.0.9&#43;11-LTS-201) Java HotSpot(TM) 64-Bit Server VM (build 17.0.9&#43;11-LTS-201, mixed mode, sharing)安装Jenkins root@ceamg-server:/tmp# dpkg -i jenkins_2.414.3_all.deb Selecting previously unselected package jenkins. (Reading database ... 75661 files and directories currently installed.) Preparing to unpack jenkins_2.414.3_all.deb ... Unpacking" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%901/" /><meta property="og:image" content="https://hg-xnlog.github.io/logo.png"/><meta property="article:section" content="posts" />


<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://hg-xnlog.github.io/logo.png"/>

<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="安装java root@ceamg-server:/opt/jdk-17.0.9# java -version java version &#34;17.0.9&#34; 2023-10-17 LTS Java(TM) SE Runtime Environment (build 17.0.9&#43;11-LTS-201) Java HotSpot(TM) 64-Bit Server VM (build 17.0.9&#43;11-LTS-201, mixed mode, sharing)安装Jenkins root@ceamg-server:/tmp# dpkg -i jenkins_2.414.3_all.deb Selecting previously unselected package jenkins. (Reading database ... 75661 files and directories currently installed.) Preparing to unpack jenkins_2.414.3_all.deb ... Unpacking"/>
<meta name="application-name" content="Ryan’s Notebook">
<meta name="apple-mobile-web-app-title" content="Ryan’s Notebook"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%901/" /><link rel="prev" href="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%902/" /><link rel="next" href="https://hg-xnlog.github.io/posts/docker/%E6%9E%84%E5%BB%BAjdk17%E9%95%9C%E5%83%8F/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/hg-xnlog.github.io\/posts\/kubernetes\/advanced\/k8s%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%901\/"
    },"genre": "posts","wordcount":  1999 ,
    "url": "https:\/\/hg-xnlog.github.io\/posts\/kubernetes\/advanced\/k8s%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%901\/","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "Ryan"
      },"description": ""
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="wide"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper" data-github-corner="right">
    <div class="header-title">
      <a href="/" title="Ryan&#39;s Notebook"><img loading="lazy" src="/images/pow.png" srcset="/images/pow.png, /images/pow.png 1.5x, /images/pow.png 2x" sizes="auto" data-title="Ryan&#39;s Notebook" data-alt="Ryan&#39;s Notebook" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">Ryan’s Notebook</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 所有文章</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/friends/"
                title="友情链接"
                
              ><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden="true"></i> 友链</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/about/"
                
                
              ><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden="true"></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="搜索文章标题或内容……" id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="Ryan&#39;s Notebook"><img loading="lazy" src="/images/pow.png" srcset="/images/pow.png, /images/pow.png 1.5x, /images/pow.png 2x" sizes="auto" data-title="/images/pow.png" data-alt="/images/pow.png" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">Ryan’s Notebook</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="搜索文章标题或内容……" id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              取消
            </a>
          </li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 所有文章</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/friends/"
                  title="友情链接"
                  
                ><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden="true"></i> 友链</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/about/"
                  
                  
                ><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden="true"></i> 关于</a></li><li
              class="menu-item text-center"
            ><a
                  class="menu-link"
                  href="https://github.com/ryanxin7/hg-xnlog"
                  title="GitHub"
                  rel="noopener noreferrer" target="_blank"
                ><i class='fa-brands fa-github fa-fw' aria-hidden='true'></i> </a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="切换主题"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="container"><aside class="toc" id="toc-auto"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside>

  <aside class="aside-custom">
    </aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span></span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><a href="https://github.com/ryanxin7" title="作者"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="/images/avatar.png" srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x" sizes="auto" data-title="Ryan" data-alt="Ryan" class="avatar" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/>&nbsp;Ryan</a></span></div>
      <div class="post-meta-line"><span title="发布于 0001-01-01 00:00:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden="true"></i><time datetime="0001-01-01">0001-01-01</time></span>&nbsp;<span title="更新于 0001-01-01 00:00:00"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden="true"></i><time datetime="0001-01-01">0001-01-01</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>约 1999 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>预计阅读 4 分钟</span>&nbsp;<span id="busuanzi_container_page_pv" class="busuanzi_visitors comment-visitors" data-flag-title="">
            <i class="fa-regular fa-eye fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_page_pv">-</span>&nbsp;次阅读
          </span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#执行构建">执行构建</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><div class="details admonition warning open">
      <div class="details-summary admonition-title">
        <i class="icon fa-solid fa-exclamation-triangle fa-fw" aria-hidden="true"></i>警告<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
      </div>
      <div class="details-content">
        <div class="admonition-content">本文最后更新于 0001-01-01，文中内容可能已过时。</div>
      </div>
    </div><p>安装java</p>
<div class="highlight" id="id-1"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9# java -version
</span></span><span class="line"><span class="cl">java version <span class="s2">&#34;17.0.9&#34;</span> 2023-10-17 LTS
</span></span><span class="line"><span class="cl">Java<span class="o">(</span>TM<span class="o">)</span> SE Runtime Environment <span class="o">(</span>build 17.0.9+11-LTS-201<span class="o">)</span>
</span></span><span class="line"><span class="cl">Java HotSpot<span class="o">(</span>TM<span class="o">)</span> 64-Bit Server VM <span class="o">(</span>build 17.0.9+11-LTS-201, mixed mode, sharing<span class="o">)</span></span></span></code></pre></div><p>安装Jenkins</p>
<div class="highlight" id="id-2"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@ceamg-server:/tmp# dpkg -i jenkins_2.414.3_all.deb
</span></span><span class="line"><span class="cl">Selecting previously unselected package jenkins.
</span></span><span class="line"><span class="cl"><span class="o">(</span>Reading database ... <span class="m">75661</span> files and directories currently installed.<span class="o">)</span>
</span></span><span class="line"><span class="cl">Preparing to unpack jenkins_2.414.3_all.deb ...
</span></span><span class="line"><span class="cl">Unpacking jenkins <span class="o">(</span>2.414.3<span class="o">)</span> ...
</span></span><span class="line"><span class="cl">dpkg: dependency problems prevent configuration of jenkins:
</span></span><span class="line"><span class="cl"> jenkins depends on net-tools<span class="p">;</span> however:
</span></span><span class="line"><span class="cl">  Package net-tools is not installed.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">dpkg: error processing package jenkins <span class="o">(</span>--install<span class="o">)</span>:
</span></span><span class="line"><span class="cl"> dependency problems - leaving unconfigured
</span></span><span class="line"><span class="cl">Processing triggers <span class="k">for</span> systemd <span class="o">(</span>245.4-4ubuntu3.11<span class="o">)</span> ...
</span></span><span class="line"><span class="cl">Errors were encountered <span class="k">while</span> processing:
</span></span><span class="line"><span class="cl"> jenkins
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root@ceamg-server:/tmp# dpkg -r jenkins
</span></span><span class="line"><span class="cl"><span class="o">(</span>Reading database ... <span class="m">75675</span> files and directories currently installed.<span class="o">)</span>
</span></span><span class="line"><span class="cl">Removing jenkins <span class="o">(</span>2.414.3<span class="o">)</span> ...</span></span></code></pre></div><p>安装依赖</p>
<div class="highlight" id="id-3"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@ceamg-server:/tmp# apt install  net-tools
</span></span><span class="line"><span class="cl">Reading package lists... Done
</span></span><span class="line"><span class="cl">Building dependency tree
</span></span><span class="line"><span class="cl">Reading state information... Done
</span></span><span class="line"><span class="cl">The following NEW packages will be installed:
</span></span><span class="line"><span class="cl">  net-tools
</span></span><span class="line"><span class="cl"><span class="m">0</span> upgraded, <span class="m">1</span> newly installed, <span class="m">0</span> to remove and <span class="m">264</span> not upgraded.
</span></span><span class="line"><span class="cl">Need to get <span class="m">196</span> kB of archives.
</span></span><span class="line"><span class="cl">After this operation, <span class="m">864</span> kB of additional disk space will be used.
</span></span><span class="line"><span class="cl">Get:1 http://mirrors.tuna.tsinghua.edu.cn/ubuntu focal/main amd64 net-tools amd64 1.60+git20180626.aebd88e-1ubuntu1 <span class="o">[</span><span class="m">196</span> kB<span class="o">]</span>
</span></span><span class="line"><span class="cl">Fetched <span class="m">196</span> kB in 2s <span class="o">(</span><span class="m">121</span> kB/s<span class="o">)</span>
</span></span><span class="line"><span class="cl">Selecting previously unselected package net-tools.
</span></span><span class="line"><span class="cl"><span class="o">(</span>Reading database ... <span class="m">75664</span> files and directories currently installed.<span class="o">)</span>
</span></span><span class="line"><span class="cl">Preparing to unpack .../net-tools_1.60+git20180626.aebd88e-1ubuntu1_amd64.deb ...
</span></span><span class="line"><span class="cl">Unpacking net-tools <span class="o">(</span>1.60+git20180626.aebd88e-1ubuntu1<span class="o">)</span> ...
</span></span><span class="line"><span class="cl">Setting up net-tools <span class="o">(</span>1.60+git20180626.aebd88e-1ubuntu1<span class="o">)</span> ...
</span></span><span class="line"><span class="cl">Processing triggers <span class="k">for</span> man-db <span class="o">(</span>2.9.1-1<span class="o">)</span> ...</span></span></code></pre></div><div class="highlight" id="id-4"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9# systemctl restart jenkins.service
</span></span><span class="line"><span class="cl">Warning: The unit file, <span class="nb">source</span> configuration file or drop-ins of jenkins.service changed on disk. Run <span class="s1">&#39;systemctl daemon-reload&#39;</span> to reload units.
</span></span><span class="line"><span class="cl">Job <span class="k">for</span> jenkins.service failed because the control process exited with error code.
</span></span><span class="line"><span class="cl">See <span class="s2">&#34;systemctl status jenkins.service&#34;</span> and <span class="s2">&#34;journalctl -xe&#34;</span> <span class="k">for</span> details.
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9#
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9# systemctl daemon-reload
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9#
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9# systemctl restart jenkins.service
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9#
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9# systemctl status jenkins.service
</span></span><span class="line"><span class="cl">● jenkins.service - Jenkins Continuous Integration Server
</span></span><span class="line"><span class="cl">     Loaded: loaded <span class="o">(</span>/lib/systemd/system/jenkins.service<span class="p">;</span> enabled<span class="p">;</span> vendor preset: enabled<span class="o">)</span>
</span></span><span class="line"><span class="cl">    Drop-In: /etc/systemd/system/jenkins.service.d
</span></span><span class="line"><span class="cl">             └─override.conf
</span></span><span class="line"><span class="cl">     Active: active <span class="o">(</span>running<span class="o">)</span> since Fri 2023-12-01 06:03:29 UTC<span class="p">;</span> 49s ago
</span></span><span class="line"><span class="cl">   Main PID: <span class="m">1083179</span> <span class="o">(</span>java<span class="o">)</span>
</span></span><span class="line"><span class="cl">      Tasks: <span class="m">59</span> <span class="o">(</span>limit: 9447<span class="o">)</span>
</span></span><span class="line"><span class="cl">     Memory: 2.1G
</span></span><span class="line"><span class="cl">     CGroup: /system.slice/jenkins.service
</span></span><span class="line"><span class="cl">             └─1083179 /opt/jdk-17.0.9/bin/java -Djava.awt.headless<span class="o">=</span><span class="nb">true</span> -jar /usr/share/java/jenkins.war --webroot<span class="o">=</span>/var/cache/jenkins/war --httpPort<span class="o">=</span>&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Dec <span class="m">01</span> 06:03:11 ceamg-server jenkins<span class="o">[</span>1083179<span class="o">]</span>: Jenkins initial setup is required. An admin user has been created and a password generated.
</span></span><span class="line"><span class="cl">Dec <span class="m">01</span> 06:03:11 ceamg-server jenkins<span class="o">[</span>1083179<span class="o">]</span>: Please use the following password to proceed to installation:
</span></span><span class="line"><span class="cl">Dec <span class="m">01</span> 06:03:11 ceamg-server jenkins<span class="o">[</span>1083179<span class="o">]</span>: aad0ca64ee9a499cb00ea803b0563694
</span></span><span class="line"><span class="cl">Dec <span class="m">01</span> 06:03:11 ceamg-server jenkins<span class="o">[</span>1083179<span class="o">]</span>: This may also be found at: /var/lib/jenkins/secrets/initialAdminPassword
</span></span><span class="line"><span class="cl">Dec <span class="m">01</span> 06:03:11 ceamg-server jenkins<span class="o">[</span>1083179<span class="o">]</span>: *************************************************************
</span></span><span class="line"><span class="cl">Dec <span class="m">01</span> 06:03:11 ceamg-server jenkins<span class="o">[</span>1083179<span class="o">]</span>: *************************************************************
</span></span><span class="line"><span class="cl">Dec <span class="m">01</span> 06:03:11 ceamg-server jenkins<span class="o">[</span>1083179<span class="o">]</span>: *************************************************************
</span></span><span class="line"><span class="cl">Dec <span class="m">01</span> 06:03:29 ceamg-server jenkins<span class="o">[</span>1083179<span class="o">]</span>: 2023-12-01 06:03:29.569+0000 <span class="o">[</span><span class="nv">id</span><span class="o">=</span>48<span class="o">]</span>        INFO        jenkins.InitReactorRunner<span class="nv">$1</span><span class="c1">#onAttained: Complet&gt;</span>
</span></span><span class="line"><span class="cl">Dec <span class="m">01</span> 06:03:29 ceamg-server jenkins<span class="o">[</span>1083179<span class="o">]</span>: 2023-12-01 06:03:29.584+0000 <span class="o">[</span><span class="nv">id</span><span class="o">=</span>26<span class="o">]</span>        INFO        hudson.lifecycle.Lifecycle#onReady: Jenkins is &gt;
</span></span><span class="line"><span class="cl">Dec <span class="m">01</span> 06:03:29 ceamg-server systemd<span class="o">[</span>1<span class="o">]</span>: Started Jenkins Continuous Integration Server.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9#
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9# netstat -lntup
</span></span><span class="line"><span class="cl">Active Internet connections <span class="o">(</span>only servers<span class="o">)</span>
</span></span><span class="line"><span class="cl">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:41991           0.0.0.0:*               LISTEN      -
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:41643           0.0.0.0:*               LISTEN      625/rpc.mountd
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:54605           0.0.0.0:*               LISTEN      625/rpc.mountd
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:111             0.0.0.0:*               LISTEN      1/init
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.1:20180         0.0.0.0:*               LISTEN      82703/VMToolsAgentA
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.1:20181         0.0.0.0:*               LISTEN      82703/VMToolsAgentA
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.1:33397         0.0.0.0:*               LISTEN      82686/G2HProxy
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.53:53           0.0.0.0:*               LISTEN      621/systemd-resolve
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.1:20182         0.0.0.0:*               LISTEN      82686/G2HProxy
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:22              0.0.0.0:*               LISTEN      1666/sshd: /usr/sbi
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.1:6010          0.0.0.0:*               LISTEN      29129/sshd: ceamg@p
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:2049            0.0.0.0:*               LISTEN      -
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:58913           0.0.0.0:*               LISTEN      625/rpc.mountd
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> :::34469                :::*                    LISTEN      625/rpc.mountd
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> :::35597                :::*                    LISTEN      -
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> :::60909                :::*                    LISTEN      625/rpc.mountd
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> :::111                  :::*                    LISTEN      1/init
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> :::8080                 :::*                    LISTEN      1083179/java</span></span></code></pre></div><p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231201143838772.png" srcset="https://cdn1.ryanxin.live/image-20231201143838772.png, https://cdn1.ryanxin.live/image-20231201143838772.png 1.5x, https://cdn1.ryanxin.live/image-20231201143838772.png 2x" sizes="auto" data-title="image-20231201143838772" data-alt="image-20231201143838772" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<div class="highlight" id="id-5"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@ceamg-server:/opt/jdk-17.0.9# cat /var/lib/jenkins/secrets/initialAdminPassword
</span></span><span class="line"><span class="cl">aad0ca64ee9a499cb00ea803b0563694</span></span></code></pre></div><p><img loading="lazy" src="C:%5cUsers%5cxx9z%5cDownloads%5cimage-20231201144616862.png" srcset="C:%5cUsers%5cxx9z%5cDownloads%5cimage-20231201144616862.png, C:%5cUsers%5cxx9z%5cDownloads%5cimage-20231201144616862.png 1.5x, C:%5cUsers%5cxx9z%5cDownloads%5cimage-20231201144616862.png 2x" sizes="auto" data-title="image-20231201144616862" data-alt="image-20231201144616862" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="C:%5cUsers%5cxx9z%5cDownloads%5cimage-20231201144709325.png" srcset="C:%5cUsers%5cxx9z%5cDownloads%5cimage-20231201144709325.png, C:%5cUsers%5cxx9z%5cDownloads%5cimage-20231201144709325.png 1.5x, C:%5cUsers%5cxx9z%5cDownloads%5cimage-20231201144709325.png 2x" sizes="auto" data-title="image-20231201144709325" data-alt="image-20231201144709325" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/image-20231201152600697.png" srcset="https://cdn1.ryanxin.live/image-20231201152600697.png, https://cdn1.ryanxin.live/image-20231201152600697.png 1.5x, https://cdn1.ryanxin.live/image-20231201152600697.png 2x" sizes="auto" data-title="image-20231201152600697" data-alt="image-20231201152600697" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>先重启一下变成中文</p>
<p>测试Jenkins</p>
<p><img loading="lazy" src="C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201154407514.png" srcset="C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201154407514.png, C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201154407514.png 1.5x, C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201154407514.png 2x" sizes="auto" data-title="image-20231201154407514" data-alt="image-20231201154407514" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201154614638.png" srcset="C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201154614638.png, C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201154614638.png 1.5x, C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201154614638.png 2x" sizes="auto" data-title="image-20231201154614638" data-alt="image-20231201154614638" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201155058023.png" srcset="C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201155058023.png, C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201155058023.png 1.5x, C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201155058023.png 2x" sizes="auto" data-title="image-20231201155058023" data-alt="image-20231201155058023" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201155159325.png" srcset="C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201155159325.png, C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201155159325.png 1.5x, C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201155159325.png 2x" sizes="auto" data-title="image-20231201155159325" data-alt="image-20231201155159325" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>测试clone</p>
<div class="highlight" id="id-6"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@ceamg-server:/opt# git clone  http://10.1.0.140/xxteam/xinn.git
</span></span><span class="line"><span class="cl">Cloning into <span class="s1">&#39;xinn&#39;</span>...
</span></span><span class="line"><span class="cl">Username <span class="k">for</span> <span class="s1">&#39;http://10.1.0.140&#39;</span>: xin1
</span></span><span class="line"><span class="cl">Password <span class="k">for</span> <span class="s1">&#39;http://xin1@10.1.0.140&#39;</span>:
</span></span><span class="line"><span class="cl">remote: Enumerating objects: 6, <span class="k">done</span>.
</span></span><span class="line"><span class="cl">remote: Counting objects: 100% <span class="o">(</span>6/6<span class="o">)</span>, <span class="k">done</span>.
</span></span><span class="line"><span class="cl">remote: Compressing objects: 100% <span class="o">(</span>4/4<span class="o">)</span>, <span class="k">done</span>.
</span></span><span class="line"><span class="cl">remote: Total <span class="m">6</span> <span class="o">(</span>delta 0<span class="o">)</span>, reused <span class="m">0</span> <span class="o">(</span>delta 0<span class="o">)</span>, pack-reused <span class="m">0</span>
</span></span><span class="line"><span class="cl">Unpacking objects: 100% <span class="o">(</span>6/6<span class="o">)</span>, 3.03 KiB <span class="p">|</span> 57.00 KiB/s, <span class="k">done</span>.</span></span></code></pre></div><p><img loading="lazy" src="C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201161908459.png" srcset="C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201161908459.png, C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201161908459.png 1.5x, C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201161908459.png 2x" sizes="auto" data-title="image-20231201161908459" data-alt="image-20231201161908459" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201162914825.png" srcset="C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201162914825.png, C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201162914825.png 1.5x, C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201162914825.png 2x" sizes="auto" data-title="image-20231201162914825" data-alt="image-20231201162914825" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201171418209.png" srcset="C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201171418209.png, C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201171418209.png 1.5x, C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201171418209.png 2x" sizes="auto" data-title="image-20231201171418209" data-alt="image-20231201171418209" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<div class="highlight" id="id-7"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@ceamg-server:/data# ssh-keygen
</span></span><span class="line"><span class="cl">Generating public/private rsa key pair.
</span></span><span class="line"><span class="cl">Enter file in which to save the key <span class="o">(</span>/root/.ssh/id_rsa<span class="o">)</span>:
</span></span><span class="line"><span class="cl">Enter passphrase <span class="o">(</span>empty <span class="k">for</span> no passphrase<span class="o">)</span>:
</span></span><span class="line"><span class="cl">Enter same passphrase again:
</span></span><span class="line"><span class="cl">Your identification has been saved in /root/.ssh/id_rsa
</span></span><span class="line"><span class="cl">Your public key has been saved in /root/.ssh/id_rsa.pub
</span></span><span class="line"><span class="cl">The key fingerprint is:
</span></span><span class="line"><span class="cl">SHA256:aZCal90HsZPHoIcJj4ggYFdSDU3UJ51+shAMTOt4bVU root@ceamg-server
</span></span><span class="line"><span class="cl">The key<span class="err">&#39;</span>s randomart image is:
</span></span><span class="line"><span class="cl">+---<span class="o">[</span>RSA 3072<span class="o">]</span>----+
</span></span><span class="line"><span class="cl"><span class="p">|</span><span class="o">=</span>. oo+X<span class="o">=</span>+ + .E   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>o..... O.O X.    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  . . +.<span class="o">=</span> @.o    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     oo+.<span class="o">=</span>.* .   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>    o.ooSoo <span class="o">=</span>    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     ....  o     <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>                 <span class="p">|</span>
</span></span><span class="line"><span class="cl">+----<span class="o">[</span>SHA256<span class="o">]</span>-----+
</span></span><span class="line"><span class="cl">root@ceamg-server:/data#
</span></span><span class="line"><span class="cl">root@ceamg-server:/data# cat /root/.ssh/
</span></span><span class="line"><span class="cl">authorized_keys  id_rsa           id_rsa.pub
</span></span><span class="line"><span class="cl">root@ceamg-server:/data# cat /root/.ssh/id_rsa.pub
</span></span><span class="line"><span class="cl">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDNRtj7OYSloUzmkhC/o9IohtoqKT9hhXlfM9t8VxnQZKqoCSlnZrlrpSk32Ds9JcKfpytu5x2iwPsF/Ytb8wS4dTBKc/89FyO+U1cOMxXakNBL9lYIbyxNrVs2GAWRwJyyYsfa8kOTLvkPejRm2d5HeQKLqbbTChHsubFQDHDLjz0DVNPx9J5t4Z33Dn8cSjAjMtKVLCgb810gOW0S60RMFLSSmoEzDwWG4Kv7vbOgugNDhQS3UVfOY1DU6/b8OMrWzaPLySaUXe0CjDf3sDgMU3LG2CsHaJ9eIqBwI5YQ84RanCINfbuyrlFW4Mu3FF1B2lxfZlen/O0vcfOq0sJX990/1xO136xkngWzElOEIkCpVCUqMyIj4BS0qdYu+IUw3+diKcsOC9nbJ1E3zootRiTUD6oejbAB1aSy4g0JaavfGJjpoJXLSWV09wk8Osivrf3MXme7vhzLNzF9vraiwenNUM/BAvYSVAJQyQNvksGFrLFm4U9KXG5WqpDLTP8<span class="o">=</span> root@ceamg-server</span></span></code></pre></div><p><img loading="lazy" src="C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201163530046.png" srcset="C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201163530046.png, C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201163530046.png 1.5x, C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201163530046.png 2x" sizes="auto" data-title="image-20231201163530046" data-alt="image-20231201163530046" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<div class="highlight" id="id-8"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@ceamg-server:/opt# rm -rf xinn/
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt#
</span></span><span class="line"><span class="cl">root@ceamg-server:/opt# git clone git@10.1.0.140:xxteam/xinn.git
</span></span><span class="line"><span class="cl">Cloning into <span class="s1">&#39;xinn&#39;</span>...
</span></span><span class="line"><span class="cl">The authenticity of host <span class="s1">&#39;10.1.0.140 (10.1.0.140)&#39;</span> can<span class="s1">&#39;t be established.
</span></span></span><span class="line"><span class="cl"><span class="s1">ECDSA key fingerprint is SHA256:lhRjKQBhgEhjbqcfKBb6oyle8C9EIOzu48QUoaeISIE.
</span></span></span><span class="line"><span class="cl"><span class="s1">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span></span></span><span class="line"><span class="cl"><span class="s1">Warning: Permanently added &#39;</span>10.1.0.140<span class="s1">&#39; (ECDSA) to the list of known hosts.
</span></span></span><span class="line"><span class="cl"><span class="s1">remote: Enumerating objects: 6, done.
</span></span></span><span class="line"><span class="cl"><span class="s1">remote: Counting objects: 100% (6/6), done.
</span></span></span><span class="line"><span class="cl"><span class="s1">remote: Compressing objects: 100% (4/4), done.
</span></span></span><span class="line"><span class="cl"><span class="s1">remote: Total 6 (delta 0), reused 0 (delta 0), pack-reused 0
</span></span></span><span class="line"><span class="cl"><span class="s1">Receiving objects: 100% (6/6), done.
</span></span></span><span class="line"><span class="cl"><span class="s1">root@ceamg-server:/opt#
</span></span></span><span class="line"><span class="cl"><span class="s1">root@ceamg-server:/opt# rm -rf xinn/
</span></span></span><span class="line"><span class="cl"><span class="s1">root@ceamg-server:/opt#
</span></span></span><span class="line"><span class="cl"><span class="s1">root@ceamg-server:/opt# git clone git@10.1.0.140:xxteam/xinn.git
</span></span></span><span class="line"><span class="cl"><span class="s1">Cloning into &#39;</span>xinn<span class="err">&#39;</span>...
</span></span><span class="line"><span class="cl">remote: Enumerating objects: 6, <span class="k">done</span>.
</span></span><span class="line"><span class="cl">remote: Counting objects: 100% <span class="o">(</span>6/6<span class="o">)</span>, <span class="k">done</span>.
</span></span><span class="line"><span class="cl">remote: Compressing objects: 100% <span class="o">(</span>4/4<span class="o">)</span>, <span class="k">done</span>.
</span></span><span class="line"><span class="cl">remote: Total <span class="m">6</span> <span class="o">(</span>delta 0<span class="o">)</span>, reused <span class="m">0</span> <span class="o">(</span>delta 0<span class="o">)</span>, pack-reused <span class="m">0</span>
</span></span><span class="line"><span class="cl">Receiving objects: 100% <span class="o">(</span>6/6<span class="o">)</span>, <span class="k">done</span>.</span></span></code></pre></div><div class="highlight" id="id-9"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir /data/gitdata</span></span></code></pre></div><div class="highlight" id="id-10"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">xinn-web1-deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">xinn</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">xinn-web1-tomcat</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">xinn-web1-tomcat</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">xinn-web1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">harbor.ceamg.com/baseimages/webapp-tomcat:x1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">xinn-web1-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">xinn</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">xinn-web1-tomcat</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="m">9988</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">NodePort</span></span></span></code></pre></div><p><img loading="lazy" src="C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201171639534.png" srcset="C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201171639534.png, C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201171639534.png 1.5x, C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201171639534.png 2x" sizes="auto" data-title="image-20231201171639534" data-alt="image-20231201171639534" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h2 id="执行构建">执行构建</h2>
<p><img loading="lazy" src="C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201174158992.png" srcset="C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201174158992.png, C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201174158992.png 1.5x, C:%5cUsers%5cxx9z%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20231201174158992.png 2x" sizes="auto" data-title="image-20231201174158992" data-alt="image-20231201174158992" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<div class="highlight" id="id-11"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">/opt/k8s-data/yaml/xinn-web1.yaml
</span></span><span class="line"><span class="cl">/opt/k8s-data/dockerfile/xinn</span></span></code></pre></div><div class="highlight" id="id-12"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@k8s-made-01-32:/opt/k8s-data/dockerfile/xinn# docker login harbor.ceamg.com
</span></span><span class="line"><span class="cl">Username: xcd
</span></span><span class="line"><span class="cl">Password:
</span></span><span class="line"><span class="cl">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
</span></span><span class="line"><span class="cl">Configure a credential helper to remove this warning. See
</span></span><span class="line"><span class="cl">https://docs.docker.com/engine/reference/commandline/login/#credentials-store
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Login Succeeded</span></span></code></pre></div><div class="highlight" id="id-13"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">#Author: ZhangShiJie</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Date: 2019-08-03</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Version: v1</span>
</span></span><span class="line"><span class="cl"><span class="c1">#记录脚本开始执行时间</span>
</span></span><span class="line"><span class="cl"><span class="nv">starttime</span><span class="o">=</span><span class="k">$(</span>date +<span class="s1">&#39;%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#变量</span>
</span></span><span class="line"><span class="cl"><span class="nv">SHELL_DIR</span><span class="o">=</span><span class="s2">&#34;/root/scripts&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">SHELL_NAME</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$0</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">K8S_CONTROLLER1</span><span class="o">=</span><span class="s2">&#34;10.1.0.32&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">K8S_CONTROLLER2</span><span class="o">=</span><span class="s2">&#34;10.1.0.33&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">DATE</span><span class="o">=</span><span class="k">$(</span>date +%Y-%m-%d_%H_%M_%S<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">METHOD</span><span class="o">=</span><span class="nv">$1</span>
</span></span><span class="line"><span class="cl"><span class="nv">Branch</span><span class="o">=</span><span class="nv">$2</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nb">test</span> -z <span class="nv">$Branch</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nv">Branch</span><span class="o">=</span>develop
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> Code_Clone<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">Git_URL</span><span class="o">=</span><span class="s2">&#34;git@10.1.0.140:xxteam/xinn.git&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">DIR_NAME</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="si">${</span><span class="nv">Git_URL</span><span class="si">}</span> <span class="p">|</span> awk -F <span class="s2">&#34;/&#34;</span> <span class="s1">&#39;{print $2}&#39;</span> <span class="p">|</span> awk -F <span class="s2">&#34;.&#34;</span> <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">DATA_DIR</span><span class="o">=</span><span class="s2">&#34;/data/gitdata/&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">Git_Dir</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">DATA_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">DIR_NAME</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">cd</span> <span class="si">${</span><span class="nv">DATA_DIR</span><span class="si">}</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;即将清空上一版本代码并获取当前分支最新代码&#34;</span> <span class="o">&amp;&amp;</span> sleep <span class="m">1</span> <span class="o">&amp;&amp;</span> rm -rf <span class="si">${</span><span class="nv">DIR_NAME</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;即将开始从分支</span><span class="si">${</span><span class="nv">Branch</span><span class="si">}</span><span class="s2"> 获取代码&#34;</span> <span class="o">&amp;&amp;</span> sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">    git clone -b <span class="si">${</span><span class="nv">Branch</span><span class="si">}</span> <span class="si">${</span><span class="nv">Git_URL</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;分支</span><span class="si">${</span><span class="nv">Branch</span><span class="si">}</span><span class="s2"> 克隆完成，即将进行代码编译!&#34;</span> <span class="o">&amp;&amp;</span> sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#cd ${Git_Dir} &amp;&amp; mvn clean package</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#echo &#34;代码编译完成，即将开始将IP地址等信息替换为测试环境&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#####################################################</span>
</span></span><span class="line"><span class="cl">    sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">    <span class="nb">cd</span> <span class="si">${</span><span class="nv">Git_Dir</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">    tar czf <span class="si">${</span><span class="nv">DIR_NAME</span><span class="si">}</span>.tar.gz ./*
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#将打包好的压缩文件拷贝到k8s 控制端服务器</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> Copy_File<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;压缩文件打包完成，即将拷贝到k8s 控制端服务器</span><span class="si">${</span><span class="nv">K8S_CONTROLLER1</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">&amp;&amp;</span> sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">    scp <span class="si">${</span><span class="nv">Git_Dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">DIR_NAME</span><span class="si">}</span>.tar.gz root@<span class="si">${</span><span class="nv">K8S_CONTROLLER1</span><span class="si">}</span>:/opt/k8s-data/dockerfile/xinn
</span></span><span class="line"><span class="cl">    ssh root@<span class="si">${</span><span class="nv">K8S_CONTROLLER1</span><span class="si">}</span> <span class="s2">&#34;cd /opt/k8s-data/dockerfile/xinn &amp;&amp; tar xf </span><span class="si">${</span><span class="nv">DIR_NAME</span><span class="si">}</span><span class="s2">.tar.gz ./&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;压缩文件拷贝完成,服务器</span><span class="si">${</span><span class="nv">K8S_CONTROLLER1</span><span class="si">}</span><span class="s2">即将开始制作Docker 镜像!&#34;</span> <span class="o">&amp;&amp;</span> sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#到控制端执行脚本制作并上传镜像</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> Make_Image<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;开始制作Docker镜像并上传到Harbor服务器&#34;</span> <span class="o">&amp;&amp;</span> sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">    ssh root@<span class="si">${</span><span class="nv">K8S_CONTROLLER1</span><span class="si">}</span> <span class="s2">&#34;cd /opt/k8s-data/dockerfile/xinn &amp;&amp; bash build-command.sh </span><span class="si">${</span><span class="nv">DATE</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;Docker镜像制作完成并已经上传到harbor服务器&#34;</span> <span class="o">&amp;&amp;</span> sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#到控制端更新k8s yaml文件中的镜像版本号,从而保持yaml文件中的镜像版本号和k8s中版本号一致</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> Update_k8s_yaml<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;即将更新k8s yaml文件中镜像版本&#34;</span> <span class="o">&amp;&amp;</span> sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">    ssh root@<span class="si">${</span><span class="nv">K8S_CONTROLLER1</span><span class="si">}</span> <span class="s2">&#34;cd /opt/k8s-data/yaml &amp;&amp; sed -i &#39;s/image: harbor.ceamg.*/image: harbor.ceamg.com\/baseimages\/xinn-web1:</span><span class="si">${</span><span class="nv">DATE</span><span class="si">}</span><span class="s2">/g&#39; xinn-web1.yaml&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;k8s yaml文件镜像版本更新完成,即将开始更新容器中镜像版本&#34;</span> <span class="o">&amp;&amp;</span> sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#到控制端更新k8s中容器的版本号,有两种更新办法，一是指定镜像版本更新，二是apply执行修改过的yaml文件</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> Update_k8s_container<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#第一种方法</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#ssh root@${K8S_CONTROLLER1} &#34;kubectl set image deployment/linux36-nginx-deployment linux36-nginx-container=harbor.magedu.net/linux36/nginx-web1:${DATE} -n linux36&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#第二种方法,推荐使用第一种</span>
</span></span><span class="line"><span class="cl">    ssh root@<span class="si">${</span><span class="nv">K8S_CONTROLLER1</span><span class="si">}</span> <span class="s2">&#34;cd /opt/k8s-data/yaml &amp;&amp; kubectl apply -f xinn-web1.yaml --record&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;k8s 镜像更新完成&#34;</span> <span class="o">&amp;&amp;</span> sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;当前业务镜像版本: harbor.ceamg.com/baseimages/xinn-web1:</span><span class="si">${</span><span class="nv">DATE</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#计算脚本累计执行时间，如果不需要的话可以去掉下面四行</span>
</span></span><span class="line"><span class="cl">    <span class="nv">endtime</span><span class="o">=</span><span class="k">$(</span>date +<span class="s1">&#39;%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">start_seconds</span><span class="o">=</span><span class="k">$(</span>date --date<span class="o">=</span><span class="s2">&#34;</span><span class="nv">$starttime</span><span class="s2">&#34;</span> +%s<span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">end_seconds</span><span class="o">=</span><span class="k">$(</span>date --date<span class="o">=</span><span class="s2">&#34;</span><span class="nv">$endtime</span><span class="s2">&#34;</span> +%s<span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;本次业务镜像更新总计耗时：&#34;</span><span class="k">$((</span>end_seconds <span class="o">-</span> start_seconds<span class="k">))</span><span class="s2">&#34;s&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#基于k8s 内置版本管理回滚到上一个版本</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> rollback_last_version<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;即将回滚之上一个版本&#34;</span>
</span></span><span class="line"><span class="cl">    ssh root@<span class="si">${</span><span class="nv">K8S_CONTROLLER1</span><span class="si">}</span> <span class="s2">&#34;kubectl rollout undo deployment/xinn-web1-deployment -n xinn&#34;</span>
</span></span><span class="line"><span class="cl">    sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;已执行回滚至上一个版本&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#使用帮助</span>
</span></span><span class="line"><span class="cl">usage<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;部署使用方法为 </span><span class="si">${</span><span class="nv">SHELL_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">SHELL_NAME</span><span class="si">}</span><span class="s2"> deploy &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;回滚到上一版本使用方法为 </span><span class="si">${</span><span class="nv">SHELL_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">SHELL_NAME</span><span class="si">}</span><span class="s2"> rollback_last_version&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#主函数</span>
</span></span><span class="line"><span class="cl">main<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="si">${</span><span class="nv">METHOD</span><span class="si">}</span> in
</span></span><span class="line"><span class="cl">    deploy<span class="o">)</span>
</span></span><span class="line"><span class="cl">        Code_Clone
</span></span><span class="line"><span class="cl">        Copy_File
</span></span><span class="line"><span class="cl">        Make_Image
</span></span><span class="line"><span class="cl">        Update_k8s_yaml
</span></span><span class="line"><span class="cl">        Update_k8s_container
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    rollback_last_version<span class="o">)</span>
</span></span><span class="line"><span class="cl">        rollback_last_version
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    *<span class="o">)</span>
</span></span><span class="line"><span class="cl">        usage
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    <span class="k">esac</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">main <span class="nv">$1</span> <span class="nv">$2</span> <span class="nv">$3</span></span></span></code></pre></div></div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="更新于 0001-01-01 00:00:00">更新于 0001-01-01&nbsp;</span>
      </div><div class="post-info-license">
          <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>
        </div></div>
    <div class="post-info-line">
      <div class="post-info-md"><span><a href="/posts/kubernetes/advanced/k8s%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%901/index.md" title="阅读原始文档" class="link-to-markdown">阅读原始文档</a></span></div>
      <div class="post-info-share">
        <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%901/" data-title=""><i class="fa-brands fa-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%901/"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 WhatsApp" data-sharer="whatsapp" data-url="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%901/" data-title="" data-web><i class="fa-brands fa-whatsapp fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%901/" data-title=""><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%901/" data-title=""><i class="fa-brands fa-weibo fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Myspace" data-sharer="myspace" data-url="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%901/" data-title="" data-description=""><i data-svg-src="/lib/simple-icons/icons/myspace.min.svg" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Blogger" data-sharer="blogger" data-url="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%901/" data-title="" data-description=""><i class="fa-brands fa-blogger fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Evernote" data-sharer="evernote" data-url="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%901/" data-title=""><i class="fa-brands fa-evernote fa-fw" aria-hidden="true"></i></a>
  </span>
      </div>
    </div>
  </div>

  <div class="post-info-more">
    <section class="post-tags"></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/kubernetes/advanced/k8s%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%902/" class="post-nav-item" rel="prev" title=""><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i></a>
      <a href="/posts/docker/%E6%9E%84%E5%BB%BAjdk17%E9%95%9C%E5%83%8F/" class="post-nav-item" rel="next" title=""><i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></main><footer class="footer">
    <div class="footer-container"><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2021 - 2023</span><span class="author" itemprop="copyrightHolder">
              <a href="https://github.com/ryanxin7"target="_blank" rel="external nofollow noopener noreferrer">Ryan</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div><div class="footer-line statistics"><span class="site-time" title='网站运行中……'><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden="true"></i><span class="run-times ms-1">网站运行中……</span></span></div><div class="footer-line visitor">
          <span id="busuanzi_container_site_uv" title='总访客数'><i class="fa-regular fa-user fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='总访问量'><i class="fa-regular fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><a href="https://github.com/ryanxin7" title="在 GitHub 上查看源代码"target="_blank" rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><div id="mask"></div><div class="reading-progress-bar" style="left: 0;top: 0;"></div><noscript>
    <div class="noscript-warning">FixIt 主题在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/algoliasearch/algoliasearch-lite.umd.min.js" defer></script><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async defer></script><script src="/lib/pace/pace.min.js" async defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","editLockTitle":"锁定可编辑代码块","editUnLockTitle":"解锁可编辑代码块","editable":true,"maxShownLines":80},"comment":{"enable":false},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验。"},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"enablePWA":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"HFAFNY4NX2","algoliaIndex":"xn-log","algoliaSearchKey":"bd08388586b2f88b20753c17c60ba92f","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"siteTime":"2021-09-09T09:09:09+09:00"};</script><script src="/js/theme.min.js" defer></script></body>
</html>
