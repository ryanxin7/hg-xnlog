<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>基于NFS Subdir External Provisioner插件提供K8S存储 - Ryan&#39;s Notebook</title><meta name="author" content="Ryan">
<meta name="author-link" content="https://github.com/ryanxin7">
<meta name="description" content="一、简介 NFS Subdir External Provisioner 是 Kubernetes 的一个外部存储供应者（External Provisioner），专门用于处理 NFS 存储卷的动态创建。 在 Kubernetes 中，存储供应者是一种" /><meta name="keywords" content='NFS Provisioner' /><meta itemprop="name" content="基于NFS Subdir External Provisioner插件提供K8S存储">
<meta itemprop="description" content="一、简介 NFS Subdir External Provisioner 是 Kubernetes 的一个外部存储供应者（External Provisioner），专门用于处理 NFS 存储卷的动态创建。 在 Kubernetes 中，存储供应者是一种"><meta itemprop="datePublished" content="2023-07-24T21:23:22+00:00" />
<meta itemprop="dateModified" content="2023-08-14T00:00:00+00:00" />
<meta itemprop="wordCount" content="4734"><meta itemprop="image" content="https://hg-xnlog.github.io/logo.png"/>
<meta itemprop="keywords" content="NFS Provisioner," /><meta property="og:title" content="基于NFS Subdir External Provisioner插件提供K8S存储" />
<meta property="og:description" content="一、简介 NFS Subdir External Provisioner 是 Kubernetes 的一个外部存储供应者（External Provisioner），专门用于处理 NFS 存储卷的动态创建。 在 Kubernetes 中，存储供应者是一种" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hg-xnlog.github.io/posts/kubernetes/primary/nfs-subdir-external-provisioner/" /><meta property="og:image" content="https://hg-xnlog.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-24T21:23:22+00:00" />
<meta property="article:modified_time" content="2023-08-14T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://hg-xnlog.github.io/logo.png"/>

<meta name="twitter:title" content="基于NFS Subdir External Provisioner插件提供K8S存储"/>
<meta name="twitter:description" content="一、简介 NFS Subdir External Provisioner 是 Kubernetes 的一个外部存储供应者（External Provisioner），专门用于处理 NFS 存储卷的动态创建。 在 Kubernetes 中，存储供应者是一种"/>
<meta name="application-name" content="Ryan’s Notebook">
<meta name="apple-mobile-web-app-title" content="Ryan’s Notebook"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://hg-xnlog.github.io/posts/kubernetes/primary/nfs-subdir-external-provisioner/" /><link rel="prev" href="https://hg-xnlog.github.io/posts/blog/%E4%BA%94%E8%8A%B1%E5%85%AB%E9%97%A8%E7%9A%84-markdown-admonitions/" /><link rel="next" href="https://hg-xnlog.github.io/posts/kubernetes/advanced/k8s-replace-nfs-storage/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "基于NFS Subdir External Provisioner插件提供K8S存储",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/hg-xnlog.github.io\/posts\/kubernetes\/primary\/nfs-subdir-external-provisioner\/"
    },"genre": "posts","keywords": "NFS Provisioner","wordcount":  4734 ,
    "url": "https:\/\/hg-xnlog.github.io\/posts\/kubernetes\/primary\/nfs-subdir-external-provisioner\/","datePublished": "2023-07-24T21:23:22+00:00","dateModified": "2023-08-14T00:00:00+00:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "Ryan"
      },"description": ""
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="wide"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper" data-github-corner="right">
    <div class="header-title">
      <a href="/" title="Ryan&#39;s Notebook"><img loading="lazy" src="/images/pow.png" srcset="/images/pow.png, /images/pow.png 1.5x, /images/pow.png 2x" sizes="auto" data-title="Ryan&#39;s Notebook" data-alt="Ryan&#39;s Notebook" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">Ryan’s Notebook</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 所有文章</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/friends/"
                title="友情链接"
                
              ><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden="true"></i> 友链</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/about/"
                
                
              ><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden="true"></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="搜索文章标题或内容……" id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="Ryan&#39;s Notebook"><img loading="lazy" src="/images/pow.png" srcset="/images/pow.png, /images/pow.png 1.5x, /images/pow.png 2x" sizes="auto" data-title="/images/pow.png" data-alt="/images/pow.png" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">Ryan’s Notebook</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="搜索文章标题或内容……" id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              取消
            </a>
          </li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 所有文章</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/friends/"
                  title="友情链接"
                  
                ><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden="true"></i> 友链</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/about/"
                  
                  
                ><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden="true"></i> 关于</a></li><li
              class="menu-item text-center"
            ><a
                  class="menu-link"
                  href="https://github.com/ryanxin7/hg-xnlog"
                  title="GitHub"
                  rel="noopener noreferrer" target="_blank"
                ><i class='fa-brands fa-github fa-fw' aria-hidden='true'></i> </a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="切换主题"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="container"><aside class="toc" id="toc-auto"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside>

  <aside class="aside-custom">
    </aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>基于NFS Subdir External Provisioner插件提供K8S存储</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><a href="https://github.com/ryanxin7" title="作者"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="/images/avatar.png" srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x" sizes="auto" data-title="Ryan" data-alt="Ryan" class="avatar" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/>&nbsp;Ryan</a></span>
          <span class="post-category">收录于 <a href="/categories/kubernetes/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> Kubernetes</a></span></div>
      <div class="post-meta-line"><span title="发布于 2023-07-24 21:23:22"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden="true"></i><time datetime="2023-07-24">2023-07-24</time></span>&nbsp;<span title="更新于 2023-08-14 00:00:00"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden="true"></i><time datetime="2023-08-14">2023-08-14</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>约 4734 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>预计阅读 10 分钟</span>&nbsp;<span id="busuanzi_container_page_pv" class="busuanzi_visitors comment-visitors" data-flag-title="基于NFS Subdir External Provisioner插件提供K8S存储">
            <i class="fa-regular fa-eye fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_page_pv">-</span>&nbsp;次阅读
          </span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#一简介">一、简介</a>
      <ul>
        <li><a href="#11-原理">1.1 原理</a></li>
        <li><a href="#12-作用">1.2 作用</a></li>
        <li><a href="#13-配置案例">1.3 配置案例</a></li>
        <li><a href="#14-storageclass-回收策略">1.4 StorageClass 回收策略</a></li>
      </ul>
    </li>
    <li><a href="#二实现基于nfs-subdir-external-provisioner插件提供k8s存储">二、实现基于NFS Subdir External Provisioner插件提供K8S存储</a>
      <ul>
        <li><a href="#1-搭建nfs服务器">1. 搭建NFS服务器</a></li>
        <li><a href="#2-修改-nfs-subdir-external-provisioner-chart文件">2. 修改 NFS Subdir External Provisioner chart文件</a></li>
        <li><a href="#3-实现helm本地自定义chart包上传到harbor保存">3. 实现helm本地自定义Chart包上传到harbor保存</a></li>
        <li><a href="#4-在k8s集群部署nfs-subdir-external-provisioner">4. 在K8S集群部署NFS Subdir External Provisioner</a></li>
        <li><a href="#5验证nfs动态存储类">5.验证NFS动态存储类</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><div class="details admonition note open">
      <div class="details-summary admonition-title">
        <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>注意<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
      </div>
      <div class="details-content">
        <div class="admonition-content">本文最后更新于 2023-08-14，文中内容可能已过时。</div>
      </div>
    </div><h2 id="一简介">一、简介</h2>
<p>NFS Subdir External Provisioner 是 Kubernetes 的一个外部存储供应者（External Provisioner），专门用于处理 NFS 存储卷的动态创建。</p>
<p>在 Kubernetes 中，存储供应者是一种机制，用于动态创建持久卷（Persistent Volumes）以及与之关联的持久卷声明（Persistent Volume Claims）。而外部存储供应者是指这样的供应者，它并非 Kubernetes 核心组件的一部分，而是由社区或第三方提供的插件。</p>
<p><strong>NFS-subdir-external-provisioner</strong>可动态为kubernetes提供pv卷，是Kubernetes的简易NFS的外部provisioner，本身不提供NFS，需要现有的NFS服务器提供存储。<!-- raw HTML omitted --></p>
<p>持久卷目录的命名规则为: <code>${namespace}-${pvcName}-${pvName}</code></p>
<h3 id="11-原理">1.1 原理</h3>
<p>NFS Subdir External Provisioner 通常与 Kubernetes 中的 StorageClass 一起使用。在 Kubernetes 中，StorageClass 是用于定义动态存储卷（PV）的模板的对象。StorageClass 允许管理员定义存储的属性，如访问模式、卷的大小和特定的存储插件（如 NFS Subdir External Provisioner）等。</p>
<p>NFS Subdir External Provisioner 通过 StorageClass 来配置其行为。在配置 StorageClass 时，你会指定 NFS Subdir External Provisioner 的相关信息，例如 NFS 服务器的地址、导出路径等。Pod 可以通过创建 Persistent Volume Claim（PVC）并引用这个 StorageClass 来请求动态分配的 NFS 存储。</p>
<h3 id="12-作用">1.2 作用</h3>
<p>NFS Subdir External Provisioner 的主要作用是简化 Kubernetes 中 NFS 存储的管理。它的名字中的 &ldquo;Subdir&rdquo; 意味着它会在 NFS 服务器的指定子目录中创建卷。它允许管理员通过定义简单的存储类（StorageClass）和持久卷声明（Persistent Volume Claims），而不必手动创建和管理 NFS 卷。</p>
<p>使用 <strong>Kubernetes NFS Subdir External Provisioner</strong> 插件对接后端NFS存储</p>
<p>项目地址:</p>
<p><a href="https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner/tree/master"target="_blank" rel="external nofollow noopener noreferrer">https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner/tree/master</a></p>
<h3 id="13-配置案例">1.3 配置案例</h3>
<p><code>nfs-client-speed.yaml</code> Kubernetes提供了一套可以自动创建PV的机制,即:Dynamic Provisioning.</p>
<p>而这个机制的核心在于:StorageClass这个API对象.</p>
<div class="highlight" id="id-1"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">nfs:
</span></span><span class="line"><span class="cl">  server: xxxxxxxxx.cn-beijing.extreme.nas.aliyuncs.com    <span class="c1">#NFS 服务器的主机名（必填）</span>
</span></span><span class="line"><span class="cl">  path: /share  <span class="c1">#要使用的挂载点的基本路径</span>
</span></span><span class="line"><span class="cl">  mountOptions: <span class="c1">#安装选项（例如“nfs.vers=3”）</span>
</span></span><span class="line"><span class="cl">    - <span class="nv">vers</span><span class="o">=</span><span class="m">3</span>
</span></span><span class="line"><span class="cl">    - noacl
</span></span><span class="line"><span class="cl">    - nolock
</span></span><span class="line"><span class="cl">    - <span class="nv">proto</span><span class="o">=</span>tcp
</span></span><span class="line"><span class="cl">    - <span class="nv">rsize</span><span class="o">=</span><span class="m">1048576</span>
</span></span><span class="line"><span class="cl">    - <span class="nv">wsize</span><span class="o">=</span><span class="m">1048576</span>
</span></span><span class="line"><span class="cl">    - hard
</span></span><span class="line"><span class="cl">    - <span class="nv">timeo</span><span class="o">=</span><span class="m">600</span>
</span></span><span class="line"><span class="cl">    - <span class="nv">retrans</span><span class="o">=</span><span class="m">2</span>
</span></span><span class="line"><span class="cl">    - noresvport
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">storageClass: 
</span></span><span class="line"><span class="cl">  name: nfs-client-speed  <span class="c1"># 存储类的名称</span>
</span></span><span class="line"><span class="cl">  defaultClass: <span class="nb">false</span> <span class="c1">#设置为默认 StorageClass</span>
</span></span><span class="line"><span class="cl">  allowVolumeExpansion: <span class="nb">true</span> <span class="c1">#允许扩大卷</span>
</span></span><span class="line"><span class="cl">  reclaimPolicy: Delete <span class="c1">#回收策略</span>
</span></span><span class="line"><span class="cl">  provisionerName: nfs-client-speed <span class="c1">#动态卷分配者名称，必须和创建的&#34;provisioner&#34;变量中设置的name一致</span>
</span></span><span class="line"><span class="cl">  archiveOnDelete: <span class="nb">true</span> <span class="c1">##设置为&#34;false&#34;时删除PVC不会保留数据,&#34;true&#34;则保留数据 </span></span></span></code></pre></div><h3 id="14-storageclass-回收策略">1.4 StorageClass 回收策略</h3>
<p>由 StorageClass 动态创建的 PersistentVolume 会在类的 <a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#reclaiming"target="_blank" rel="external nofollow noopener noreferrer">reclaimPolicy</a> 字段中指定回收策略，可以是 Delete 或者 Retain。 如果 StorageClass 对象被创建时没有指定 reclaimPolicy，它将默认为 Delete。</p>
<p><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/"target="_blank" rel="external nofollow noopener noreferrer">https://kubernetes.io/docs/concepts/storage/storage-classes/</a></p>
<p><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#reclaiming"target="_blank" rel="external nofollow noopener noreferrer">https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#reclaiming</a></p>
<h4 id="回收reclaiming">回收（Reclaiming）</h4>
<p>当用户不再使用其存储卷时，他们可以从 API 中将 PVC 对象删除， 从而允许该资源被回收再利用。PersistentVolume 对象的回收策略告诉集群， 当其被从申领中释放时如何处理该数据卷。 目前，数据卷可以被 Retained（保留）、Recycled（回收）或 Deleted（删除）。</p>
<h4 id="保留retain">保留（Retain）</h4>
<p>回收策略 Retain 使得用户可以手动回收资源。当 PersistentVolumeClaim 对象被删除时，PersistentVolume 卷仍然存在，对应的数据卷被视为&quot;已释放（released）&quot;。 由于卷上仍然存在这前一申领人的数据，该卷还不能用于其他申领。 管理员可以通过下面的步骤来手动回收该卷：</p>
<ol>
<li>删除 PersistentVolume 对象。与之相关的、位于外部基础设施中的存储资产 （例如 AWS EBS、GCE PD、Azure Disk 或 Cinder 卷）在 PV 删除之后仍然存在。</li>
<li>根据情况，手动清除所关联的存储资产上的数据。</li>
<li>手动删除所关联的存储资产。</li>
</ol>
<p>如果你希望重用该存储资产，可以基于存储资产的定义创建新的 PersistentVolume 卷对象。</p>
<h4 id="删除delete">删除（Delete）</h4>
<p>对于支持 Delete 回收策略的卷插件，删除动作会将 PersistentVolume 对象从 Kubernetes 中移除，同时也会从外部基础设施（如 AWS EBS、GCE PD、Azure Disk 或 Cinder 卷）中移除所关联的存储资产。 动态制备的卷会继承<a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#reclaim-policy"target="_blank" rel="external nofollow noopener noreferrer">其 StorageC</a><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#reclaim-policy"target="_blank" rel="external nofollow noopener noreferrer">lass 中设置的回收策略</a>， 该策略默认为 Delete。管理员需要根据用户的期望来配置 StorageClass； 否则 PV 卷被创建之后必须要被编辑或者修补。 参阅<a href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/change-pv-reclaim-policy/"target="_blank" rel="external nofollow noopener noreferrer">更改 PV 卷的回收策略</a>。</p>
<h2 id="二实现基于nfs-subdir-external-provisioner插件提供k8s存储">二、实现基于NFS Subdir External Provisioner插件提供K8S存储</h2>
<h3 id="1-搭建nfs服务器">1. 搭建NFS服务器</h3>
<div class="highlight" id="id-2"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt update
</span></span><span class="line"><span class="cl">sudo apt install nfs-kernel-server</span></span></code></pre></div><p>一旦安装完成， NFS 服务将会自动启动。</p>
<p>默认情况下，在 Ubuntu 18.04 上禁用 NFS 版本 2。 版本 3 和 4 已启用。 您可以通过运行以下 cat 命令来验证：</p>
<div class="highlight" id="id-3"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo cat /proc/fs/nfsd/versions
</span></span><span class="line"><span class="cl">-2 +3 +4 +4.1 +4.2</span></span></code></pre></div><h4 id="11-检查服务状态">1.1 检查服务状态</h4>
<p>使用下面命令检查nfs-server是否已经启动：</p>
<div class="highlight" id="id-4"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@fileServer:/srv# sudo systemctl status nfs-server
</span></span><span class="line"><span class="cl">● nfs-server.service - NFS server and services
</span></span><span class="line"><span class="cl">     Loaded: loaded <span class="o">(</span>/lib/systemd/system/nfs-server.service<span class="p">;</span> enabled<span class="p">;</span> vendor preset: enabled<span class="o">)</span>
</span></span><span class="line"><span class="cl">     Active: active <span class="o">(</span>exited<span class="o">)</span> since Sat 2023-03-25 13:15:36 CST<span class="p">;</span> <span class="m">3</span> months <span class="m">3</span> days ago
</span></span><span class="line"><span class="cl">   Main PID: <span class="m">534</span> <span class="o">(</span><span class="nv">code</span><span class="o">=</span>exited, <span class="nv">status</span><span class="o">=</span>0/SUCCESS<span class="o">)</span>
</span></span><span class="line"><span class="cl">      Tasks: <span class="m">0</span> <span class="o">(</span>limit: 4609<span class="o">)</span>
</span></span><span class="line"><span class="cl">     Memory: 0B
</span></span><span class="line"><span class="cl">     CGroup: /system.slice/nfs-server.service
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Mar <span class="m">25</span> 13:15:34 fileServer systemd<span class="o">[</span>1<span class="o">]</span>: Starting NFS server and services...
</span></span><span class="line"><span class="cl">Mar <span class="m">25</span> 13:15:36 fileServer systemd<span class="o">[</span>1<span class="o">]</span>: Finished NFS server and services.</span></span></code></pre></div><h4 id="12-创建nfs共享目录">1.2 创建NFS共享目录</h4>
<p>NFS 会将 <strong>client</strong> 上的任何 <strong>root</strong> 操作转换为 <code>nobody:nogroup</code> 凭据作为安全措施。因此,我们需要更改目录所有权以匹配这些凭据。</p>
<div class="highlight" id="id-5"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir /nfs-server
</span></span><span class="line"><span class="cl">chown nobody:nogroup /nfs-server
</span></span><span class="line"><span class="cl">chmod <span class="m">755</span> /nfs-server</span></span></code></pre></div><h4 id="13-发布共享目录">1.3 发布共享目录</h4>
<p>通过编辑<code>/etc/exports</code>配置文件，来允许哪些客户端可以访问该共享。</p>
<div class="highlight" id="id-6"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">vim /etc/exports
</span></span><span class="line"><span class="cl">/nfs-server  *<span class="o">(</span>rw,sync,no_subtree_check,insecure,no_root_squash<span class="o">)</span></span></span></code></pre></div><p>配置文件中的权限解释：<img loading="lazy" src="https://cdn1.ryanxin.live/1687918792849-fd5dd6db-e1b3-4ed8-b7dc-573208f425a0.png" srcset="https://cdn1.ryanxin.live/1687918792849-fd5dd6db-e1b3-4ed8-b7dc-573208f425a0.png, https://cdn1.ryanxin.live/1687918792849-fd5dd6db-e1b3-4ed8-b7dc-573208f425a0.png 1.5x, https://cdn1.ryanxin.live/1687918792849-fd5dd6db-e1b3-4ed8-b7dc-573208f425a0.png 2x" sizes="auto" data-title="eba3c43b08c94377b44465059a0a7bb3.png" data-alt="eba3c43b08c94377b44465059a0a7bb3.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>使用下面命令将共享文件夹启用并生效：</p>
<div class="highlight" id="id-7"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">exportfs -arv
</span></span><span class="line"><span class="cl">exporting *:/nfs-server</span></span></code></pre></div><div class="highlight" id="id-8"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 查看NFS服务端状态</span>
</span></span><span class="line"><span class="cl">nfsstat -s
</span></span><span class="line"><span class="cl"><span class="c1"># 查看NFS客户端状态</span>
</span></span><span class="line"><span class="cl">nfsstat -c
</span></span><span class="line"><span class="cl"><span class="c1"># 查看服务端和客户端状态</span>
</span></span><span class="line"><span class="cl">nfsstat</span></span></code></pre></div><h4 id="14-配置客户端">1.4 配置客户端</h4>
<div class="highlight" id="id-9"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 在Ubuntu20.04中安装客户端：nfs-common</span>
</span></span><span class="line"><span class="cl">bob@ubuntu-20-04:~$ sudo apt install nfs-common
</span></span><span class="line"><span class="cl"><span class="c1"># 在Centos8中安装客户端：nfs-utils</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># yum -y install nfs-utils</span></span></span></code></pre></div><p>使用<code>**showmount -e**</code>**查看是否可以看到共享目录：</p>
<div class="highlight" id="id-10"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@k8s-w-04-35:~# showmount -e 192.168.10.26
</span></span><span class="line"><span class="cl">Export list <span class="k">for</span> 192.168.10.26:
</span></span><span class="line"><span class="cl">/nfs-server *</span></span></code></pre></div><h4 id="15-测试挂载">1.5 测试挂载</h4>
<div class="highlight" id="id-11"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir -p /mnt/test
</span></span><span class="line"><span class="cl">mount -t nfs nfs-server:/nfs-server /mnt/test</span></span></code></pre></div><h3 id="2-修改-nfs-subdir-external-provisioner-chart文件">2. 修改 NFS Subdir External Provisioner chart文件</h3>
<p>helm hub地址：<a href="https://artifacthub.io/packages/helm/nfs-subdir-external-provisioner/nfs-subdir-external-provisioner"target="_blank" rel="external nofollow noopener noreferrer">https://artifacthub.io/packages/helm/nfs-subdir-external-provisioner/nfs-subdir-external-provisioner</a></p>
<h4 id="21-安装helm">2.1 安装helm</h4>
<ol>
<li>选择下载版本 <a href="https://github.com/helm/helm/releases"target="_blank" rel="external nofollow noopener noreferrer">https://github.com/helm/helm/releases</a></li>
<li>解压</li>
<li>在解压目录中找到helm程序，移动到需要的目录中</li>
</ol>
<div class="highlight" id="id-12"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@k8s-made-01-32:/softs# tar -zxvf  helm-v3.11.3-linux-amd64.tar.gz
</span></span><span class="line"><span class="cl">linux-amd64/
</span></span><span class="line"><span class="cl">linux-amd64/LICENSE
</span></span><span class="line"><span class="cl">linux-amd64/README.md
</span></span><span class="line"><span class="cl">linux-amd64/helm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mv linux-amd64/helm /usr/local/bin/helm
</span></span><span class="line"><span class="cl"><span class="c1">#查看版本</span>
</span></span><span class="line"><span class="cl">root@k8s-made-01-32:/softs# helm version
</span></span><span class="line"><span class="cl">version.BuildInfo<span class="o">{</span>Version:<span class="s2">&#34;v3.11.3&#34;</span>, GitCommit:<span class="s2">&#34;323249351482b3bbfc9f5004f65d400aa70f9ae7&#34;</span>, GitTreeState:<span class="s2">&#34;clean&#34;</span>, GoVersion:<span class="s2">&#34;go1.20.3&#34;</span><span class="o">}</span></span></span></code></pre></div><h4 id="22-helm方式">2.2 Helm方式</h4>
<p>添加helm仓库</p>
<div class="highlight" id="id-13"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ helm repo add nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner/</span></span></code></pre></div><p>使用 <code>helm search repo</code> 命令，你可以从你所添加的仓库中查找chart的名字</p>
<div class="highlight" id="id-14"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@k8s-made-01-32:/softs# helm search repo nfs-subdir-external-provisioner
</span></span><span class="line"><span class="cl">NAME                                                    CHART VERSION   APP VERSION     DESCRIPTION
</span></span><span class="line"><span class="cl">nfs-subdir-external-provisioner/nfs-subdir-exte...      4.0.18          4.0.2           nfs-subdir-external-provisioner is an automatic...</span></span></code></pre></div><p>从仓库下载并（可选）在本地目录解压。</p>
<div class="highlight" id="id-15"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># helm pull [chart URL | repo/chartname] [...] [flags]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 仅下载</span>
</span></span><span class="line"><span class="cl">helm pull nfs-subdir-external-provisioner/nfs-subdir-external-provisioner
</span></span><span class="line"><span class="cl"><span class="c1"># 下载并解压到当前目录</span>
</span></span><span class="line"><span class="cl">helm pull nfs-subdir-external-provisioner/nfs-subdir-external-provisioner --untar</span></span></code></pre></div><h4 id="23-比对rmxc和官方chart包">2.3 比对rmxc和官方chart包</h4>
<div class="highlight" id="id-16"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@k8s-made-01-32:/softs# tree nfs-subdir-external-provisioner/
</span></span><span class="line"><span class="cl">nfs-subdir-external-provisioner/
</span></span><span class="line"><span class="cl">├── Chart.yaml
</span></span><span class="line"><span class="cl">├── ci
</span></span><span class="line"><span class="cl">│   └── test-values.yaml
</span></span><span class="line"><span class="cl">├── README.md
</span></span><span class="line"><span class="cl">├── templates
</span></span><span class="line"><span class="cl">│   ├── clusterrolebinding.yaml
</span></span><span class="line"><span class="cl">│   ├── clusterrole.yaml
</span></span><span class="line"><span class="cl">│   ├── deployment.yaml
</span></span><span class="line"><span class="cl">│   ├── _helpers.tpl
</span></span><span class="line"><span class="cl">│   ├── persistentvolumeclaim.yaml
</span></span><span class="line"><span class="cl">│   ├── persistentvolume.yaml
</span></span><span class="line"><span class="cl">│   ├── poddisruptionbudget.yaml
</span></span><span class="line"><span class="cl">│   ├── podsecuritypolicy.yaml
</span></span><span class="line"><span class="cl">│   ├── rolebinding.yaml
</span></span><span class="line"><span class="cl">│   ├── role.yaml
</span></span><span class="line"><span class="cl">│   ├── serviceaccount.yaml
</span></span><span class="line"><span class="cl">│   └── storageclass.yaml
</span></span><span class="line"><span class="cl">└── values.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">tree rmxc/nfs-subdir-external-provisioner/
</span></span><span class="line"><span class="cl">nfs-subdir-external-provisioner/
</span></span><span class="line"><span class="cl">├── Chart.yaml
</span></span><span class="line"><span class="cl">├── ci
</span></span><span class="line"><span class="cl">│   └── test-values.yaml
</span></span><span class="line"><span class="cl">├── README.md
</span></span><span class="line"><span class="cl">├── templates
</span></span><span class="line"><span class="cl">│   ├── clusterrolebinding.yaml
</span></span><span class="line"><span class="cl">│   ├── clusterrole.yaml
</span></span><span class="line"><span class="cl">│   ├── deployment.yaml
</span></span><span class="line"><span class="cl">│   ├── _helpers.tpl
</span></span><span class="line"><span class="cl">│   ├── persistentvolumeclaim.yaml
</span></span><span class="line"><span class="cl">│   ├── persistentvolume.yaml
</span></span><span class="line"><span class="cl">│   ├── podsecuritypolicy.yaml
</span></span><span class="line"><span class="cl">│   ├── rolebinding.yaml
</span></span><span class="line"><span class="cl">│   ├── role.yaml
</span></span><span class="line"><span class="cl">│   ├── serviceaccount.yaml
</span></span><span class="line"><span class="cl">│   └── storageclass.yaml
</span></span><span class="line"><span class="cl">└── values.yaml</span></span></code></pre></div><div class="highlight" id="id-17"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">helm repo add --username<span class="o">=</span>zxx --password<span class="o">=</span><span class="s2">&#34;xxxxxxxxxxx&#34;</span> rmxc https://harbor.rmxc.tech/chartrepo/charts
</span></span><span class="line"><span class="cl"><span class="s2">&#34;rmxc&#34;</span> has been added to your repositories
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root@k8s-made-01-32:/softs/nfs-subdir-external-provisioner# helm search repo rmxc
</span></span><span class="line"><span class="cl">NAME                                    CHART VERSION   APP VERSION     DESCRIPTION
</span></span><span class="line"><span class="cl">rmxc/app-chart                          0.1.0           0.0.1           A Helm chart <span class="k">for</span> applications with log direcotr...
</span></span><span class="line"><span class="cl">rmxc/clickhouse                         0.1.0           <span class="m">1</span>               deploy clickhouse on kubernetes
</span></span><span class="line"><span class="cl">rmxc/descheduler                        0.23.1          0.23.0          Descheduler <span class="k">for</span> Kubernetes is used to rebalance...
</span></span><span class="line"><span class="cl">rmxc/harbor                             1.7.0           2.3.0           An open <span class="nb">source</span> trusted cloud native registry th...
</span></span><span class="line"><span class="cl">rmxc/ingress-nginx                      4.1.4           1.2.1           Ingress controller <span class="k">for</span> Kubernetes using NGINX a...
</span></span><span class="line"><span class="cl">rmxc/mysql                              0.1.0           <span class="m">1</span>               deploy mysql on kubernetes
</span></span><span class="line"><span class="cl">rmxc/mysql57                            0.1.0           5.7             deploy mysql-5.7 on kubernetes
</span></span><span class="line"><span class="cl">rmxc/nfs-subdir-external-provisioner    4.0.16          4.0.2           nfs-subdir-external-provisioner is an automatic...
</span></span><span class="line"><span class="cl">rmxc/redis                              0.1.0           <span class="m">1</span>               deploy redis on kubernetes
</span></span><span class="line"><span class="cl">rmxc/springboot-chart                   0.1.0           0.0.1           A Helm chart <span class="k">for</span> Spring Boot applications
</span></span><span class="line"><span class="cl">rmxc/springboot-jib-chart               0.1.0           0.0.1           A Helm chart <span class="k">for</span> Spring Boot applications
</span></span><span class="line"><span class="cl">rmxc/zookeeper                          7.0.4           3.7.0           A centralized service <span class="k">for</span> maintaining configura...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">helm pull rmxc/nfs-subdir-external-provisioner --untar</span></span></code></pre></div><h4 id="24-安装前自定义-chart">2.4 安装前自定义 chart</h4>
<div class="highlight" id="id-18"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@k8s-made-01-32:/softs# helm show values nfs-subdir-external-provisioner/nfs-subdir-external-provisioner
</span></span><span class="line"><span class="cl">replicaCount: <span class="m">1</span>
</span></span><span class="line"><span class="cl">strategyType: Recreate
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">image:
</span></span><span class="line"><span class="cl">  repository: registry.k8s.io/sig-storage/nfs-subdir-external-provisioner
</span></span><span class="line"><span class="cl">  tag: v4.0.2
</span></span><span class="line"><span class="cl">  pullPolicy: IfNotPresent
</span></span><span class="line"><span class="cl">imagePullSecrets: <span class="o">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">nfs:
</span></span><span class="line"><span class="cl">  server:
</span></span><span class="line"><span class="cl">  path: /nfs-storage
</span></span><span class="line"><span class="cl">  mountOptions:
</span></span><span class="line"><span class="cl">  volumeName: nfs-subdir-external-provisioner-root
</span></span><span class="line"><span class="cl">  <span class="c1"># Reclaim policy for the main nfs volume</span>
</span></span><span class="line"><span class="cl">  reclaimPolicy: Retain
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># For creating the StorageClass automatically:</span>
</span></span><span class="line"><span class="cl">storageClass:
</span></span><span class="line"><span class="cl">  create: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Set a provisioner name. If unset, a name will be generated.</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># provisionerName:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Set StorageClass as the default StorageClass</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># Ignored if storageClass.create is false</span>
</span></span><span class="line"><span class="cl">  defaultClass: <span class="nb">false</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Set a StorageClass name</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># Ignored if storageClass.create is false</span>
</span></span><span class="line"><span class="cl">  name: nfs-client
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Allow volume to be expanded dynamically</span>
</span></span><span class="line"><span class="cl">  allowVolumeExpansion: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Method used to reclaim an obsoleted volume</span>
</span></span><span class="line"><span class="cl">  reclaimPolicy: Delete
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># When set to false your PVs will not be archived by the provisioner upon deletion of the PVC.</span>
</span></span><span class="line"><span class="cl">  archiveOnDelete: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># If it exists and has &#39;delete&#39; value, delete the directory. If it exists and has &#39;retain&#39; value, save the directory.</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># Overrides archiveOnDelete.</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># Ignored if value not set.</span>
</span></span><span class="line"><span class="cl">  onDelete:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Specifies a template for creating a directory path via PVC metadata&#39;s such as labels, annotations, name or namespace.</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># Ignored if value not set.</span>
</span></span><span class="line"><span class="cl">  pathPattern:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Set access mode - ReadWriteOnce, ReadOnlyMany or ReadWriteMany</span>
</span></span><span class="line"><span class="cl">  accessModes: ReadWriteOnce
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Set volume bindinng mode - Immediate or WaitForFirstConsumer</span>
</span></span><span class="line"><span class="cl">  volumeBindingMode: Immediate
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Storage class annotations</span>
</span></span><span class="line"><span class="cl">  annotations: <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">leaderElection:
</span></span><span class="line"><span class="cl">  <span class="c1"># When set to false leader election will be disabled</span>
</span></span><span class="line"><span class="cl">  enabled: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## For RBAC support:</span>
</span></span><span class="line"><span class="cl">rbac:
</span></span><span class="line"><span class="cl">  <span class="c1"># Specifies whether RBAC resources should be created</span>
</span></span><span class="line"><span class="cl">  create: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># If true, create &amp; use Pod Security Policy resources</span>
</span></span><span class="line"><span class="cl"><span class="c1"># https://kubernetes.io/docs/concepts/policy/pod-security-policy/</span>
</span></span><span class="line"><span class="cl">podSecurityPolicy:
</span></span><span class="line"><span class="cl">  enabled: <span class="nb">false</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Deployment pod annotations</span>
</span></span><span class="line"><span class="cl">podAnnotations: <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## Set pod priorityClassName</span>
</span></span><span class="line"><span class="cl"><span class="c1"># priorityClassName: &#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">podSecurityContext: <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">securityContext: <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">serviceAccount:
</span></span><span class="line"><span class="cl">  <span class="c1"># Specifies whether a ServiceAccount should be created</span>
</span></span><span class="line"><span class="cl">  create: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Annotations to add to the service account</span>
</span></span><span class="line"><span class="cl">  annotations: <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># The name of the ServiceAccount to use.</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># If not set and create is true, a name is generated using the fullname template</span>
</span></span><span class="line"><span class="cl">  name:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">resources: <span class="o">{}</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># limits:</span>
</span></span><span class="line"><span class="cl">  <span class="c1">#  cpu: 100m</span>
</span></span><span class="line"><span class="cl">  <span class="c1">#  memory: 128Mi</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># requests:</span>
</span></span><span class="line"><span class="cl">  <span class="c1">#  cpu: 100m</span>
</span></span><span class="line"><span class="cl">  <span class="c1">#  memory: 128Mi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">nodeSelector: <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">tolerations: <span class="o">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">affinity: <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Additional labels for any resource created</span>
</span></span><span class="line"><span class="cl">labels: <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">podDisruptionBudget:
</span></span><span class="line"><span class="cl">  enabled: <span class="nb">false</span>
</span></span><span class="line"><span class="cl">  maxUnavailable: <span class="m">1</span></span></span></code></pre></div><p>经过对比信产chart包只修改了镜像地址为信产的harbor仓库</p>
<p>修改**nfs-subdir-external-provisioner **chart包的<code>values.yaml</code>文件中的镜像地址为私有仓库的镜像地址</p>
<div class="highlight" id="id-19"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">registry.k8s.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2
</span></span><span class="line"><span class="cl">harbor.ceamg.com/k8s-base/nfs-subdir-external-provisioner:v4.0.2</span></span></code></pre></div><h3 id="3-实现helm本地自定义chart包上传到harbor保存">3. 实现helm本地自定义Chart包上传到harbor保存</h3>
<p><a href="https://cloud.tencent.com/developer/article/2295992"target="_blank" rel="external nofollow noopener noreferrer">https://cloud.tencent.com/developer/article/2295992</a></p>
<h4 id="31-harbor开启支持helm-chart">3.1 harbor开启支持helm chart</h4>
<p>1、修改harbor配置文件</p>
<div class="highlight" id="id-20"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 将absolute_url的值更改为enabled可以在图表中启用绝对url</span>
</span></span><span class="line"><span class="cl">vim harbor.yml
</span></span><span class="line"><span class="cl">chart:
</span></span><span class="line"><span class="cl">  <span class="c1"># Change the value of absolute_url to enabled can enable absolute url in chart</span>
</span></span><span class="line"><span class="cl">  absolute_url: enabled</span></span></code></pre></div><h4 id="32-停止harbor服务">3.2 停止harbor服务</h4>
<div class="highlight" id="id-21"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker-compose stop</span></span></code></pre></div><h4 id="33--注入配置">3.3  注入配置</h4>
<div class="highlight" id="id-22"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./prepare </span></span></code></pre></div><h4 id="34-安装chartmuseum">3.4 安装chartmuseum</h4>
<p>在执行install.sh安装脚本时，通过<code>--with-chartmuseum</code>参数安装chart插件。</p>
<div class="highlight" id="id-23"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./install.sh  --with-notary --with-trivy --with-chartmuseum</span></span></code></pre></div><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2023/png/33538388/1688021188616-50ea6fde-cb14-4acd-b6e5-0bd6fdb0e556.png#averageHue=%23f7f7f7&amp;clientId=uec2f54c9-a53d-4&amp;from=paste&amp;height=859&amp;id=u67a118ba&amp;originHeight=859&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=76997&amp;status=done&amp;style=none&amp;taskId=u67ddd064-fcd8-4531-8fdd-5114a423318&amp;title=&amp;width=1920" srcset="https://cdn.nlark.com/yuque/0/2023/png/33538388/1688021188616-50ea6fde-cb14-4acd-b6e5-0bd6fdb0e556.png#averageHue=%23f7f7f7&amp;clientId=uec2f54c9-a53d-4&amp;from=paste&amp;height=859&amp;id=u67a118ba&amp;originHeight=859&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=76997&amp;status=done&amp;style=none&amp;taskId=u67ddd064-fcd8-4531-8fdd-5114a423318&amp;title=&amp;width=1920, https://cdn.nlark.com/yuque/0/2023/png/33538388/1688021188616-50ea6fde-cb14-4acd-b6e5-0bd6fdb0e556.png#averageHue=%23f7f7f7&amp;clientId=uec2f54c9-a53d-4&amp;from=paste&amp;height=859&amp;id=u67a118ba&amp;originHeight=859&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=76997&amp;status=done&amp;style=none&amp;taskId=u67ddd064-fcd8-4531-8fdd-5114a423318&amp;title=&amp;width=1920 1.5x, https://cdn.nlark.com/yuque/0/2023/png/33538388/1688021188616-50ea6fde-cb14-4acd-b6e5-0bd6fdb0e556.png#averageHue=%23f7f7f7&amp;clientId=uec2f54c9-a53d-4&amp;from=paste&amp;height=859&amp;id=u67a118ba&amp;originHeight=859&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=76997&amp;status=done&amp;style=none&amp;taskId=u67ddd064-fcd8-4531-8fdd-5114a423318&amp;title=&amp;width=1920 2x" sizes="auto" data-title="image.png" data-alt="image.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h4 id="35-添加harbor作为chart仓库">3.5 添加harbor作为chart仓库</h4>
<p>创建用户</p>
<div class="highlight" id="id-24"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">xceo
</span></span><span class="line"><span class="cl"><span class="nv">2q</span><span class="o">=</span>~Dc8<span class="nv">$DUg</span>~Qcq</span></span></code></pre></div><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2023/png/33538388/1688025574214-f58b9a1f-5aa1-49f4-a8ad-7782ee04565c.png#averageHue=%23fdfdfd&amp;clientId=uec2f54c9-a53d-4&amp;from=paste&amp;height=473&amp;id=u748665aa&amp;originHeight=473&amp;originWidth=568&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=16120&amp;status=done&amp;style=none&amp;taskId=u20fc3dd4-9edd-4d31-ab8b-25a7bc9d877&amp;title=&amp;width=568" srcset="https://cdn.nlark.com/yuque/0/2023/png/33538388/1688025574214-f58b9a1f-5aa1-49f4-a8ad-7782ee04565c.png#averageHue=%23fdfdfd&amp;clientId=uec2f54c9-a53d-4&amp;from=paste&amp;height=473&amp;id=u748665aa&amp;originHeight=473&amp;originWidth=568&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=16120&amp;status=done&amp;style=none&amp;taskId=u20fc3dd4-9edd-4d31-ab8b-25a7bc9d877&amp;title=&amp;width=568, https://cdn.nlark.com/yuque/0/2023/png/33538388/1688025574214-f58b9a1f-5aa1-49f4-a8ad-7782ee04565c.png#averageHue=%23fdfdfd&amp;clientId=uec2f54c9-a53d-4&amp;from=paste&amp;height=473&amp;id=u748665aa&amp;originHeight=473&amp;originWidth=568&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=16120&amp;status=done&amp;style=none&amp;taskId=u20fc3dd4-9edd-4d31-ab8b-25a7bc9d877&amp;title=&amp;width=568 1.5x, https://cdn.nlark.com/yuque/0/2023/png/33538388/1688025574214-f58b9a1f-5aa1-49f4-a8ad-7782ee04565c.png#averageHue=%23fdfdfd&amp;clientId=uec2f54c9-a53d-4&amp;from=paste&amp;height=473&amp;id=u748665aa&amp;originHeight=473&amp;originWidth=568&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=16120&amp;status=done&amp;style=none&amp;taskId=u20fc3dd4-9edd-4d31-ab8b-25a7bc9d877&amp;title=&amp;width=568 2x" sizes="auto" data-title="image.png" data-alt="image.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<div class="highlight" id="id-25"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#登录harbor私有仓库</span>
</span></span><span class="line"><span class="cl">root@k8s-made-01-32:/chart# <span class="nv">HELM_EXPERIMENTAL_OCI</span><span class="o">=</span><span class="m">3</span> helm registry login -u xceo https://harbor.ceamg.com/chartrepo/chart -p Ceamg.com1234 --ca-file /etc/containerd/certs.d/harbor.ceamg.com/ca.crt  --cert-file  /etc/containerd/certs.d/harbor.ceamg.com/harbor.ceamg.com.crt --key-file /etc/containerd/certs.d/harbor.ceamg.com/harbor.ceamg.com.key
</span></span><span class="line"><span class="cl">WARNING: Using --password via the CLI is insecure. Use --password-stdin.
</span></span><span class="line"><span class="cl">Login Succeeded</span></span></code></pre></div><div class="highlight" id="id-26"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#添加harbor私有仓库</span>
</span></span><span class="line"><span class="cl">helm repo add --username<span class="o">=</span>xceo --password<span class="o">=</span>Ceamg.com1234 ceamg https://harbor.ceamg.com/chartrepo/chart <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--ca-file /etc/containerd/certs.d/harbor.ceamg.com/ca.crt <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--cert-file  /etc/containerd/certs.d/harbor.ceamg.com/harbor.ceamg.com.crt <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--key-file /etc/containerd/certs.d/harbor.ceamg.com/harbor.ceamg.com.key
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s2">&#34;ceamg&#34;</span> has been added to your repositories</span></span></code></pre></div><div class="highlight" id="id-27"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#查看当前repo仓库</span>
</span></span><span class="line"><span class="cl">root@k8s-made-01-32:/chart# helm repo list
</span></span><span class="line"><span class="cl">NAME                            URL
</span></span><span class="line"><span class="cl">nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner/
</span></span><span class="line"><span class="cl">rmxc                            https://harbor.rmxc.tech/chartrepo/charts
</span></span><span class="line"><span class="cl">ceamg                           https://harbor.ceamg.com/chartrepo/chart</span></span></code></pre></div><h4 id="36-打包chart-并发布到私有habor仓库中">3.6 打包chart 并发布到私有habor仓库中</h4>
<div class="highlight" id="id-28"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#打包chart</span>
</span></span><span class="line"><span class="cl">helm package nfs-subdir-external-provisioner </span></span></code></pre></div><p><img loading="lazy" src="https://cdn1.ryanxin.live/1688092478072-a7c0bbd7-dd48-4fd2-8142-74e73673355d.png" srcset="https://cdn1.ryanxin.live/1688092478072-a7c0bbd7-dd48-4fd2-8142-74e73673355d.png, https://cdn1.ryanxin.live/1688092478072-a7c0bbd7-dd48-4fd2-8142-74e73673355d.png 1.5x, https://cdn1.ryanxin.live/1688092478072-a7c0bbd7-dd48-4fd2-8142-74e73673355d.png 2x" sizes="auto" data-title="image.png" data-alt="image.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>查看文件<img loading="lazy" src="https://cdn1.ryanxin.live/1688092422149-fee14d56-c703-4523-8aaf-aa6b6a1b4867.png" srcset="https://cdn1.ryanxin.live/1688092422149-fee14d56-c703-4523-8aaf-aa6b6a1b4867.png, https://cdn1.ryanxin.live/1688092422149-fee14d56-c703-4523-8aaf-aa6b6a1b4867.png 1.5x, https://cdn1.ryanxin.live/1688092422149-fee14d56-c703-4523-8aaf-aa6b6a1b4867.png 2x" sizes="auto" data-title="image.png" data-alt="image.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<div class="highlight" id="id-29"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ helm install nfs-subdir-external-provisioner nfs-subdir-external-provisioner/nfs-subdir-external-provisioner <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --set nfs.server<span class="o">=</span>x.x.x.x <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --set nfs.path<span class="o">=</span>/exported/path</span></span></code></pre></div><h3 id="4-在k8s集群部署nfs-subdir-external-provisioner">4. 在K8S集群部署NFS Subdir External Provisioner</h3>
<h4 id="41-添加私有chartrepo仓库">4.1 添加私有chartrepo仓库</h4>
<div class="highlight" id="id-30"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">helm repo add --username<span class="o">=</span>xceo --password<span class="o">=</span>Ceamg.com1234 ceamg https://harbor.ceamg.com/chartrepo/chart <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--ca-file /etc/containerd/certs.d/harbor.ceamg.com/ca.crt <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--cert-file  /etc/containerd/certs.d/harbor.ceamg.com/harbor.ceamg.com.crt <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--key-file /etc/containerd/certs.d/harbor.ceamg.com/harbor.ceamg.com.key
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s2">&#34;ceamg&#34;</span> has been added to your repositories</span></span></code></pre></div><h4 id="42-新建nfs服务器values文件">4.2 新建NFS服务器Values文件</h4>
<div class="highlight" id="id-31"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">nfs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="m">192.168.10.26</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/nfs-server/k8s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">mountOptions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">vers=4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">minorversion=0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">rsize=1048576</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">wsize=1048576</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">hard</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">timeo=600</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">retrans=2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">noresvport</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">storageClass</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">defaultClass</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">allowVolumeExpansion</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">reclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Delete</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">provisionerName</span><span class="p">:</span><span class="w"> </span><span class="l">nfs-client</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">archiveOnDelete</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span></span></span></code></pre></div><h4 id="43-helm安装自定义的chart包">4.3 helm安装自定义的Chart包</h4>
<div class="highlight" id="id-32"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">helm install -n kube-system -f nfs-client.values.yaml nfs-client ceamg/nfs-subdir-external-provisioner
</span></span><span class="line"><span class="cl"><span class="c1">#-n 命名空间</span>
</span></span><span class="line"><span class="cl"><span class="c1">#-f 指定values文件</span>
</span></span><span class="line"><span class="cl"><span class="c1">#nfs-client helm项目名字</span>
</span></span><span class="line"><span class="cl"><span class="c1"># rmxc/nfs-subdir-external-provisioner CHART文件</span></span></span></code></pre></div><h4 id="44-查看组件pod状态">4.4 查看组件pod状态</h4>
<div class="highlight" id="id-33"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@k8s-made-01-32:/softs# helm  <span class="nb">history</span> -n kube-system nfs-client
</span></span><span class="line"><span class="cl">REVISION        UPDATED                         STATUS          CHART                                   APP VERSION     DESCRIPTION
</span></span><span class="line"><span class="cl"><span class="m">1</span>               Fri Jun <span class="m">30</span> 10:59:03 <span class="m">2023</span>        deployed        nfs-subdir-external-provisioner-4.0.18  4.0.2           Install complete</span></span></code></pre></div><div class="highlight" id="id-34"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@k8s-made-01-32:/softs# kubectl get pod -n kube-system
</span></span><span class="line"><span class="cl">NAME                                                         READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">calico-kube-controllers-7bbb6b796b-chx8p                     1/1     Running   <span class="m">0</span>          15d
</span></span><span class="line"><span class="cl">calico-node-2fq2b                                            1/1     Running   <span class="m">0</span>          15d
</span></span><span class="line"><span class="cl">calico-node-6qdd4                                            1/1     Running   <span class="m">0</span>          15d
</span></span><span class="line"><span class="cl">calico-node-6qgk7                                            1/1     Running   <span class="m">0</span>          15d
</span></span><span class="line"><span class="cl">calico-node-86j52                                            1/1     Running   <span class="m">0</span>          15d
</span></span><span class="line"><span class="cl">calico-node-rv7rt                                            1/1     Running   <span class="m">0</span>          15d
</span></span><span class="line"><span class="cl">coredns-6665999d97-vvkk4                                     1/1     Running   <span class="m">0</span>          15d
</span></span><span class="line"><span class="cl">dashboard-metrics-scraper-57566685b4-zb2m5                   1/1     Running   <span class="m">0</span>          15d
</span></span><span class="line"><span class="cl">kubernetes-dashboard-57db9bfd5b-dx8fz                        1/1     Running   <span class="m">0</span>          15d
</span></span><span class="line"><span class="cl">metrics-server-6bd9f986fc-6qlq8                              1/1     Running   <span class="m">0</span>          15d
</span></span><span class="line"><span class="cl">nfs-client-nfs-subdir-external-provisioner-b64b4fbf9-z6x4w   1/1     Running   <span class="m">0</span>          3m22s
</span></span><span class="line"><span class="cl">node-local-dns-9g2kr                                         1/1     Running   <span class="m">0</span>          15d
</span></span><span class="line"><span class="cl">node-local-dns-9v4dw                                         1/1     Running   <span class="m">0</span>          15d
</span></span><span class="line"><span class="cl">node-local-dns-pt6r8                                         1/1     Running   <span class="m">0</span>          15d
</span></span><span class="line"><span class="cl">node-local-dns-tgqjr                                         1/1     Running   <span class="m">0</span>          15d
</span></span><span class="line"><span class="cl">node-local-dns-xkzms                                         1/1     Running   <span class="m">0</span>          15d</span></span></code></pre></div><div class="highlight" id="id-35"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@k8s-made-01-32:/softs# kubectl get sc
</span></span><span class="line"><span class="cl">NAME                   PROVISIONER   RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
</span></span><span class="line"><span class="cl">nfs-client <span class="o">(</span>default<span class="o">)</span>   nfs-client    Delete          Immediate           <span class="nb">true</span>                   4m8s</span></span></code></pre></div><h3 id="5验证nfs动态存储类">5.验证NFS动态存储类</h3>
<h4 id="51-创建wordpress应用进行验证">5.1 创建wordpress应用进行验证</h4>
<p>示例1：创建一个wordpress应用进行验证，其中wordpress以及mariadb引用了持久化存储</p>
<div class="highlight" id="id-36"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">helm repo add bitnami https://charts.bitnami.com/bitnami
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">helm install wordpress bitnami/wordpress <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --namespace<span class="o">=</span>wordpress <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --create-namespace <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set global.storageClass<span class="o">=</span>nfs-client <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set <span class="nv">wordpressUsername</span><span class="o">=</span>admin <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set <span class="nv">wordpressPassword</span><span class="o">=</span>H6ZPTRoUsR7Ln3vQa<span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set <span class="nv">replicaCount</span><span class="o">=</span><span class="m">2</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set service.type<span class="o">=</span>NodePort <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set service.nodePorts.http<span class="o">=</span><span class="m">30808</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set persistence.enabled<span class="o">=</span><span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set persistence.size<span class="o">=</span>100Gi <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set volumePermissions.enabled<span class="o">=</span><span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set mariadb.enabled<span class="o">=</span><span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set mariadb.architecture<span class="o">=</span>standalone <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set mariadb.auth.rootPassword<span class="o">=</span>8GYol4rsXGm1-0oGCSqf <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set mariadb.auth.password<span class="o">=</span>8GYol4rsXGm1-0oGCSqf <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set mariadb.primary.persistence.enabled<span class="o">=</span><span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set mariadb.primary.persistence.size<span class="o">=</span>80Gi <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set memcached.enabled<span class="o">=</span><span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --set <span class="nv">wordpressConfigureCache</span><span class="o">=</span>true</span></span></code></pre></div><div class="highlight" id="id-37"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">NAME: wordpress
</span></span><span class="line"><span class="cl">LAST DEPLOYED: Fri Jun <span class="m">30</span> 11:27:15 <span class="m">2023</span>
</span></span><span class="line"><span class="cl">NAMESPACE: wordpress
</span></span><span class="line"><span class="cl">STATUS: deployed
</span></span><span class="line"><span class="cl">REVISION: <span class="m">1</span>
</span></span><span class="line"><span class="cl">TEST SUITE: None
</span></span><span class="line"><span class="cl">NOTES:
</span></span><span class="line"><span class="cl">CHART NAME: wordpress
</span></span><span class="line"><span class="cl">CHART VERSION: 16.1.21
</span></span><span class="line"><span class="cl">APP VERSION: 6.2.2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">** Please be patient <span class="k">while</span> the chart is being deployed **
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Your WordPress site can be accessed through the following DNS name from within your cluster:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    wordpress.wordpress.svc.cluster.local <span class="o">(</span>port 80<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">To access your WordPress site from outside the cluster follow the steps below:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">1. Get the WordPress URL by running these commands:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="nb">export</span> <span class="nv">NODE_PORT</span><span class="o">=</span><span class="k">$(</span>kubectl get --namespace wordpress -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&#34;{.spec.ports[0].nodePort}&#34;</span> services wordpress<span class="k">)</span>
</span></span><span class="line"><span class="cl">   <span class="nb">export</span> <span class="nv">NODE_IP</span><span class="o">=</span><span class="k">$(</span>kubectl get nodes --namespace wordpress -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&#34;{.items[0].status.addresses[0].address}&#34;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">   <span class="nb">echo</span> <span class="s2">&#34;WordPress URL: http://</span><span class="nv">$NODE_IP</span><span class="s2">:</span><span class="nv">$NODE_PORT</span><span class="s2">/&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="nb">echo</span> <span class="s2">&#34;WordPress Admin URL: http://</span><span class="nv">$NODE_IP</span><span class="s2">:</span><span class="nv">$NODE_PORT</span><span class="s2">/admin&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2. Open a browser and access WordPress using the obtained URL.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3. Login with the following credentials below to see your blog:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> Username: admin
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> Password: <span class="k">$(</span>kubectl get secret --namespace wordpress wordpress -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&#34;{.data.wordpress-password}&#34;</span> <span class="p">|</span> base64 -d<span class="k">)</span>
</span></span><span class="line"><span class="cl">root@k8s-made-01-32:/softs# <span class="nb">export</span> <span class="nv">NODE_PORT</span><span class="o">=</span><span class="k">$(</span>kubectl get --namespace wordpress -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&#34;{.spec.ports[0].nodePort}&#34;</span> services wordpress<span class="k">)</span>
</span></span><span class="line"><span class="cl">root@k8s-made-01-32:/softs# <span class="nb">export</span> <span class="nv">NODE_IP</span><span class="o">=</span><span class="k">$(</span>kubectl get nodes --namespace wordpress -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&#34;{.items[0].status.addresses[0].address}&#34;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">root@k8s-made-01-32:/softs# <span class="nb">echo</span> <span class="s2">&#34;WordPress URL: http://</span><span class="nv">$NODE_IP</span><span class="s2">:</span><span class="nv">$NODE_PORT</span><span class="s2">/&#34;</span>
</span></span><span class="line"><span class="cl">WordPress URL: http://10.1.0.32:30808/
</span></span><span class="line"><span class="cl">root@k8s-made-01-32:/softs# <span class="nb">echo</span> <span class="s2">&#34;WordPress Admin URL: http://</span><span class="nv">$NODE_IP</span><span class="s2">:</span><span class="nv">$NODE_PORT</span><span class="s2">/admin&#34;</span>
</span></span><span class="line"><span class="cl">WordPress Admin URL: http://10.1.0.32:30808/admin
</span></span><span class="line"><span class="cl">root@k8s-made-01-32:/softs# <span class="nb">echo</span> Password: <span class="k">$(</span>kubectl get secret --namespace wordpress wordpress -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&#34;{.data.wordpress-password}&#34;</span> <span class="p">|</span> base64 -d<span class="k">)</span>
</span></span><span class="line"><span class="cl">Password: H6ZPTRoUsR7Ln3vQa</span></span></code></pre></div><h4 id="52-查看创建的pod及service">5.2 查看创建的pod及service:</h4>
<div class="highlight" id="id-38"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@k8s-made-01-32:/softs# kubectl -n wordpress get pods
</span></span><span class="line"><span class="cl">NAME                                   READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">wordpress-5c5cc6b584-ghzwf             1/1     Running   <span class="m">0</span>          40m
</span></span><span class="line"><span class="cl">wordpress-5c5cc6b584-pw7n4             1/1     Running   <span class="m">0</span>          40m
</span></span><span class="line"><span class="cl">wordpress-mariadb-0                    1/1     Running   <span class="m">0</span>          40m
</span></span><span class="line"><span class="cl">wordpress-memcached-7b78d6bb5b-46275   1/1     Running   <span class="m">0</span>          40m
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">NAME                  TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>                      AGE
</span></span><span class="line"><span class="cl">wordpress             NodePort    10.68.2.53      &lt;none&gt;        80:30808/TCP,443:53657/TCP   41m
</span></span><span class="line"><span class="cl">wordpress-mariadb     ClusterIP   10.68.119.215   &lt;none&gt;        3306/TCP                     41m
</span></span><span class="line"><span class="cl">wordpress-memcached   ClusterIP   10.68.228.225   &lt;none&gt;        11211/TCP                    41m</span></span></code></pre></div><h4 id="53-查看自动创建的pvc及pv">5.3 查看自动创建的pvc及pv</h4>
<div class="highlight" id="id-39"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@k8s-made-01-32:/softs# kubectl -n wordpress get pvc
</span></span><span class="line"><span class="cl">NAME                       STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
</span></span><span class="line"><span class="cl">data-wordpress-mariadb-0   Bound    pvc-6e7c281f-945d-4cb4-aa15-7b492b6a18f3   80Gi       RWO            nfs-client     41m
</span></span><span class="line"><span class="cl">wordpress                  Bound    pvc-6ac1671f-030f-4f24-960c-2dbebb6da614   100Gi      RWO            nfs-client     41m
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root@k8s-made-01-32:/softs# kubectl -n wordpress get pv
</span></span><span class="line"><span class="cl">NAME                                            CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                                        STORAGECLASS   REASON   AGE
</span></span><span class="line"><span class="cl">pv-nfs-client-nfs-subdir-external-provisioner   10Mi       RWO            Retain           Bound    kube-system/pvc-nfs-client-nfs-subdir-external-provisioner                           70m
</span></span><span class="line"><span class="cl">pvc-6ac1671f-030f-4f24-960c-2dbebb6da614        100Gi      RWO            Delete           Bound    wordpress/wordpress                                          nfs-client              41m
</span></span><span class="line"><span class="cl">pvc-6e7c281f-945d-4cb4-aa15-7b492b6a18f3        80Gi       RWO            Delete           Bound    wordpress/data-wordpress-mariadb-0                           nfs-client              41m</span></span></code></pre></div><h4 id="54-验证nfs本地数据">5.4 验证NFS本地数据</h4>
<p>连接到NFS 服务器查看本地数据</p>
<div class="highlight" id="id-40"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@fileServer:/nfs-server/k8s# ll
</span></span><span class="line"><span class="cl">total <span class="m">16</span>
</span></span><span class="line"><span class="cl">drwxr-xr-x <span class="m">4</span> root   root    <span class="m">4096</span> Jun <span class="m">30</span> 11:27 ./
</span></span><span class="line"><span class="cl">drwxr-xr-x <span class="m">3</span> nobody nogroup <span class="m">4096</span> Jun <span class="m">30</span> 10:55 ../
</span></span><span class="line"><span class="cl">drwxrwxrwx <span class="m">3</span> root   root    <span class="m">4096</span> Jun <span class="m">30</span> 11:30 wordpress-data-wordpress-mariadb-0-pvc-6e7c281f-945d-4cb4-aa15-7b492b6a18f3/
</span></span><span class="line"><span class="cl">drwxrwxrwx <span class="m">3</span> root   root    <span class="m">4096</span> Jun <span class="m">30</span> 11:28 wordpress-wordpress-pvc-6ac1671f-030f-4f24-960c-2dbebb6da614/</span></span></code></pre></div><h4 id="55-浏览器访问测试">5.5 浏览器访问测试</h4>
<p>浏览器访问测试wordpress应用</p>
<p><img loading="lazy" src="https://cdn1.ryanxin.live/1688098249213-b50f2628-671a-472d-a21e-135acbf18f09.png" srcset="https://cdn1.ryanxin.live/1688098249213-b50f2628-671a-472d-a21e-135acbf18f09.png, https://cdn1.ryanxin.live/1688098249213-b50f2628-671a-472d-a21e-135acbf18f09.png 1.5x, https://cdn1.ryanxin.live/1688098249213-b50f2628-671a-472d-a21e-135acbf18f09.png 2x" sizes="auto" data-title="image.png" data-alt="image.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<hr>
<p>引用：</p>
<p><a href="https://blog.csdn.net/networken/article/details/86697018?spm=1001.2101.3001.6650.2&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-2-86697018-blog-120181223.235%5Ev38%5Epc_relevant_sort_base2&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-2-86697018-blog-120181223.235%5Ev38%5Epc_relevant_sort_base2&amp;utm_relevant_index=5"target="_blank" rel="external nofollow noopener noreferrer">kubernetes部署nfs-subdir-external-provisioner_freesharer的博客-CSDN博客</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/585736479"target="_blank" rel="external nofollow noopener noreferrer">使用 Helm Cli 将 chart 推送到 Harbor</a></p>
</div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="更新于 2023-08-14 00:00:00">更新于 2023-08-14&nbsp;</span>
      </div><div class="post-info-license">
          <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>
        </div></div>
    <div class="post-info-line">
      <div class="post-info-md"><span><a href="/posts/kubernetes/primary/nfs-subdir-external-provisioner/index.md" title="阅读原始文档" class="link-to-markdown">阅读原始文档</a></span></div>
      <div class="post-info-share">
        <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://hg-xnlog.github.io/posts/kubernetes/primary/nfs-subdir-external-provisioner/" data-title="基于NFS Subdir External Provisioner插件提供K8S存储" data-hashtags="NFS Provisioner"><i class="fa-brands fa-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://hg-xnlog.github.io/posts/kubernetes/primary/nfs-subdir-external-provisioner/" data-hashtag="NFS Provisioner"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 WhatsApp" data-sharer="whatsapp" data-url="https://hg-xnlog.github.io/posts/kubernetes/primary/nfs-subdir-external-provisioner/" data-title="基于NFS Subdir External Provisioner插件提供K8S存储" data-web><i class="fa-brands fa-whatsapp fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://hg-xnlog.github.io/posts/kubernetes/primary/nfs-subdir-external-provisioner/" data-title="基于NFS Subdir External Provisioner插件提供K8S存储"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://hg-xnlog.github.io/posts/kubernetes/primary/nfs-subdir-external-provisioner/" data-title="基于NFS Subdir External Provisioner插件提供K8S存储"><i class="fa-brands fa-weibo fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Myspace" data-sharer="myspace" data-url="https://hg-xnlog.github.io/posts/kubernetes/primary/nfs-subdir-external-provisioner/" data-title="基于NFS Subdir External Provisioner插件提供K8S存储" data-description=""><i data-svg-src="/lib/simple-icons/icons/myspace.min.svg" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Blogger" data-sharer="blogger" data-url="https://hg-xnlog.github.io/posts/kubernetes/primary/nfs-subdir-external-provisioner/" data-title="基于NFS Subdir External Provisioner插件提供K8S存储" data-description=""><i class="fa-brands fa-blogger fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Evernote" data-sharer="evernote" data-url="https://hg-xnlog.github.io/posts/kubernetes/primary/nfs-subdir-external-provisioner/" data-title="基于NFS Subdir External Provisioner插件提供K8S存储"><i class="fa-brands fa-evernote fa-fw" aria-hidden="true"></i></a>
  </span>
      </div>
    </div>
  </div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/tags/nfs-provisioner/' class="post-tag">NFS Provisioner</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/blog/%E4%BA%94%E8%8A%B1%E5%85%AB%E9%97%A8%E7%9A%84-markdown-admonitions/" class="post-nav-item" rel="prev" title="五花八门的 Markdown Admonition"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>五花八门的 Markdown Admonition</a>
      <a href="/posts/kubernetes/advanced/k8s-replace-nfs-storage/" class="post-nav-item" rel="next" title="生产案例-Kubernetes 替换后端存储">生产案例-Kubernetes 替换后端存储<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></main><footer class="footer">
    <div class="footer-container"><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2021 - 2024</span><span class="author" itemprop="copyrightHolder">
              <a href="https://github.com/ryanxin7"target="_blank" rel="external nofollow noopener noreferrer">Ryan</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div><div class="footer-line statistics"><span class="site-time" title='网站运行中……'><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden="true"></i><span class="run-times ms-1">网站运行中……</span></span></div><div class="footer-line visitor">
          <span id="busuanzi_container_site_uv" title='总访客数'><i class="fa-regular fa-user fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='总访问量'><i class="fa-regular fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><a href="https://github.com/ryanxin7" title="在 GitHub 上查看源代码"target="_blank" rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><div id="mask"></div><div class="reading-progress-bar" style="left: 0;top: 0;"></div><noscript>
    <div class="noscript-warning">FixIt 主题在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/algoliasearch/algoliasearch-lite.umd.min.js" defer></script><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async defer></script><script src="/lib/pace/pace.min.js" async defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","editLockTitle":"锁定可编辑代码块","editUnLockTitle":"解锁可编辑代码块","editable":true,"maxShownLines":80},"comment":{"enable":false},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验。"},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"enablePWA":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"HFAFNY4NX2","algoliaIndex":"xn-log","algoliaSearchKey":"bd08388586b2f88b20753c17c60ba92f","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"siteTime":"2021-09-09T09:09:09+09:00"};</script><script src="/js/theme.min.js" defer></script></body>
</html>
