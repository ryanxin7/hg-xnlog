<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>5.CephX 认证机制 - Ryan&#39;s Notebook</title><meta name="author" content="Ryan">
<meta name="author-link" content="https://github.com/ryanxin7">
<meta name="description" content="Ceph使用cephx协议对客户端进行身份认证cephx用于对ceph保存的数据进行认证访问和授权，用于对访问ceph的请求进行认证和授权检" /><meta name="keywords" content='Hugo, FixIt' /><meta itemprop="name" content="5.CephX 认证机制">
<meta itemprop="description" content="Ceph使用cephx协议对客户端进行身份认证cephx用于对ceph保存的数据进行认证访问和授权，用于对访问ceph的请求进行认证和授权检">

<meta itemprop="wordCount" content="4401"><meta itemprop="image" content="https://hg-xnlog.github.io/logo.png"/>
<meta itemprop="keywords" content="" /><meta property="og:title" content="5.CephX 认证机制" />
<meta property="og:description" content="Ceph使用cephx协议对客户端进行身份认证cephx用于对ceph保存的数据进行认证访问和授权，用于对访问ceph的请求进行认证和授权检" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hg-xnlog.github.io/posts/ceph/5.-cephx%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/" /><meta property="og:image" content="https://hg-xnlog.github.io/logo.png"/><meta property="article:section" content="posts" />


<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://hg-xnlog.github.io/logo.png"/>

<meta name="twitter:title" content="5.CephX 认证机制"/>
<meta name="twitter:description" content="Ceph使用cephx协议对客户端进行身份认证cephx用于对ceph保存的数据进行认证访问和授权，用于对访问ceph的请求进行认证和授权检"/>
<meta name="application-name" content="Ryan’s Notebook">
<meta name="apple-mobile-web-app-title" content="Ryan’s Notebook"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://hg-xnlog.github.io/posts/ceph/5.-cephx%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/" /><link rel="prev" href="https://hg-xnlog.github.io/posts/kubernetes/kubernetes-5/" /><link rel="next" href="https://hg-xnlog.github.io/posts/redis/redis-4/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "5.CephX 认证机制",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/hg-xnlog.github.io\/posts\/ceph\/5.-cephx%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6\/"
    },"genre": "posts","wordcount":  4401 ,
    "url": "https:\/\/hg-xnlog.github.io\/posts\/ceph\/5.-cephx%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6\/","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "Ryan"
      },"description": ""
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="wide"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper" data-github-corner="right">
    <div class="header-title">
      <a href="/" title="Ryan&#39;s Notebook"><img loading="lazy" src="/images/pow.png" srcset="/images/pow.png, /images/pow.png 1.5x, /images/pow.png 2x" sizes="auto" data-title="Ryan&#39;s Notebook" data-alt="Ryan&#39;s Notebook" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">Ryan’s Notebook</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 所有文章</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/friends/"
                title="友情链接"
                
              ><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden="true"></i> 友链</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/about/"
                
                
              ><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden="true"></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="搜索文章标题或内容……" id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="Ryan&#39;s Notebook"><img loading="lazy" src="/images/pow.png" srcset="/images/pow.png, /images/pow.png 1.5x, /images/pow.png 2x" sizes="auto" data-title="/images/pow.png" data-alt="/images/pow.png" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">Ryan’s Notebook</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="搜索文章标题或内容……" id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              取消
            </a>
          </li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 所有文章</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/friends/"
                  title="友情链接"
                  
                ><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden="true"></i> 友链</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/about/"
                  
                  
                ><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden="true"></i> 关于</a></li><li
              class="menu-item text-center"
            ><a
                  class="menu-link"
                  href="https://github.com/ryanxin7/hg-xnlog"
                  title="GitHub"
                  rel="noopener noreferrer" target="_blank"
                ><i class='fa-brands fa-github fa-fw' aria-hidden='true'></i> </a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="切换主题"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="container"><aside class="toc" id="toc-auto"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside>

  <aside class="aside-custom">
    </aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>5.CephX 认证机制</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><a href="https://github.com/ryanxin7" title="作者"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="/images/avatar.png" srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x" sizes="auto" data-title="Ryan" data-alt="Ryan" class="avatar" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/>&nbsp;Ryan</a></span></div>
      <div class="post-meta-line"><span title="发布于 0001-01-01 00:00:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden="true"></i><time datetime="0001-01-01">0001-01-01</time></span>&nbsp;<span title="更新于 0001-01-01 00:00:00"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden="true"></i><time datetime="0001-01-01">0001-01-01</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>约 4401 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>预计阅读 9 分钟</span>&nbsp;<span id="busuanzi_container_page_pv" class="busuanzi_visitors comment-visitors" data-flag-title="5.CephX 认证机制">
            <i class="fa-regular fa-eye fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_page_pv">-</span>&nbsp;次阅读
          </span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#51-授权流程">5.1 授权流程</a></li>
      </ul>
    </li>
    <li><a href="#52-访问流程">5.2 访问流程</a></li>
    <li><a href="#53-ceph用户">5.3 ceph用户</a>
      <ul>
        <li><a href="#531-列出指定用户信息br-br-">5.3.1 列出指定用户信息:<!-- raw HTML omitted --><!-- raw HTML omitted --></a></li>
      </ul>
    </li>
    <li><a href="#54-ceph授权和使能">5.4 ceph授权和使能</a></li>
    <li><a href="#55-ceph用户管理">5.5 ceph用户管理</a>
      <ul>
        <li><a href="#551-ceph-auth-add">5.5.1 ceph auth add</a></li>
        <li><a href="#552-ceph-auth-get-or-create">5.5.2 ceph auth get-or-create</a></li>
        <li><a href="#553-ceph-auth-get-or-create-key">5.5.3 ceph auth get-or-create-key</a></li>
        <li><a href="#554--ceph-auth-print-key">5.5.4  ceph auth print-key</a></li>
        <li><a href="#555-修改用户能力">5.5.5 修改用户能力</a></li>
        <li><a href="#556-删除用户">5.5.6 删除用户</a></li>
      </ul>
    </li>
    <li><a href="#56-秘钥环管理">5.6 秘钥环管理</a>
      <ul>
        <li><a href="#561-通过秘钥环文件备份与恢复用户">5.6.1 通过秘钥环文件备份与恢复用户</a></li>
        <li><a href="#562-从keyring文件恢复用户认证信息">5.6.2 从keyring文件恢复用户认证信息</a></li>
        <li><a href="#563-秘钥环文件添加多用户">5.6.3 秘钥环文件添加多用户</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><div class="details admonition warning open">
      <div class="details-summary admonition-title">
        <i class="icon fa-solid fa-exclamation-triangle fa-fw" aria-hidden="true"></i>警告<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
      </div>
      <div class="details-content">
        <div class="admonition-content">本文最后更新于 0001-01-01，文中内容可能已过时。</div>
      </div>
    </div><p><strong>Ceph使用cephx协议对客户端进行身份认证</strong><!-- raw HTML omitted -->cephx用于对ceph保存的数据进行认证访问和授权，用于对访问ceph的请求进行认证和授权检测，与mon通信的请求都要经过ceph认证通过，但是也可以在mon节点关闭cephx认证，但是关闭认证之后任何访问都将被允许，因此无法保证数据的安全性,</p>
<h3 id="51-授权流程">5.1 授权流程</h3>
<p>每个mon节点都可以对客户端进行身份认证并分发秘钥，因此多个mon节点就不存在单点故障和认证性能瓶颈。<!-- raw HTML omitted -->mon节点会返回用于身份认证的数据结构，其中包含获取ceph服务时用到的<strong>session key</strong>,<!-- raw HTML omitted --><strong>session key</strong>通过客户端秘钥进行加密，秘钥是在客户端提前配置好的，<!-- raw HTML omitted --><code>/etc/ceph/ceph.client.admin.keyring</code></p>
<p>客户端使用<strong>session key</strong>向mon请求所需要的服务，mon 向客户端提供一个tiket, 用于向实际处理数据的OSD等服务验证客户端身份，MON和OSD共享同一个secret,因此OSD会信任所有MON发放的tiket<!-- raw HTML omitted -->tiket存在有效期</p>
<p>:::info
注意:<!-- raw HTML omitted -->CephX身份验证功能仅限制在Ceph的各组件之间，不能扩展到其他非ceph组件<!-- raw HTML omitted -->Ceph 只负责认证授权，不能解决数据传输的加密问题
:::</p>
<p><img loading="lazy" src="http://cdn1.ryanxin.live/xxlog/1669880681089-7d7ac090-141d-4258-9cd2-362cff88d9ac.png" srcset="http://cdn1.ryanxin.live/xxlog/1669880681089-7d7ac090-141d-4258-9cd2-362cff88d9ac.png, http://cdn1.ryanxin.live/xxlog/1669880681089-7d7ac090-141d-4258-9cd2-362cff88d9ac.png 1.5x, http://cdn1.ryanxin.live/xxlog/1669880681089-7d7ac090-141d-4258-9cd2-362cff88d9ac.png 2x" sizes="auto" data-title="image.png" data-alt="image.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h2 id="52-访问流程">5.2 访问流程</h2>
<p>无论ceph客户端是哪种类型，例如块设备、对象存储、文件系统，ceph 都会在存储池中将所有数据存储为对象: <!-- raw HTML omitted --><strong>ceph用户需要拥有存储池访问权限，才能读取和写入数据</strong><!-- raw HTML omitted --><strong>ceph用户必须拥有执行权限才能使用ceph的管理命令</strong></p>
<p><img loading="lazy" src="http://cdn1.ryanxin.live/xxlog/1669887090529-269fdedb-ce5f-4e1e-b436-7ec9eb8a9ccf.png" srcset="http://cdn1.ryanxin.live/xxlog/1669887090529-269fdedb-ce5f-4e1e-b436-7ec9eb8a9ccf.png, http://cdn1.ryanxin.live/xxlog/1669887090529-269fdedb-ce5f-4e1e-b436-7ec9eb8a9ccf.png 1.5x, http://cdn1.ryanxin.live/xxlog/1669887090529-269fdedb-ce5f-4e1e-b436-7ec9eb8a9ccf.png 2x" sizes="auto" data-title="image.png" data-alt="image.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="http://cdn1.ryanxin.live/xxlog/1669887247816-2873ce26-50ff-4f30-a6e0-50011624a5e9.png" srcset="http://cdn1.ryanxin.live/xxlog/1669887247816-2873ce26-50ff-4f30-a6e0-50011624a5e9.png, http://cdn1.ryanxin.live/xxlog/1669887247816-2873ce26-50ff-4f30-a6e0-50011624a5e9.png 1.5x, http://cdn1.ryanxin.live/xxlog/1669887247816-2873ce26-50ff-4f30-a6e0-50011624a5e9.png 2x" sizes="auto" data-title="image.png" data-alt="image.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>查看key</p>
<div class="highlight" id="id-1"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cephaceph-dep Loy:~/ ceph-cluster$ cat ceph. C lient . admin. key ring
</span></span><span class="line"><span class="cl"><span class="o">[</span>client. admin<span class="o">]</span>
</span></span><span class="line"><span class="cl">         <span class="nv">key</span> <span class="o">=</span> AQA3dhdhMd/UABAAr 2SNpJ+hcK1dD5 L2Hj <span class="nv">5XMg</span><span class="o">==</span>
</span></span><span class="line"><span class="cl">         caps <span class="nv">mds</span> <span class="o">=</span> <span class="s2">&#34;allow *&#34;</span>
</span></span><span class="line"><span class="cl">         caps <span class="nv">mgr</span> <span class="o">=</span> <span class="s2">&#34;allow *&#34;</span>
</span></span><span class="line"><span class="cl">         caps <span class="nv">mon</span> <span class="o">=</span> <span class="s2">&#34;allow *&#34;</span>
</span></span><span class="line"><span class="cl">         caps <span class="nv">osd</span> <span class="o">=</span> <span class="s2">&#34;allow *&#34;</span></span></span></code></pre></div><h2 id="53-ceph用户">5.3 ceph用户</h2>
<p>用户是指个人(ceph管理者)或系统参与者**(MON/OSD/MDS)**.<!-- raw HTML omitted -->通过创建用户，可以控制用户或哪个参与者能够访问ceph存储集群、以及可访问的存储池及存储池中的数据。<!-- raw HTML omitted -->ceph支持多种类型的用户，但可管理的用户都属于client类型区分用户类型的原因在于, <strong>MON/OSD/MDS 等系统组件特使用cephx协议</strong>,但是它们为非客户端。</p>
<p>通过点号来分割用户类型和用户名，格式为<strong>TYPE.ID</strong>,例如<strong>client. admin</strong>   通常容器和服务器使用client类型</p>
<div class="highlight" id="id-2"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cephaceph-dep Loy:~/ ceph-cluster$ cat ceph.Client.admin.key ring
</span></span><span class="line"><span class="cl"><span class="o">[</span>client.admin<span class="o">]</span>
</span></span><span class="line"><span class="cl">         <span class="nv">key</span> <span class="o">=</span> AQA3dhdhMd/UABAAr 2SNpJ+hcK1dD5 L2Hj <span class="nv">5XMg</span><span class="o">==</span>
</span></span><span class="line"><span class="cl">         caps <span class="nv">mds</span> <span class="o">=</span> <span class="s2">&#34;allow *&#34;</span>
</span></span><span class="line"><span class="cl">         caps <span class="nv">mgr</span> <span class="o">=</span> <span class="s2">&#34;allow *&#34;</span>
</span></span><span class="line"><span class="cl">         caps <span class="nv">mon</span> <span class="o">=</span> <span class="s2">&#34;allow *&#34;</span>
</span></span><span class="line"><span class="cl">         caps <span class="nv">osd</span> <span class="o">=</span> <span class="s2">&#34;allow *&#34;</span></span></span></code></pre></div><h3 id="531-列出指定用户信息br-br-">5.3.1 列出指定用户信息:<!-- raw HTML omitted --><!-- raw HTML omitted --></h3>
<div class="highlight" id="id-3"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>ceph@ceph-deploy ceph-cluster<span class="o">]</span>$ ceph auth get osd.10
</span></span><span class="line"><span class="cl">exported keyring <span class="k">for</span> osd.10
</span></span><span class="line"><span class="cl"><span class="o">[</span>osd.10<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">key</span> <span class="o">=</span> AQCKF6JfL aEpBRAAbY/P +cHPFPUtnkzljruyXw<span class="o">==</span>
</span></span><span class="line"><span class="cl">caps <span class="nv">mgr</span> <span class="o">=</span> <span class="s2">&#34;allow profile osd&#34;</span>
</span></span><span class="line"><span class="cl">caps <span class="nv">mon</span> <span class="o">=</span> <span class="s2">&#34;allow profile osd&#34;</span>
</span></span><span class="line"><span class="cl">caps <span class="nv">osd</span> <span class="o">=</span> <span class="s2">&#34;allow
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">[ceph@ceph-deploy ceph-cluter</span>$<span class="s2"> ceph auth get client.admin
</span></span></span><span class="line"><span class="cl"><span class="s2">exported keyring for client.admin
</span></span></span><span class="line"><span class="cl"><span class="s2">[client.admin]
</span></span></span><span class="line"><span class="cl"><span class="s2">          key = AQAGDKJfQk/dAxAA3Y +9xoE/p8in6QjoHeXmeg==
</span></span></span><span class="line"><span class="cl"><span class="s2">          caps mds = &#34;</span>allow *<span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">          caps mgr = &#34;</span>allow *<span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">          caps mon = &#34;</span>allow *<span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">          caps osd = &#34;</span>allow *<span class="s2">&#34;</span></span></span></code></pre></div><h2 id="54-ceph授权和使能">5.4 ceph授权和使能</h2>
<p><strong>ceph基于使能/能力(Capabilities,简称caps )<strong>来描述用户可针对</strong>MON/OSD或MDS</strong>使用的授权范围或级别，<!-- raw HTML omitted -->通用的语法格式: <code>daemon-type 'allow caps' [...]</code></p>
<p><strong>能力一览表:</strong></p>
<p><code>r</code>: 向用户授子读取权限，访问监视器(mon)以检索CRUSH运行图时需具有此能力。<!-- raw HTML omitted --><code>W</code>: 向用户授子针对对象的写人权限。<!-- raw HTML omitted --><code>x</code>: 授予用户调用类方法(包括读取和写人)的能力，以及在监视器中执行auth操作的能力。<!-- raw HTML omitted --><code>*</code>:  授予用户对特定守护进程/存储池的读取、写入和执行权限，以及执行管理命令的能力</p>
<p><code>class-read</code>:授子用户调用类读取方法的能力，属于是x 能力的子集.<!-- raw HTML omitted --><code>class-write</code>:授子用户调用类写人方法的能力，属于是x 能力的子集。</p>
<p>集群组件权限<!-- raw HTML omitted --><code>profile osd</code>: 授予用户以某个OSD身份连接到其他OSD或监视器的权限.授予OSD权限，使OSD 能够处理复制检测信号流量和状态报告(获取OSD的状态信息).<!-- raw HTML omitted --><code>profile mds</code>: 授予用户以某个MDS身份连接到其他MDS或监视器的权限。<!-- raw HTML omitted --><code>profile bootstrap-osd</code>: 授予用户引导OSD的权限(初始化OSD并将OSD加人ceph集群)，授权给部署工具，使其在引导OSD时有权添加密钥。<!-- raw HTML omitted --><code>profile bootstrap-mds</code>: 授子用户引导元数据服务器的权限，授权部署工具权限，使其在引导元数据服务器时有权添加密钥.</p>
<p><strong>MON能力:</strong><!-- raw HTML omitted -->包括r/w/x和allow profile cap(ceph的运行图)<!-- raw HTML omitted -->例如:</p>
<div class="highlight" id="id-4"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mon <span class="s1">&#39;allow rwx&#39;</span>
</span></span><span class="line"><span class="cl">mon <span class="s1">&#39;allow profile osd&#39;</span></span></span></code></pre></div><p><strong>OSD能力:</strong><!-- raw HTML omitted -->包括r、w、 x、class-read、 class-write(类读取) 和profile osd(类写入)，另外OSD能力还允许进行存储池和名称空间设置。</p>
<div class="highlight" id="id-5"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">osd <span class="s1">&#39;llow capability&#39;</span> <span class="o">[</span><span class="nv">pool</span><span class="o">=</span>poolname<span class="o">]</span> <span class="o">[</span><span class="nv">namespace</span> <span class="o">=</span>namespace-name<span class="o">]</span></span></span></code></pre></div><p><strong>MDS能力:</strong><!-- raw HTML omitted -->只需要allow 或空都表示允许.</p>
<div class="highlight" id="id-6"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mds <span class="s1">&#39;allow&#39;</span></span></span></code></pre></div><h2 id="55-ceph用户管理">5.5 ceph用户管理</h2>
<p><!-- raw HTML omitted -->用户管理功能可让 Ceph集群管理员能够直接在 Ceph集群中创建更新和删除用户。<!-- raw HTML omitted -->在Ceph集群中创建或删除用户时，可能需要将密钥分发到客户端，以便将密钥添加到密钥环文件中<code>/etc/ceph/ceph.client.admin.keyring</code>，此文件中可以包含一个或 者多个用户认证信息，凡是拥有此文件的节点，将具备访问ceph的权限，而且可以使用其中任何一个账户的权限，此文件类似于linux系统的中的**/etc/passwd**文件.</p>
<blockquote>
<p>注意: TYPEID 表示法针对用户采用<strong>TYPE.ID</strong>表示法
例如osd.0指定是osd类并且ID为0的用户(节点),
client.admin是client类型的用户，其ID为admin,
另请注意，每个项包含一个 key=xxx项，以及一个或多个caps项。
可以结合使用-0文件名选项和ceph auth list 将输出保存到某个文件,
[ceph@ceph-deploy ceph-cluster]$ ceph auth list -o 123.key</p>
</blockquote>
<p>添加一个用户会创建用户名(<strong>TYPE.ID</strong>). 机密密钥，以及包含在命令中用于创建该用户的所有能力,用户可使用其密钥向Ceph 存储集群进行身份验证。<!-- raw HTML omitted -->用户的能力授予该用户在<strong>Ceph monitor (mon)</strong>、<strong>Ceph OSD (osd)<strong>或</strong>Ceph元数据服务器(mds)</strong> 上进行读取、写入或执行的能力,可以使用以下几个命令来添加用户:</p>
<h3 id="551-ceph-auth-add">5.5.1 ceph auth add</h3>
<p>此命令是添加用户的规范方法。它会创建用户、生成密钥，并添加所有指定的能力。</p>
<div class="highlight" id="id-7"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>ceph@ceph-deploy ceph-cluster<span class="o">]</span>$ ceph auth -h
</span></span><span class="line"><span class="cl">auth add &lt;entity&gt; <span class="o">{</span>&lt;caps&gt;<span class="o">[</span>&lt;caps&gt;...<span class="o">]}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#添加认证key: </span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph@ceph-deploy ceph-cluster<span class="o">]</span>$ ceph auth add client.tom mon <span class="s1">&#39;allow r&#39;</span> osd <span class="s1">&#39;allow rwx pool=mypool&#39;</span>
</span></span><span class="line"><span class="cl">added key <span class="k">for</span> client.tom
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#tom用户只能在mypool存储池对mon有读权限、对osd有读写执行权限</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#验证key</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph@ceph-deploy ceph-cluster<span class="o">]</span>$ ceph auth get client.tom
</span></span><span class="line"><span class="cl">exported keyring <span class="k">for</span> client.tom
</span></span><span class="line"><span class="cl"><span class="o">[</span>client.tom<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">key</span> <span class="o">=</span> AQCErsdftuumL BAADUiAfQUI42ZIX1e/4PjpdA<span class="o">==</span>
</span></span><span class="line"><span class="cl">  caps <span class="nv">mon</span> <span class="o">=</span> <span class="s2">&#34;allow r&#34;</span>
</span></span><span class="line"><span class="cl">  caps <span class="nv">osd</span> <span class="o">=</span> <span class="s2">&#34;allow rwx  pool=mypool&#34;</span>
</span></span><span class="line"><span class="cl">  exported keyring <span class="k">for</span> client.tom</span></span></code></pre></div><h3 id="552-ceph-auth-get-or-create">5.5.2 ceph auth get-or-create</h3>
<p><code>ceph auth get-or-create</code>此命令是创建用户较为常见的方式之一, 它会返回包含用户名(在方括号中)和密钥的密钥文，如果该用户已存在，此命令只以密钥文件格式返回用户名和密钥，还可以使用 -o 指定文件名选项将输出保存到某个文件。</p>
<div class="highlight" id="id-8"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#创建用户</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph@ceph-deploy ceph-cluster<span class="o">]</span>$ ceph auth get-or-create client,jack mon <span class="s1">&#39;allow r osd &#39;</span>allow rwx <span class="nv">pool</span><span class="o">=</span>mypool<span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">[client.jack]
</span></span></span><span class="line"><span class="cl"><span class="s1">     key = AQAtr8dfi37XMhAADbHWEZOshY1QZ5A8eBpeoQ==
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">#验证用户
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph@ceph-deploy ceph-clusterI$ ceph auth get client.jack
</span></span></span><span class="line"><span class="cl"><span class="s1">exported keyring for cliet,jack
</span></span></span><span class="line"><span class="cl"><span class="s1">[client.jack]
</span></span></span><span class="line"><span class="cl"><span class="s1">     key = AQAtr8dfi37XMhAADbHWEZOshY1QZ5A8eBpeoQ==
</span></span></span><span class="line"><span class="cl"><span class="s1">     caps mon=&#34;allow r&#34;
</span></span></span><span class="line"><span class="cl"><span class="s1">     caps osd =&#34;allow rwx  pool=mypool&#34;
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">#再次创建就不会创建了会打印key信息
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1"> [ceph@ceph-deploy ceph-cluster]$ ceph auth get-or-create client.jack mon &#39;</span>allow r
</span></span><span class="line"><span class="cl">osd <span class="err">&#39;</span>allow rwx <span class="nv">pool</span><span class="o">=</span>mypool
</span></span><span class="line"><span class="cl"><span class="o">[</span>client.jack<span class="o">]</span>
</span></span><span class="line"><span class="cl">     <span class="nv">key</span> <span class="o">=</span> <span class="nv">AQAtr8dfiI37XMhAADbHWEZ0shY1QZ5A8eBpeoQ</span><span class="o">==</span></span></span></code></pre></div><h3 id="553-ceph-auth-get-or-create-key">5.5.3 ceph auth get-or-create-key</h3>
<p>此命令是创建用户并仅返回用户密钥，对于只需要密钥的客户端(例如libvirt) ，此命令非常有用。<!-- raw HTML omitted -->如果该用户已存在，此命令只返回密钥。您可以使用-o文件名选项将输出保存到某个文件。</p>
<p>创建客户端用户时，可以创建不具有能力的用户.不具有能力的用户可以进行身份验证，但不能执行其他操作，此类客户端无法从监视器检索集群地图,但是,如果希望稍后再添加能力，可以使用<code>ceph auth caps</code>命令创建一个不具有能力的用户。<!-- raw HTML omitted -->典型的用户至少对Ceph monitor具有读取功能，并对Ceph OSD具有读取和写人功能.此外，用户的OSD 权限通常限制为只能访问特定的存储池。</p>
<div class="highlight" id="id-9"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>ceph@ceph-deploy ceph-cluster<span class="o">]</span>$ ceph auth get-or-create-key client.jack mon <span class="s1">&#39;allow r&#39;</span> osd <span class="s1">&#39;allow rwx pool=mypool&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">AQAtr8dfi37XMhAADbHWEZ0shY1QZ5A8eBpeoQ</span><span class="o">==</span> <span class="c1">#用户有key就显示没有就创建</span></span></span></code></pre></div><h3 id="554--ceph-auth-print-key">5.5.4  ceph auth print-key</h3>
<p>只获取单个指定用户的key信息</p>
<div class="highlight" id="id-10"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>ceph@ceph-deploy ceph-cluster$ ceph auth print-key client.jack
</span></span><span class="line"><span class="cl">AQAtr8dfi37XMhAADbHWEZ0shY <span class="nv">1QZ5A8eBpeoQ</span><span class="o">==</span></span></span></code></pre></div><h3 id="555-修改用户能力">5.5.5 修改用户能力</h3>
<p>使用<code>ceph auth caps</code>命令可以指定用户以及更改该用户的能力，设置新能力会完全覆盖当前的能力，因此要加上之前的用户已经拥有的能和新的能力，如果看当前能力，可以运行<code>ceph auth get USERTYPE.USERID</code>,如果要添加能力，使用以下格式时还需要指定现有能力:</p>
<p><strong>权限修改后立即生效</strong></p>
<div class="highlight" id="id-11"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#查看用户当前权限</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph@ceph-deploy ceph-cluster<span class="o">]</span>$ ceph auth get client.jack
</span></span><span class="line"><span class="cl">exported keyring <span class="k">for</span> client.jack
</span></span><span class="line"><span class="cl"><span class="o">[</span>client.jack<span class="o">]</span>
</span></span><span class="line"><span class="cl">     <span class="nv">key</span> <span class="o">=</span> <span class="nv">AQAtr8dfi37XMhAADbHWEZ0shY1QZ5A8eBpeoQ</span><span class="o">==</span>
</span></span><span class="line"><span class="cl">     caps <span class="nv">mon</span> <span class="o">=</span> <span class="s2">&#34;allow r&#34;</span>
</span></span><span class="line"><span class="cl">     caps <span class="nv">osd</span> <span class="o">=</span> <span class="s2">&#34;allw rwx pool=mypool&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#修改用户权限</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph@ceph-deploy ceph-cluster<span class="o">]</span>$ ceph auth caps client.jack mon <span class="s1">&#39;allow r&#39;</span> osd <span class="s1">&#39;allow rw pool=mypool&#39;</span>
</span></span><span class="line"><span class="cl">updated caps <span class="k">for</span> client.jack
</span></span><span class="line"><span class="cl"><span class="c1">#再次验证权限</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph@ceph-deploy ceph-cluster<span class="o">]</span>$ ceph auth get client.jack
</span></span><span class="line"><span class="cl">exported keyring <span class="k">for</span> client.jack</span></span></code></pre></div><h3 id="556-删除用户">5.5.6 删除用户</h3>
<p>要删除用户使用<code>ceph auth del TYPE.ID</code>,其中TYPE是client. osd. mon 或mds之一,<!-- raw HTML omitted -->ID是用户名或守护进程的ID.</p>
<div class="highlight" id="id-12"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>ceph@ceph-deploy ceph-cluster<span class="o">]</span>$ ceph auth del client.tom
</span></span><span class="line"><span class="cl">updated</span></span></code></pre></div><h2 id="56-秘钥环管理">5.6 秘钥环管理</h2>
<p>ceph的秘钥环是一个保存了<strong>secrets、keys 、certificates</strong>并且能够让客户端通认证访问ceph<!-- raw HTML omitted -->的<strong>keyring file</strong>(集合文件），一个<strong>keyring file</strong>可以保存一个或者多个认证信息，每一个 key都<!-- raw HTML omitted -->有一个实体名称加权限，类型为:<!-- raw HTML omitted --><code>{client、mon、mds、osd)}.name</code></p>
<p><strong>当客户端访问ceph集群时，ceph 会按顺序依次使用以下四个密钥环文件预设置密钥环设置:</strong><!-- raw HTML omitted --><strong>集群名词 + 用户类型 +用户ID+固定后缀</strong><!-- raw HTML omitted --><code>/etc/ceph/&lt;$cluster name&gt;.&lt;user $type&gt;.&lt;user $id&gt;.keyring</code> 保存单个用户的keyring<!-- raw HTML omitted --><code>/etc/ceph/cluster.keyring</code> 保存多个用户的keyring<!-- raw HTML omitted --><code>/etc/ceph/keyring</code> 未定义集群名称的多个用户的keyring<!-- raw HTML omitted --><code>/etc/ceph/keyring.bin</code>  编译后的二进制文件</p>
<h3 id="561-通过秘钥环文件备份与恢复用户">5.6.1 通过秘钥环文件备份与恢复用户</h3>
<p>如果误删除账号可以通过秘钥环恢复用户，<strong>主要是key不会变（k8s 几十几百个pod）</strong><!-- raw HTML omitted -->使用<code>ceph auth add</code>等命令添加的用户还需要额外使用<code>ceph-authtool</code>命令为其创建用户秘<!-- raw HTML omitted -->钥环文件.<!-- raw HTML omitted -->先创建空 keyring文件命令格式:</p>
<div class="highlight" id="id-13"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ceph-authtool --create-keyring FILE</span></span></code></pre></div><p><strong>导出用户认证信息至keyring文件:</strong><!-- raw HTML omitted -->将用户信息导出至keyring文件，对用户信息进行备份。</p>
<div class="highlight" id="id-14"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#创建用户:</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>ceph@ceph-deploy ceph cluster<span class="o">]</span>$ ceph auth get-or-create client.user1 mon <span class="s1">&#39;allow r&#39;</span> osd <span class="s1">&#39;allow *pool=mypool&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>client.user1<span class="o">]</span>
</span></span><span class="line"><span class="cl">          <span class="nv">key</span> <span class="o">=</span><span class="nv">AQAUUchfjpMqGRAARV6h0ofdDEneuaRnxuHjoQ</span><span class="o">==</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#验证用户</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph@ceph-deploy ceph-clusterl$ ceph auth get client.user1
</span></span><span class="line"><span class="cl">exported keyring <span class="k">for</span> client.user1
</span></span><span class="line"><span class="cl"><span class="o">[</span>client.user1<span class="o">]</span>
</span></span><span class="line"><span class="cl">          <span class="nv">key</span> <span class="o">=</span> <span class="nv">AQAUUchfjpMqGRAARV6hOofdDEneuaRnxuHjoQ</span><span class="o">==</span>
</span></span><span class="line"><span class="cl">          caps <span class="nv">mon</span> <span class="o">=</span> <span class="s2">&#34;allow r&#34;</span>
</span></span><span class="line"><span class="cl">          caps <span class="nv">osd</span> <span class="o">=</span> <span class="s2">&#34;allow *pool=mypool&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#创建keyring文件:</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>ceph@ceph-deploy ceph-cluster<span class="o">]</span>$ ceph-authtool --create-keyring ceph.client.user1.keyring
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#验证keyring文件:</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph@ceph-deploy ceph-cluster<span class="o">]</span>$ cat ceph.client.user1.keyring
</span></span><span class="line"><span class="cl"><span class="c1">#是个空文件</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph@ceph-deploy ceph-cluster<span class="o">]</span>$ file ceph.client.user1.keyring
</span></span><span class="line"><span class="cl">ceph.client.user1.keyring: empty
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#导出keyring至指定文件</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph@ceph-deploy ceph-cluster<span class="o">]</span><span class="nv">$ceph</span> auth get client.user1 -o ceph.client.user1.keyring
</span></span><span class="line"><span class="cl">exported keyring <span class="k">for</span> client.user1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#验证指定用户的keyring文件:</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph@ceph-deploy ceph-cluster<span class="o">]</span>$ cat ceph.client.user1.keyring
</span></span><span class="line"><span class="cl"><span class="o">[</span>client.user1<span class="o">]</span>
</span></span><span class="line"><span class="cl">     <span class="nv">key</span> <span class="o">=</span> <span class="nv">AQAUUchfjpMqGRAARV6hOofdDEneuaRnxuHjoQ</span><span class="o">==</span>
</span></span><span class="line"><span class="cl">     caps <span class="nv">mon</span> <span class="o">=</span> <span class="s2">&#34;allow r&#34;</span>
</span></span><span class="line"><span class="cl">     caps <span class="nv">osd</span> <span class="o">=</span> <span class="s2">&#34;allow * pool=mypool&#34;</span></span></span></code></pre></div><p>在创建包含单个用户的密钥环时，通常建议使用ceph集群名称、用户类型和用户名及<!-- raw HTML omitted -->keyring来命名，并将其保存在**/etc/ceph** 目录中，例如为<strong>client.user1</strong>用户创建<!-- raw HTML omitted --><strong>ceph.client.user1.keyring</strong></p>
<h3 id="562-从keyring文件恢复用户认证信息">5.6.2 从keyring文件恢复用户认证信息</h3>
<p>可以使用<strong>ceph auth import +指定keyring文件</strong>并导人到ceph,其实就是起到用户备份和恢复的目的:</p>
<div class="highlight" id="id-15"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>ceph@ceph-deploy ceph-cluster<span class="o">]</span>$ ceph auth import -i ceph.client.user1.keyring
</span></span><span class="line"><span class="cl"><span class="c1">#导入用户</span></span></span></code></pre></div><h3 id="563-秘钥环文件添加多用户">5.6.3 秘钥环文件添加多用户</h3>
<p>一个keyring文件中可以包含多个不同用户的认证文件。<!-- raw HTML omitted --><strong>将多用户导出至秘钥环:</strong></p>
<div class="highlight" id="id-16"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#创建keyring文件:</span>
</span></span><span class="line"><span class="cl">$ ceph-authtool --create-keyring ceph.client.user.keyring <span class="c1">#创建空的keyring文件</span>
</span></span><span class="line"><span class="cl">creating ceph.client.user.keyring
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#把指定的admin用户的keyring文件内容导人到user用户的keyring文件:</span>
</span></span><span class="line"><span class="cl"><span class="nv">$ceph</span>-authtool ./ceph.client.user.keyring --import-keyring ./ceph.client.admin.keyring
</span></span><span class="line"><span class="cl">importing contents of ./ceph.client.admin.keyring into ./ceph.client.user.keyring
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#验证keyring文件:</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph@ceph-deploy ceph-cluster<span class="o">]</span>$ ceph-authtool -I ./ceph.client.user.keyring
</span></span><span class="line"><span class="cl"><span class="o">[</span>client.admin<span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="nv">key</span> <span class="o">=</span> AQAGDKJfQk/dAxAA3Y +9xoE/p8in6QjoHeXmeg<span class="o">==</span>
</span></span><span class="line"><span class="cl">    caps <span class="nv">mds</span> <span class="o">=</span> <span class="s2">&#34;allow *&#34;</span>
</span></span><span class="line"><span class="cl">    caps <span class="nv">mgr</span> <span class="o">=</span> <span class="s2">&#34;allow *&#34;</span>
</span></span><span class="line"><span class="cl">    caps <span class="nv">mon</span> <span class="o">=</span> <span class="s2">&#34;allow *&#34;</span>
</span></span><span class="line"><span class="cl">    caps <span class="nv">osd</span> <span class="o">=</span> <span class="s2">&#34;allow *&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#再导入一个其他用户的keyring:</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>ceph@ceph-deploy ceph-cluster<span class="o">]</span><span class="nv">$ceph</span>-authtool ./ceph.client.user.keyring --import-kevring ./ceph.client.user1.kevring
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#再次验证keyring文件是否包含多个用户的认证信息:</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph@ceph-deploy ceph-cluster<span class="o">]</span>$ ceph- authtool -I ./ceph.client.user.keyring
</span></span><span class="line"><span class="cl"><span class="o">[</span>client.admin<span class="o">]</span>
</span></span><span class="line"><span class="cl">     <span class="nv">key</span> <span class="o">=</span> AQAGDKJfQk/dAxAA3Y +9xoE/p8in6QjoHeXmeg<span class="o">==</span>
</span></span><span class="line"><span class="cl">     caps <span class="nv">mds</span> <span class="o">=</span> <span class="s2">&#34;allow *&#34;</span>
</span></span><span class="line"><span class="cl">     caps <span class="nv">mgr</span> <span class="o">=</span> <span class="s2">&#34;allow *&#34;</span>
</span></span><span class="line"><span class="cl">     caps <span class="nv">mon</span> <span class="o">=</span> <span class="s2">&#34;allow *&#34;</span>
</span></span><span class="line"><span class="cl">     caps <span class="nv">osd</span> <span class="o">=</span> <span class="s2">&#34;allow *&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>client.user1<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">key</span> <span class="o">=</span> <span class="nv">AQAUUchfjpMqGRAARV6h0ofdDEneuaRnxuHjoQ</span><span class="o">==</span>
</span></span><span class="line"><span class="cl">     caps <span class="nv">mon</span> <span class="o">=</span> <span class="s2">&#34;allow r&#34;</span>
</span></span><span class="line"><span class="cl">     caps <span class="nv">osd</span> <span class="o">=</span> <span class="s2">&#34;allow * pool=mypool&#34;</span></span></span></code></pre></div></div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="更新于 0001-01-01 00:00:00">更新于 0001-01-01&nbsp;</span>
      </div><div class="post-info-license">
          <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>
        </div></div>
    <div class="post-info-line">
      <div class="post-info-md"><span><a href="/posts/ceph/5.-cephx%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/index.md" title="阅读原始文档" class="link-to-markdown">阅读原始文档</a></span></div>
      <div class="post-info-share">
        <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://hg-xnlog.github.io/posts/ceph/5.-cephx%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/" data-title="5.CephX 认证机制"><i class="fa-brands fa-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://hg-xnlog.github.io/posts/ceph/5.-cephx%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 WhatsApp" data-sharer="whatsapp" data-url="https://hg-xnlog.github.io/posts/ceph/5.-cephx%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/" data-title="5.CephX 认证机制" data-web><i class="fa-brands fa-whatsapp fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://hg-xnlog.github.io/posts/ceph/5.-cephx%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/" data-title="5.CephX 认证机制"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://hg-xnlog.github.io/posts/ceph/5.-cephx%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/" data-title="5.CephX 认证机制"><i class="fa-brands fa-weibo fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Myspace" data-sharer="myspace" data-url="https://hg-xnlog.github.io/posts/ceph/5.-cephx%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/" data-title="5.CephX 认证机制" data-description=""><i data-svg-src="/lib/simple-icons/icons/myspace.min.svg" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Blogger" data-sharer="blogger" data-url="https://hg-xnlog.github.io/posts/ceph/5.-cephx%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/" data-title="5.CephX 认证机制" data-description=""><i class="fa-brands fa-blogger fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Evernote" data-sharer="evernote" data-url="https://hg-xnlog.github.io/posts/ceph/5.-cephx%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/" data-title="5.CephX 认证机制"><i class="fa-brands fa-evernote fa-fw" aria-hidden="true"></i></a>
  </span>
      </div>
    </div>
  </div>

  <div class="post-info-more">
    <section class="post-tags"></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/kubernetes/kubernetes-5/" class="post-nav-item" rel="prev" title="5.k8s实战案例-nginx与tomcat实现动静分离"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>5.k8s实战案例-nginx与tomcat实现动静分离</a>
      <a href="/posts/redis/redis-4/" class="post-nav-item" rel="next" title="4.Redis-共享Session实践">4.Redis-共享Session实践<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></main><footer class="footer">
    <div class="footer-container"><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2021 - 2023</span><span class="author" itemprop="copyrightHolder">
              <a href="https://github.com/ryanxin7"target="_blank" rel="external nofollow noopener noreferrer">Ryan</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div><div class="footer-line statistics"><span class="site-time" title='网站运行中……'><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden="true"></i><span class="run-times ms-1">网站运行中……</span></span></div><div class="footer-line visitor">
          <span id="busuanzi_container_site_uv" title='总访客数'><i class="fa-regular fa-user fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='总访问量'><i class="fa-regular fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><a href="https://github.com/ryanxin7" title="在 GitHub 上查看源代码"target="_blank" rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><div id="mask"></div><noscript>
    <div class="noscript-warning">FixIt 主题在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/algoliasearch/algoliasearch-lite.umd.min.js" defer></script><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async defer></script><script src="/lib/pace/pace.min.js" async defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","editLockTitle":"锁定可编辑代码块","editUnLockTitle":"解锁可编辑代码块","editable":true,"maxShownLines":10},"comment":{"enable":false},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验。"},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"enablePWA":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"HFAFNY4NX2","algoliaIndex":"xn-log","algoliaSearchKey":"bd08388586b2f88b20753c17c60ba92f","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"siteTime":"2021-09-09T09:09:09+09:00"};</script><script src="/js/theme.min.js" defer></script></body>
</html>
