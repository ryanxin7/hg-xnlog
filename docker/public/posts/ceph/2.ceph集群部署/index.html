<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>Ceph 集群部署 （二） - Ryan&#39;s Notebook</title><meta name="author" content="Ryan">
<meta name="author-link" content="https://github.com/ryanxin7">
<meta name="description" content="推荐配置 CPU 16C 或 32C 双路内存 64G以上磁盘 NVME 企业级SSD 推荐 intel D7 P5520 数据中心企业级固态硬盘U.2 nvme协议服务器工作站SSD P5520 3.84TB intel 英特尔 S4510/S4520 数据中" /><meta name="keywords" content='分布式存储' /><meta itemprop="name" content="Ceph 集群部署 （二）">
<meta itemprop="description" content="推荐配置 CPU 16C 或 32C 双路内存 64G以上磁盘 NVME 企业级SSD 推荐 intel D7 P5520 数据中心企业级固态硬盘U.2 nvme协议服务器工作站SSD P5520 3.84TB intel 英特尔 S4510/S4520 数据中"><meta itemprop="datePublished" content="2023-01-10T00:00:00+00:00" />
<meta itemprop="dateModified" content="2023-05-31T00:00:00+00:00" />
<meta itemprop="wordCount" content="11562"><meta itemprop="image" content="https://hg-xnlog.github.io/logo.png"/>
<meta itemprop="keywords" content="分布式存储," /><meta property="og:title" content="Ceph 集群部署 （二）" />
<meta property="og:description" content="推荐配置 CPU 16C 或 32C 双路内存 64G以上磁盘 NVME 企业级SSD 推荐 intel D7 P5520 数据中心企业级固态硬盘U.2 nvme协议服务器工作站SSD P5520 3.84TB intel 英特尔 S4510/S4520 数据中" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hg-xnlog.github.io/posts/ceph/2.ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/" /><meta property="og:image" content="https://hg-xnlog.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-10T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-05-31T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://hg-xnlog.github.io/logo.png"/>

<meta name="twitter:title" content="Ceph 集群部署 （二）"/>
<meta name="twitter:description" content="推荐配置 CPU 16C 或 32C 双路内存 64G以上磁盘 NVME 企业级SSD 推荐 intel D7 P5520 数据中心企业级固态硬盘U.2 nvme协议服务器工作站SSD P5520 3.84TB intel 英特尔 S4510/S4520 数据中"/>
<meta name="application-name" content="Ryan’s Notebook">
<meta name="apple-mobile-web-app-title" content="Ryan’s Notebook"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://hg-xnlog.github.io/posts/ceph/2.ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/" /><link rel="prev" href="https://hg-xnlog.github.io/posts/kubernetes/primary/kubernetes-1/" /><link rel="next" href="https://hg-xnlog.github.io/posts/ceph/3.ceph-fs%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Ceph 集群部署 （二）",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/hg-xnlog.github.io\/posts\/ceph\/2.ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2\/"
    },"genre": "posts","keywords": "分布式存储","wordcount":  11562 ,
    "url": "https:\/\/hg-xnlog.github.io\/posts\/ceph\/2.ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2\/","datePublished": "2023-01-10T00:00:00+00:00","dateModified": "2023-05-31T00:00:00+00:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "Ryan"
      },"description": ""
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="wide"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper" data-github-corner="right">
    <div class="header-title">
      <a href="/" title="Ryan&#39;s Notebook"><img loading="lazy" src="/images/pow.png" srcset="/images/pow.png, /images/pow.png 1.5x, /images/pow.png 2x" sizes="auto" data-title="Ryan&#39;s Notebook" data-alt="Ryan&#39;s Notebook" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">Ryan’s Notebook</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 所有文章</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/friends/"
                title="友情链接"
                
              ><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden="true"></i> 友链</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/about/"
                
                
              ><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden="true"></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="搜索文章标题或内容……" id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="Ryan&#39;s Notebook"><img loading="lazy" src="/images/pow.png" srcset="/images/pow.png, /images/pow.png 1.5x, /images/pow.png 2x" sizes="auto" data-title="/images/pow.png" data-alt="/images/pow.png" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">Ryan’s Notebook</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="搜索文章标题或内容……" id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              取消
            </a>
          </li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 所有文章</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/friends/"
                  title="友情链接"
                  
                ><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden="true"></i> 友链</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/about/"
                  
                  
                ><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden="true"></i> 关于</a></li><li
              class="menu-item text-center"
            ><a
                  class="menu-link"
                  href="https://github.com/ryanxin7/hg-xnlog"
                  title="GitHub"
                  rel="noopener noreferrer" target="_blank"
                ><i class='fa-brands fa-github fa-fw' aria-hidden='true'></i> </a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="切换主题"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="container"><aside class="toc" id="toc-auto"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside>

  <aside class="aside-custom">
    </aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>Ceph 集群部署 （二）</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><a href="https://github.com/ryanxin7" title="作者"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="/images/avatar.png" srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x" sizes="auto" data-title="Ryan" data-alt="Ryan" class="avatar" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/>&nbsp;Ryan</a></span>
          <span class="post-category">收录于 <a href="/categories/ceph/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> Ceph</a></span></div>
      <div class="post-meta-line"><span title="发布于 2023-01-10 00:00:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden="true"></i><time datetime="2023-01-10">2023-01-10</time></span>&nbsp;<span title="更新于 2023-05-31 00:00:00"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden="true"></i><time datetime="2023-05-31">2023-05-31</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>约 11562 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>预计阅读 24 分钟</span>&nbsp;<span id="busuanzi_container_page_pv" class="busuanzi_visitors comment-visitors" data-flag-title="Ceph 集群部署 （二）">
            <i class="fa-regular fa-eye fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_page_pv">-</span>&nbsp;次阅读
          </span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#推荐配置">推荐配置</a></li>
    <li><a href="#一部署方式">一、部署方式</a></li>
    <li><a href="#二服务器准备">二、服务器准备</a>
      <ul>
        <li><a href="#21-osd服务器">2.1 OSD服务器</a></li>
        <li><a href="#22-mon-监视服务器">2.2 Mon 监视服务器</a></li>
        <li><a href="#23-ceph-mgr-管理服务器">2.3 ceph-mgr 管理服务器</a></li>
        <li><a href="#24-ceph-deploy-部署服务器">2.4 Ceph-deploy 部署服务器</a></li>
      </ul>
    </li>
    <li><a href="#三-服务器环境准备">三、 服务器环境准备</a>
      <ul>
        <li><a href="#31-配置集群网络">3.1 配置集群网络</a></li>
        <li><a href="#32-配置主机名解析">3.2 配置主机名解析</a></li>
        <li><a href="#33-配置apt源">3.3 配置apt源</a></li>
        <li><a href="#34-时间同步">3.4 <strong>时间同步</strong></a></li>
        <li><a href="#35-创建普通用户">3.5 创建普通用户</a></li>
        <li><a href="#36-配置免密登录">3.6 配置免密登录</a></li>
        <li><a href="#37-其他基本优化">3.7 其他基本优化</a></li>
      </ul>
    </li>
    <li><a href="#四部署-rados-集群">四、部署 RADOS 集群</a>
      <ul>
        <li><a href="#41-安装ceph-deploy-部署工具">4.1 安装Ceph-Deploy 部署工具</a></li>
        <li><a href="#42-安装-python-27">4.2 安装 python 2.7</a></li>
        <li><a href="#43-初始化ceph-deploy">4.3 初始化Ceph-Deploy</a></li>
        <li><a href="#44-生成mon配置文件">4.4 生成mon配置文件</a></li>
        <li><a href="#45-初始化node节点">4.5 初始化node节点</a></li>
        <li><a href="#45--初始化mon节点">4.5  初始化mon节点</a></li>
        <li><a href="#46-分发admin密钥到node节点非必须">4.6 分发admin密钥到node节点（非必须）</a></li>
        <li><a href="#47-部署ceph-mgr节点">4.7 部署Ceph-Mgr节点</a></li>
        <li><a href="#48-初始化-osd-节点">4.8 初始化 OSD 节点</a></li>
        <li><a href="#49-添加osd-节点">4.9 添加OSD 节点</a></li>
      </ul>
    </li>
    <li><a href="#五-验证-ceph-集群">五、 验证 Ceph 集群</a>
      <ul>
        <li><a href="#51-从rados-移除osd">5.1 从RADOS 移除OSD</a></li>
        <li><a href="#52-测试上传和下载数据">5.2 测试上传和下载数据</a></li>
      </ul>
    </li>
    <li><a href="#六扩展-ceph-实现高可用">六、扩展 ceph 实现高可用</a>
      <ul>
        <li><a href="#61-扩展-ceph-mon-节点">6.1 <strong>扩展 ceph-mon 节点</strong></a></li>
        <li><a href="#62-扩展ceph-mgr-节点">6.2 扩展Ceph-Mgr 节点</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><div class="details admonition note open">
      <div class="details-summary admonition-title">
        <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>注意<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
      </div>
      <div class="details-content">
        <div class="admonition-content">本文最后更新于 2023-05-31，文中内容可能已过时。</div>
      </div>
    </div><h2 id="推荐配置">推荐配置</h2>
<p>CPU</p>
<pre tabindex="0"><code>16C 或 32C 双路</code></pre><p>内存</p>
<pre tabindex="0"><code>64G以上</code></pre><p>磁盘</p>
<pre tabindex="0"><code>NVME 企业级SSD 
推荐 
intel D7 P5520 数据中心企业级固态硬盘U.2 nvme协议服务器工作站SSD P5520 3.84TB 
intel 英特尔 S4510/S4520 数据中心企业级固态硬盘SATA3 S4520 3.84T </code></pre><p>mon 服务器</p>
<pre tabindex="0"><code>16C 32G 200G</code></pre><p>Mgr 服务器</p>
<pre tabindex="0"><code>8C 16G 200G</code></pre><p>Ceph-deploy</p>
<pre tabindex="0"><code>4c 8G 120G</code></pre><h2 id="一部署方式">一、部署方式</h2>
<p>ceph-ansible：https://github.com/ceph/ceph-ansible #python
ceph-salt：https://github.com/ceph/ceph-salt #python
ceph-container：https://github.com/ceph/ceph-container #shell
ceph-chef：https://github.com/ceph/ceph-chef #Ruby</p>
<p>ceph-deploy：https://github.com/ceph/ceph-deploy #python
ceph-deploy是一个 ceph 官方维护的基于 ceph-deploy 命令行部署 ceph 集群的工具，基于 ssh 执行可以 sudo 权限的 shell 命令以及一些 python 脚本 实现 ceph 集群的部署和管理维护。</p>
<p>Ceph-deploy 只用于部署和管理 ceph 集群，客户端需要访问 ceph，需要部署客户端工具。</p>
<h2 id="二服务器准备">二、服务器准备</h2>
<p>硬件推荐：https://docs.ceph.com/en/latest/start/hardware-recommendations/#</p>
<p><img loading="lazy" src="http://cdn1.ryanxin.live/13141847_61b6e5c75614065563.webp" srcset="http://cdn1.ryanxin.live/13141847_61b6e5c75614065563.webp, http://cdn1.ryanxin.live/13141847_61b6e5c75614065563.webp 1.5x, http://cdn1.ryanxin.live/13141847_61b6e5c75614065563.webp 2x" sizes="auto" data-title="http://cdn1.ryanxin.live/13141847_61b6e5c75614065563.webp" data-alt="http://cdn1.ryanxin.live/13141847_61b6e5c75614065563.webp" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="21-osd服务器">2.1 OSD服务器</h3>
<p>三台服务器作为 ceph 集群 OSD 存储服务器，每台服务器支持两个网络，<strong>public 网络</strong>针对客户端访问，<strong>cluster 网络</strong>用于集群管理及数据同步，每台三块或以上的磁盘。</p>
<pre tabindex="0"><code>10.1.0.30/192.168.10.240
10.0.0.31/192.168.10.241
10.0.0.32/192.168.10.242

三台存储服务器磁盘划分： 
/dev/sdb /dev/sdc /dev/sdd /dev/sde /dev/sdf #200G </code></pre><h3 id="22-mon-监视服务器">2.2 Mon 监视服务器</h3>
<p>三台服务器作为 ceph 集群 Mon 监视服务器，每台服务器可以和 ceph 集群的 cluster 网络通信。</p>
<pre tabindex="0"><code>10.1.0.33/192.168.10.243
10.0.0.34/192.168.10.244
10.0.0.35/192.168.10.245</code></pre><h3 id="23-ceph-mgr-管理服务器">2.3 ceph-mgr 管理服务器</h3>
<p>两个 ceph-mgr 管理服务器，可以和 ceph 集群的 cluster 网络通信。</p>
<pre tabindex="0"><code>10.1.0.30/192.168.10.240
10.0.0.31/192.168.10.241</code></pre><h3 id="24-ceph-deploy-部署服务器">2.4 Ceph-deploy 部署服务器</h3>
<p>一个服务器用于部署 ceph 集群即安装 Ceph-deploy，也可以和 ceph-mgr 等复用。</p>
<pre tabindex="0"><code>10.1.0.31/192.168.10.248</code></pre><p><img loading="lazy" src="http://cdn1.ryanxin.live/%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6.png" srcset="http://cdn1.ryanxin.live/%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6.png, http://cdn1.ryanxin.live/%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6.png 1.5x, http://cdn1.ryanxin.live/%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6.png 2x" sizes="auto" data-title="http://cdn1.ryanxin.live/%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6.png" data-alt="http://cdn1.ryanxin.live/%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h2 id="三-服务器环境准备">三、 服务器环境准备</h2>
<h3 id="31-配置集群网络">3.1 配置集群网络</h3>
<div class="highlight" id="id-11"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1">#更改网卡名称为eth*:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo vim /etc/default/grub
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">GRUB_DEFAULT</span><span class="o">=</span><span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="nv">GRUB_TIMEOUT_STYLE</span><span class="o">=</span>hidden
</span></span><span class="line"><span class="cl"><span class="nv">GRUB_TIMEOUT</span><span class="o">=</span><span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="nv">GRUB_DISTRIBUTOR</span><span class="o">=</span><span class="sb">`</span>lsb_release -i -s 2&gt; /dev/null <span class="o">||</span> <span class="nb">echo</span> Debian<span class="sb">`</span>
</span></span><span class="line"><span class="cl"><span class="nv">GRUB_CMDLINE_LINUX_DEFAULT</span><span class="o">=</span><span class="s2">&#34;maybe-ubiquity&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">GRUB_CMDLINE_LINUX</span><span class="o">=</span><span class="s2">&#34;net.ifnames=0 biosdevname=0&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">~$ sudo update-grub
</span></span><span class="line"><span class="cl">Sourcing file <span class="sb">`</span>/etc/default/grub<span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">Generating grub configuration file ...
</span></span><span class="line"><span class="cl">Found linux image: /boot/vmlinuz-4.15.0-55-generic
</span></span><span class="line"><span class="cl">Found initrd image: /boot/initrd.img-4.15.0-55-generic
</span></span><span class="line"><span class="cl"><span class="k">done</span></span></span></code></pre></div><div class="highlight" id="id-12"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#配置cluster和public网络</span>
</span></span><span class="line"><span class="cl">vim /etc/apt/sources.list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># This is the network config written by &#39;subiquity&#39;</span>
</span></span><span class="line"><span class="cl">network:
</span></span><span class="line"><span class="cl">  ethernets:
</span></span><span class="line"><span class="cl">    eth0:
</span></span><span class="line"><span class="cl">      dhcp4: no
</span></span><span class="line"><span class="cl">      dhcp6: no
</span></span><span class="line"><span class="cl">      addresses:
</span></span><span class="line"><span class="cl">      - 10.1.0.39/24
</span></span><span class="line"><span class="cl">      gateway4: 10.1.0.254
</span></span><span class="line"><span class="cl">      nameservers:
</span></span><span class="line"><span class="cl">        addresses:
</span></span><span class="line"><span class="cl">        - 223.5.5.5
</span></span><span class="line"><span class="cl">    eth1:
</span></span><span class="line"><span class="cl">      dhcp4: no
</span></span><span class="line"><span class="cl">      dhcp6: no
</span></span><span class="line"><span class="cl">      addresses: <span class="o">[</span>192.168.10.239/24<span class="o">]</span>
</span></span><span class="line"><span class="cl">  version: <span class="m">2</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1">#生效</span>
</span></span><span class="line"><span class="cl">netplan apply
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#验证两块网卡IP地址</span>
</span></span><span class="line"><span class="cl">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc mq state UP group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="cl">    link/ether fe:fc:fe:cf:34:9d brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">    inet 10.1.0.39/24 brd 10.1.0.255 scope global eth0
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">    inet6 fe80::fcfc:feff:fecf:349d/64 scope link 
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc mq state UP group default qlen <span class="m">1000</span>
</span></span><span class="line"><span class="cl">    link/ether fe:fc:fe:79:6f:6e brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">    inet 192.168.10.239/24 brd 192.168.10.255 scope global eth1
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">    inet6 fe80::fcfc:feff:fe79:6f6e/64 scope link 
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever</span></span></code></pre></div><h3 id="32-配置主机名解析">3.2 配置主机名解析</h3>
<div class="highlight" id="id-13"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">vim /etc/hosts
</span></span><span class="line"><span class="cl">10.1.0.39 ceph-node1.xx.local ceph-node1
</span></span><span class="line"><span class="cl">10.1.0.40 ceph-node2.xx.local ceph-node2
</span></span><span class="line"><span class="cl">10.1.0.41 ceph-node3.xx.local ceph-node3
</span></span><span class="line"><span class="cl">10.1.0.39 ceph-mon1.xx.local ceph-mon1
</span></span><span class="line"><span class="cl">10.1.0.40 ceph-mon2.xx.local ceph-mon2
</span></span><span class="line"><span class="cl">10.1.0.41 ceph-mon3.xx.local ceph-mon3
</span></span><span class="line"><span class="cl">10.1.0.40 ceph-mgr1.xx.local ceph-mgr1
</span></span><span class="line"><span class="cl">10.1.0.41 ceph-mgr2.xx.local ceph-mgr2
</span></span><span class="line"><span class="cl">10.1.0.39 ceph-deploy.xx.local ceph-deploy</span></span></code></pre></div><h3 id="33-配置apt源">3.3 配置apt源</h3>
<div class="highlight" id="id-14"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">https://download.ceph.com/ <span class="c1">#Ceph官方源</span>
</span></span><span class="line"><span class="cl">https://mirrors.aliyun.com/ceph/ <span class="c1">#阿里云镜像仓库</span>
</span></span><span class="line"><span class="cl">http://mirrors.163.com/ceph/ <span class="c1">#网易镜像仓库 </span>
</span></span><span class="line"><span class="cl">https://mirrors.tuna.tsinghua.edu.cn/ceph/ <span class="c1">#清华大学镜像源</span></span></span></code></pre></div><p><strong>所有节点添加ceph 源</strong></p>
<div class="highlight" id="id-15"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget -q -O- <span class="s1">&#39;https://download.ceph.com/keys/release.asc&#39;</span> <span class="p">|</span> sudo apt-key add -
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> deb https://download.ceph.com/debian-pacific/ <span class="k">$(</span>lsb_release -sc<span class="k">)</span> main <span class="p">|</span> sudo tee /etc/apt/sources.list.d/ceph.list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo apt update</span></span></code></pre></div><h3 id="34-时间同步">3.4 <strong>时间同步</strong></h3>
<div class="highlight" id="id-16"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#设置时区</span>
</span></span><span class="line"><span class="cl">timedatectl set-timezone Asia/Shanghai
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#安装chrony</span>
</span></span><span class="line"><span class="cl"><span class="c1">#三节点安装</span>
</span></span><span class="line"><span class="cl">apt install chrony -y
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">##服务端配置</span>
</span></span><span class="line"><span class="cl">vim /etc/chrony/chrony.conf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Welcome to the chrony configuration file. See chrony.conf(5) for more</span>
</span></span><span class="line"><span class="cl"><span class="c1"># information about usuable directives.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># This will use (up to):</span>
</span></span><span class="line"><span class="cl"><span class="c1"># - 4 sources from ntp.ubuntu.com which some are ipv6 enabled</span>
</span></span><span class="line"><span class="cl"><span class="c1"># - 2 sources from 2.ubuntu.pool.ntp.org which is ipv6 enabled as well</span>
</span></span><span class="line"><span class="cl"><span class="c1"># - 1 source from [01].ubuntu.pool.ntp.org each (ipv4 only atm)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># This means by default, up to 6 dual-stack and up to 2 additional IPv4-only</span>
</span></span><span class="line"><span class="cl"><span class="c1"># sources will be used.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># At the same time it retains some protection against one of the entries being</span>
</span></span><span class="line"><span class="cl"><span class="c1"># down (compare to just using one of the lines). See (LP: #1754358) for the</span>
</span></span><span class="line"><span class="cl"><span class="c1"># discussion.</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># About using servers from the NTP Pool Project in general see (LP: #104525).</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Approved by Ubuntu Technical Board on 2011-02-08.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># See http://www.pool.ntp.org/join.html for more information.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 因为想修改本地时间，不去和其他服务器同步，将下面这四个pool注释掉</span>
</span></span><span class="line"><span class="cl">pool ntp.ubuntu.com        iburst maxsources <span class="m">4</span>
</span></span><span class="line"><span class="cl"><span class="c1">#pool 0.ubuntu.pool.ntp.org iburst maxsources 1</span>
</span></span><span class="line"><span class="cl"><span class="c1">#pool 1.ubuntu.pool.ntp.org iburst maxsources 1</span>
</span></span><span class="line"><span class="cl"><span class="c1">#pool 2.ubuntu.pool.ntp.org iburst maxsources 2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 添加自己作为服务器</span>
</span></span><span class="line"><span class="cl"><span class="c1">#server 192.168.1.1 iburst</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 为了方便客户端连接权限设置为允许所有</span>
</span></span><span class="line"><span class="cl">allow all
</span></span><span class="line"><span class="cl"><span class="c1"># 当无法和其他同步时，使用本地的时间去给客户端同步</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#注释：值10可以被其他值取代（1~15），stratum 1表示计算机具有直接连接的真实时间的参考时间源，例如gps，原子钟都和真实时间很接近欸， #stratum 2表示计算机有一个stratum 1的计算机作为同步时间源，stratum 3表示该计算机有一个stratum 10的计算机作为同步时间源。 #选择stratum 10.这个值是比较大的，表示距离有真实时间的服务器比较远，它的时间不太可靠，因此，local命令选取stratum 10可以 #防止机器本身的时间与真实时间混淆，可以保证该机器不会将本身的时间授给那些可以连接同步到真实时间的ntp服务器的ntp客户端】</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">local</span> stratum <span class="m">10</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># This directive specify the location of the file containing ID/key pairs for</span>
</span></span><span class="line"><span class="cl"><span class="c1"># NTP authentication.</span>
</span></span><span class="line"><span class="cl">keyfile /etc/chrony/chrony.keys
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># This directive specify the file into which chronyd will store the rate</span>
</span></span><span class="line"><span class="cl"><span class="c1"># information.</span>
</span></span><span class="line"><span class="cl">driftfile /var/lib/chrony/chrony.drift
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Uncomment the following line to turn logging on.</span>
</span></span><span class="line"><span class="cl"><span class="c1">#log tracking measurements statistics</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Log files location.</span>
</span></span><span class="line"><span class="cl">logdir /var/log/chrony
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Stop bad estimates upsetting machine clock.</span>
</span></span><span class="line"><span class="cl">maxupdateskew 100.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># This directive enables kernel synchronisation (every 11 minutes) of the</span>
</span></span><span class="line"><span class="cl"><span class="c1"># real-time clock. Note that it can’t be used along with the &#39;rtcfile&#39; directive.</span>
</span></span><span class="line"><span class="cl">rtcsync
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step the system clock instead of slewing it if the adjustment is larger than</span>
</span></span><span class="line"><span class="cl"><span class="c1"># one second, but only in the first three clock updates.</span>
</span></span><span class="line"><span class="cl">makestep <span class="m">1</span> <span class="m">3</span></span></span></code></pre></div><div class="highlight" id="id-17"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1">#客户端</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># This will use (up to):</span>
</span></span><span class="line"><span class="cl"><span class="c1"># - 4 sources from ntp.ubuntu.com which some are ipv6 enabled</span>
</span></span><span class="line"><span class="cl"><span class="c1"># - 2 sources from 2.ubuntu.pool.ntp.org which is ipv6 enabled as well</span>
</span></span><span class="line"><span class="cl"><span class="c1"># - 1 source from [01].ubuntu.pool.ntp.org each (ipv4 only atm)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># This means by default, up to 6 dual-stack and up to 2 additional IPv4-only</span>
</span></span><span class="line"><span class="cl"><span class="c1"># sources will be used.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># At the same time it retains some protection against one of the entries being</span>
</span></span><span class="line"><span class="cl"><span class="c1"># down (compare to just using one of the lines). See (LP: #1754358) for the</span>
</span></span><span class="line"><span class="cl"><span class="c1"># discussion.</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># About using servers from the NTP Pool Project in general see (LP: #104525).</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Approved by Ubuntu Technical Board on 2011-02-08.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># See http://www.pool.ntp.org/join.html for more information.</span>
</span></span><span class="line"><span class="cl">pool 10.1.0.39        iburst maxsources <span class="m">4</span>
</span></span><span class="line"><span class="cl"><span class="c1">#pool 0.ubuntu.pool.ntp.org iburst maxsources 1</span>
</span></span><span class="line"><span class="cl"><span class="c1">#pool 1.ubuntu.pool.ntp.org iburst maxsources 1</span>
</span></span><span class="line"><span class="cl"><span class="c1">#pool 2.ubuntu.pool.ntp.org iburst maxsources 2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># This directive specify the location of the file containing ID/key pairs for</span>
</span></span><span class="line"><span class="cl"><span class="c1"># NTP authentication.</span>
</span></span><span class="line"><span class="cl">keyfile /etc/chrony/chrony.keys
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># This directive specify the file into which chronyd will store the rate</span>
</span></span><span class="line"><span class="cl"><span class="c1"># information.</span>
</span></span><span class="line"><span class="cl">driftfile /var/lib/chrony/chrony.drift
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Uncomment the following line to turn logging on.</span>
</span></span><span class="line"><span class="cl"><span class="c1">#log tracking measurements statistics</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Log files location.</span>
</span></span><span class="line"><span class="cl">logdir /var/log/chrony
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Stop bad estimates upsetting machine clock.</span>
</span></span><span class="line"><span class="cl">maxupdateskew 100.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># This directive enables kernel synchronisation (every 11 minutes) of the</span>
</span></span><span class="line"><span class="cl"><span class="c1"># real-time clock. Note that it can’t be used along with the &#39;rtcfile&#39; directive.</span>
</span></span><span class="line"><span class="cl">rtcsync
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step the system clock instead of slewing it if the adjustment is larger than</span>
</span></span><span class="line"><span class="cl"><span class="c1"># one second, but only in the first three clock updates.</span>
</span></span><span class="line"><span class="cl">makestep <span class="m">1</span> <span class="m">3</span></span></span></code></pre></div><div class="highlight" id="id-18"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#查看 ntp_servers 状态  </span>
</span></span><span class="line"><span class="cl">chronyc sourcestats -v
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#强制同步下系统时钟</span>
</span></span><span class="line"><span class="cl">chronyc -a makestep
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#查看 ntp_servers 是否在线</span>
</span></span><span class="line"><span class="cl">chronyc activity -v
</span></span><span class="line"><span class="cl"><span class="m">200</span> OK</span></span></code></pre></div><p><img loading="lazy" src="http://cdn1.ryanxin.live/1685437828034-ee86b801-b500-46ca-88c4-29e14b474792.png" srcset="http://cdn1.ryanxin.live/1685437828034-ee86b801-b500-46ca-88c4-29e14b474792.png, http://cdn1.ryanxin.live/1685437828034-ee86b801-b500-46ca-88c4-29e14b474792.png 1.5x, http://cdn1.ryanxin.live/1685437828034-ee86b801-b500-46ca-88c4-29e14b474792.png 2x" sizes="auto" data-title="http://cdn1.ryanxin.live/1685437828034-ee86b801-b500-46ca-88c4-29e14b474792.png" data-alt="http://cdn1.ryanxin.live/1685437828034-ee86b801-b500-46ca-88c4-29e14b474792.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="35-创建普通用户">3.5 创建普通用户</h3>
<p>推荐使用指定的普通用户部署和运行 ceph 集群，普通用户只要能以非交互方式执行 sudo 命令执行一些特权命令即可，新版的 ceph-deploy 可以指定包含 root 的在内只要可以执行 sudo 命令的用户，不过仍然推荐使用普通用户，比如 ceph、cephuser、cephadmin 这样的用户去管理 ceph 集群。</p>
<p>在包含 ceph-deploy 节点的存储节点、mon 节点和 mgr 节点等创建 ceph 用户。</p>
<div class="highlight" id="id-19"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1">#创建用户</span>
</span></span><span class="line"><span class="cl">groupadd -r -g <span class="m">20235</span> xceo <span class="o">&amp;&amp;</span> useradd -r -m -s /bin/bash -u <span class="m">20235</span> -g <span class="m">20235</span> xceo <span class="o">&amp;&amp;</span> <span class="nb">echo</span> xceo:ceamg.com <span class="p">|</span> chpasswd 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">~ <span class="c1">#:id xceo</span>
</span></span><span class="line"><span class="cl"><span class="nv">uid</span><span class="o">=</span>20235<span class="o">(</span>xceo<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>20235<span class="o">(</span>xceo<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>20235<span class="o">(</span>xceo<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#允许ceph 用户以sudo执行特殊权限</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;ceph    ALL=(ALL:ALL) NOPASSWD:ALL&#34;</span> &gt;&gt;  /etc/sudoers</span></span></code></pre></div><h3 id="36-配置免密登录">3.6 配置免密登录</h3>
<div class="highlight" id="id-20"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">root@ceph-node1:~ su - xceo
</span></span><span class="line"><span class="cl">ceph@ceph-node1:~$ 
</span></span><span class="line"><span class="cl">ceph@ceph-node1:~$ ssh-keygen
</span></span><span class="line"><span class="cl">ssh-copy-id ceph@10.1.0.40
</span></span><span class="line"><span class="cl">ssh-copy-id ceph@10.1.0.41
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ssh ceph-mon1.xx.local
</span></span><span class="line"><span class="cl">ssh ceph-mon2.xx.local
</span></span><span class="line"><span class="cl">ssh ceph-mon3.xx.local
</span></span><span class="line"><span class="cl">ssh ceph-mgr1.xx.local
</span></span><span class="line"><span class="cl">ssh ceph-mgr2.xx.local
</span></span><span class="line"><span class="cl">ssh ceph-node1.xx.local
</span></span><span class="line"><span class="cl">ssh ceph-node2.xx.local
</span></span><span class="line"><span class="cl">ssh ceph-node3.xx.local
</span></span><span class="line"><span class="cl">ssh ceph-deploy.xx.local</span></span></code></pre></div><h3 id="37-其他基本优化">3.7 其他基本优化</h3>
<div class="highlight" id="id-21"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">~$ vi /etc/sysctl.conf
</span></span><span class="line"><span class="cl">添加：
</span></span><span class="line"><span class="cl">fs.file-max <span class="o">=</span> <span class="m">10000000000</span>
</span></span><span class="line"><span class="cl">fs.nr_open <span class="o">=</span> <span class="m">1000000000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">~$ vi /etc/security/limits.conf
</span></span><span class="line"><span class="cl"><span class="c1">#root账户的资源软限制和硬限制</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root            soft    core            unlimited
</span></span><span class="line"><span class="cl">root            hard    core            unlimited
</span></span><span class="line"><span class="cl">root            soft    nproc           <span class="m">1000000</span>
</span></span><span class="line"><span class="cl">root            hard    nproc           <span class="m">1000000</span>
</span></span><span class="line"><span class="cl">root            soft    nofile          <span class="m">1000000</span>
</span></span><span class="line"><span class="cl">root            hard    nofile          <span class="m">1000000</span>
</span></span><span class="line"><span class="cl">root            soft    memlock         <span class="m">32000</span>
</span></span><span class="line"><span class="cl">root            hard    memlock         <span class="m">32000</span>
</span></span><span class="line"><span class="cl">root            soft    msgqueue        <span class="m">8192000</span>
</span></span><span class="line"><span class="cl">root            hard    msgqueue        <span class="m">8192000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#其他账户的资源软限制和硬限制</span>
</span></span><span class="line"><span class="cl">*              soft    core            unlimited
</span></span><span class="line"><span class="cl">*              hard    core            unlimited
</span></span><span class="line"><span class="cl">*              soft    nproc           <span class="m">1000000</span>
</span></span><span class="line"><span class="cl">*              hard    nproc           <span class="m">1000000</span>
</span></span><span class="line"><span class="cl">*              soft    nofile          <span class="m">1000000</span>
</span></span><span class="line"><span class="cl">*              hard    nofile          <span class="m">1000000</span>
</span></span><span class="line"><span class="cl">*              soft    memlock         <span class="m">32000</span>
</span></span><span class="line"><span class="cl">*              hard    memlock         <span class="m">32000</span>
</span></span><span class="line"><span class="cl">*              soft    msgqueue        <span class="m">8192000</span>
</span></span><span class="line"><span class="cl">*              hard    msgqueue        <span class="m">8192000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 将这两个修改过的文件拷贝到其他节点</span>
</span></span><span class="line"><span class="cl">~$ scp /etc/sysctl.conf ceph-node2:/etc/
</span></span><span class="line"><span class="cl">~$ scp /etc/sysctl.conf ceph-node3:/etc/
</span></span><span class="line"><span class="cl">~$ scp /etc/security/limits.conf ceph-node2:/etc/security/
</span></span><span class="line"><span class="cl">~$ scp /etc/security/limits.conf ceph-node3:/etc/security/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 在三台虚拟机上分别执行以下命令，让内核参数生效，并重启</span>
</span></span><span class="line"><span class="cl">~$ sysctl -p
</span></span><span class="line"><span class="cl">~$ reboot</span></span></code></pre></div><h2 id="四部署-rados-集群">四、部署 RADOS 集群</h2>
<h3 id="41-安装ceph-deploy-部署工具">4.1 安装Ceph-Deploy 部署工具</h3>
<div class="highlight" id="id-22"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#查看可用版本</span>
</span></span><span class="line"><span class="cl">root@ceph-node1<span class="o">[</span>15:45:17<span class="o">]</span>~ <span class="c1">#:apt-cache madison ceph-deploy</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ceph-deploy <span class="p">|</span> 2.0.1-0ubuntu1.1 <span class="p">|</span> https://mirrors.tuna.tsinghua.edu.cn/ubuntu focal-updates/universe amd64 Packages
</span></span><span class="line"><span class="cl">ceph-deploy <span class="p">|</span> 2.0.1-0ubuntu1 <span class="p">|</span> https://mirrors.tuna.tsinghua.edu.cn/ubuntu focal/universe amd64 Packages
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root@ceph-node1<span class="o">[</span>15:45:17<span class="o">]</span>~ <span class="c1">#:apt install ceph-deploy -y</span></span></span></code></pre></div><h3 id="42-安装-python-27">4.2 安装 python 2.7</h3>
<div class="highlight" id="id-23"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">root@ceph-mon1<span class="o">[</span>09:49:37<span class="o">]</span>~ apt install python2.7
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#所有机器设置软链接</span>
</span></span><span class="line"><span class="cl">ln -sv /usr/bin/python2.7 /usr/bin/python2  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#安装好后 执行python2测试  如果可以执行，说明安装好了</span>
</span></span><span class="line"><span class="cl">root@ceph-mon1<span class="o">[</span>09:49:37<span class="o">]</span>~ <span class="c1">#:python2</span>
</span></span><span class="line"><span class="cl">Python 2.7.18 <span class="o">(</span>default, Jul  <span class="m">1</span> 2022, 12:27:04<span class="o">)</span> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>GCC 9.4.0<span class="o">]</span> on linux2
</span></span><span class="line"><span class="cl">Type <span class="s2">&#34;help&#34;</span>, <span class="s2">&#34;copyright&#34;</span>, <span class="s2">&#34;credits&#34;</span> or <span class="s2">&#34;license&#34;</span> <span class="k">for</span> more information.
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; </span></span></code></pre></div><h3 id="43-初始化ceph-deploy">4.3 初始化Ceph-Deploy</h3>
<div class="highlight" id="id-24"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1">#切换到xceo账户创建集群目录</span>
</span></span><span class="line"><span class="cl">~<span class="nv">$su</span> - xceo
</span></span><span class="line"><span class="cl">~$ <span class="nb">pwd</span>
</span></span><span class="line"><span class="cl">/home/xceo
</span></span><span class="line"><span class="cl">~$ mkdir ceph-cluster
</span></span><span class="line"><span class="cl">~$ <span class="nb">cd</span> ceph-cluster/
</span></span><span class="line"><span class="cl">~/ceph-cluster$ 
</span></span><span class="line"><span class="cl"><span class="c1">#查看的结果如下：</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">xceo@ceph-mon1:~/ceph-cluster$ ceph-deploy --help
</span></span><span class="line"><span class="cl">usage: ceph-deploy <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-v <span class="p">|</span> -q<span class="o">]</span> <span class="o">[</span>--version<span class="o">]</span> <span class="o">[</span>--username USERNAME<span class="o">]</span> <span class="o">[</span>--overwrite-conf<span class="o">]</span> <span class="o">[</span>--ceph-conf CEPH_CONF<span class="o">]</span> COMMAND ...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Easy Ceph deployment
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    -^-
</span></span><span class="line"><span class="cl">   /   <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   <span class="p">|</span>O o<span class="p">|</span>  ceph-deploy v2.0.1
</span></span><span class="line"><span class="cl">   <span class="o">)</span>.-.<span class="o">(</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;/|||\`
</span></span></span><span class="line"><span class="cl"><span class="s1">  | &#39;</span><span class="p">|</span><span class="sb">`</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">&#39;</span><span class="p">|</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Full documentation can be found at: http://ceph.com/ceph-deploy/docs</span></span></code></pre></div><p><strong>ceph-deploy 使用帮助</strong></p>
<pre tabindex="0"><code>ceph-deploy --help
new：开始部署一个新的 ceph 存储集群，并生成 CLUSTER.conf 集群配置文件和 keyring 认证文件。 
install: 在远程主机上安装 ceph 相关的软件包, 可以通过--release 指定安装的版本。 
rgw：管理 RGW 守护程序(RADOSGW,对象存储网关)。 
mgr：管理 MGR 守护程序(ceph-mgr,Ceph Manager DaemonCeph 管理器守护程序)。 
mds：管理 MDS 守护程序(Ceph Metadata Server，ceph 源数据服务器)。 
mon：管理 MON 守护程序(ceph-mon,ceph 监视器)。 
gatherkeys：从指定获取提供新节点的验证 keys，这些 keys 会在添加新的 MON/OSD/MDS 加入的时候使用。 
disk：管理远程主机磁盘。 
osd：在远程主机准备数据磁盘，即将指定远程主机的指定磁盘添加到 ceph 集群作为 osd 使用。
repo：远程主机仓库管理。 
admin：推送 ceph 集群配置文件和 client.admin 认证文件到远程主机。 
config：将 ceph.conf 配置文件推送到远程主机或从远程主机拷贝。 
uninstall：从远端主机删除安装包。 
purgedata：从/var/lib/ceph 删除 ceph 数据,会删除/etc/ceph 下的内容。 
purge: 删除远端主机的安装包和所有数据。 
forgetkeys：从本地主机删除所有的验证 keyring, 包括 client.admin, monitor, bootstrap 等认证文件。 
pkg：管理远端主机的安装包。 
calamari：安装并配置一个 calamari web 节点，calamari 是一个 web 监控平台。</code></pre><h3 id="44-生成mon配置文件">4.4 生成mon配置文件</h3>
<p>在管理节点初始化mon节点</p>
<div class="highlight" id="id-26"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">xceo@ceph-node1:~/ceph-cluster$ ceph-deploy new --cluster-network 192.168.10.0/24 --public-network 10.1.0.0/24 ceph-mon1.xx.local
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.conf<span class="o">][</span>DEBUG <span class="o">]</span> found configuration file at: /home/xceo/.cephdeploy.conf
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> Invoked <span class="o">(</span>2.0.1<span class="o">)</span>: /usr/bin/ceph-deploy new --cluster-network 192.168.10.0/24 --public-network 10.1.0.0/24 ceph-mon1.xx.local
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> ceph-deploy options:
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  verbose                       : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  quiet                         : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  username                      : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  overwrite_conf                : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  ceph_conf                     : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cluster                       : ceph
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  mon                           : <span class="o">[</span><span class="s1">&#39;ceph-mon1.xx.local&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  ssh_copykey                   : True
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  fsid                          : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cluster_network               : 192.168.10.0/24
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  public_network                : 10.1.0.0/24
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cd_conf                       : &lt;ceph_deploy.conf.cephdeploy.Conf object at 0x7fa0a0be30a0&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  default_release               : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  func                          : &lt;<span class="k">function</span> new at 0x7fa0a0bdaf70&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.new<span class="o">][</span>DEBUG <span class="o">]</span> Creating new cluster named ceph
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.new<span class="o">][</span>INFO  <span class="o">]</span> making sure passwordless SSH succeeds
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1.xx.local<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: ceph-node1 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1.xx.local<span class="o">][</span>INFO  <span class="o">]</span> Running command: ssh -CT -o <span class="nv">BatchMode</span><span class="o">=</span>yes ceph-mon1.xx.local
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1.xx.local<span class="o">][</span>DEBUG <span class="o">]</span> connection detected need <span class="k">for</span> sudo
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1.xx.local<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: ceph-mon1.xx.local 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1.xx.local<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo /bin/ip link show
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1.xx.local<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo /bin/ip addr show
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1.xx.local<span class="o">][</span>DEBUG <span class="o">]</span> IP addresses found: <span class="o">[</span><span class="s1">&#39;10.1.0.39&#39;</span>, <span class="s1">&#39;192.168.10.239&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.new<span class="o">][</span>DEBUG <span class="o">]</span> Resolving host ceph-mon1.xx.local
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.new<span class="o">][</span>DEBUG <span class="o">]</span> Monitor ceph-mon1 at 10.1.0.39
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.new<span class="o">][</span>DEBUG <span class="o">]</span> Monitor initial members are <span class="o">[</span><span class="s1">&#39;ceph-mon1&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.new<span class="o">][</span>DEBUG <span class="o">]</span> Monitor addrs are <span class="o">[</span><span class="s1">&#39;10.1.0.39&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.new<span class="o">][</span>DEBUG <span class="o">]</span> Creating a random mon key...
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.new<span class="o">][</span>DEBUG <span class="o">]</span> Writing monitor keyring to ceph.mon.keyring...
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.new<span class="o">][</span>DEBUG <span class="o">]</span> Writing initial config to ceph.conf...</span></span></code></pre></div><p>，是否生成配置文件</p>
<div class="highlight" id="id-27"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">xceo@ceph-node1:~/ceph-cluster$ ll
</span></span><span class="line"><span class="cl">total <span class="m">24</span>
</span></span><span class="line"><span class="cl">drwxrwxr-x <span class="m">2</span> xceo xceo <span class="m">4096</span> May <span class="m">26</span> 16:29 ./
</span></span><span class="line"><span class="cl">drwxr-xr-x <span class="m">5</span> xceo xceo <span class="m">4096</span> May <span class="m">26</span> 16:15 ../
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> xceo xceo  <span class="m">259</span> May <span class="m">26</span> 16:29 ceph.conf
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> xceo xceo <span class="m">7307</span> May <span class="m">26</span> 16:29 ceph-deploy-ceph.log
</span></span><span class="line"><span class="cl">-rw------- <span class="m">1</span> xceo xceo   <span class="m">73</span> May <span class="m">26</span> 16:29 ceph.mon.keyring
</span></span><span class="line"><span class="cl">xceo@ceph-node1:~/ceph-cluster$ cat ceph.conf 
</span></span><span class="line"><span class="cl"><span class="o">[</span>global<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">fsid</span> <span class="o">=</span> 31fdd971-2963-459b-9d6f-588f1811993f
</span></span><span class="line"><span class="cl"><span class="nv">public_network</span> <span class="o">=</span> 10.1.0.0/24
</span></span><span class="line"><span class="cl"><span class="nv">cluster_network</span> <span class="o">=</span> 192.168.10.0/24
</span></span><span class="line"><span class="cl"><span class="nv">mon_initial_members</span> <span class="o">=</span> ceph-mon1
</span></span><span class="line"><span class="cl"><span class="nv">mon_host</span> <span class="o">=</span> 10.1.0.39
</span></span><span class="line"><span class="cl"><span class="nv">auth_cluster_required</span> <span class="o">=</span> cephx
</span></span><span class="line"><span class="cl"><span class="nv">auth_service_required</span> <span class="o">=</span> cephx
</span></span><span class="line"><span class="cl"><span class="nv">auth_client_required</span> <span class="o">=</span> cephx</span></span></code></pre></div><p><strong>在安装过程中会报如下错误</strong>：</p>
<blockquote>
<p>[ceph_deploy][ERROR ] RuntimeError: AttributeError: module &lsquo;platform&rsquo; has no attribute &rsquo;linux_distribution&rsquo;</p>
</blockquote>
<p>这是由于python3.7后不再支持<strong>platform.linux_distribution</strong></p>
<p><strong>修改方法</strong>：</p>
<p>修改<code>/usr/lib/python3/dist-packages/ceph_deploy/hosts/remotes.py</code>文件为如下所示</p>
<div class="highlight" id="id-28"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">platform_information</span><span class="p">(</span><span class="n">_linux_distribution</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34; detect platform information from remote host &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    linux_distribution = _linux_distribution or platform.linux_distribution
</span></span></span><span class="line"><span class="cl"><span class="s2">    distro, release, codename = linux_distribution()
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">distro</span> <span class="o">=</span> <span class="n">release</span> <span class="o">=</span> <span class="n">codename</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">          <span class="n">linux_distribution</span> <span class="o">=</span> <span class="n">_linux_distribution</span> <span class="ow">or</span> <span class="n">platform</span><span class="o">.</span><span class="n">linux_distribution</span>
</span></span><span class="line"><span class="cl">          <span class="n">distro</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">codename</span> <span class="o">=</span> <span class="n">linux_distribution</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">          <span class="k">pass</span></span></span></code></pre></div><p>验证初始化完成之后，会得到三个文件</p>
<p>如下：</p>
<div class="highlight" id="id-29"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">xceo@ceph-node1:~/ceph-cluster$ ls
</span></span><span class="line"><span class="cl">ceph.conf  ceph-deploy-ceph.log  ceph.mon.keyring
</span></span><span class="line"><span class="cl">-------------------------------------------------
</span></span><span class="line"><span class="cl">ceph.conf   <span class="c1"># 配置文件</span>
</span></span><span class="line"><span class="cl">ceph-deploy-ceph.log <span class="c1">#部署的日志</span>
</span></span><span class="line"><span class="cl">ceph.mon.keyring  <span class="c1">#mon.keyring</span></span></span></code></pre></div><h3 id="45-初始化node节点">4.5 初始化node节点</h3>
<div class="highlight" id="id-30"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#no-adjust-repos 是不指定源 之前有配置好</span>
</span></span><span class="line"><span class="cl"><span class="c1">#使用普通账户下操作 （在ceph-cluster下操作会有报错）</span>
</span></span><span class="line"><span class="cl">xceo@ceph-mon1:~/ceph-cluster$ <span class="nb">cd</span> ~ 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ceph-deploy install --no-adjust-repos --nogpgcheck ceph-node1 ceph-node2 ceph-node3 （不指定版本）
</span></span><span class="line"><span class="cl">ceph-deploy install --no-adjust-repos --nogpgcheck --release pacific  ceph-node1   ceph-node2  ceph-node3（指定版本）</span></span></code></pre></div><div class="highlight" id="id-31"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">xceo@ceph-node1:~/ceph-cluster$ ceph-deploy install --no-adjust-repos --nogpgcheck --release pacific  ceph-node1  ceph-node2 ceph-node3</span></span></code></pre></div><h3 id="45--初始化mon节点">4.5  初始化mon节点</h3>
<p>在三个 mon 节点安装 ceph-mon</p>
<div class="highlight" id="id-32"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#注意安装mon时hostname要和Ceph.conf配置文件中mon主机名一样</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root@ceph-mon1<span class="o">[</span>10:40:52<span class="o">]</span>~ <span class="c1">#:apt-cache madison ceph-mon</span>
</span></span><span class="line"><span class="cl">  ceph-mon <span class="p">|</span> 16.2.13-1focal <span class="p">|</span> https://download.ceph.com/debian-pacific focal/main amd64 Packages
</span></span><span class="line"><span class="cl">  ceph-mon <span class="p">|</span> 15.2.17-0ubuntu0.20.04.4 <span class="p">|</span> http://mirrors.tuna.tsinghua.edu.cn/ubuntu focal-updates/main amd64 Packages
</span></span><span class="line"><span class="cl">  ceph-mon <span class="p">|</span> 15.2.17-0ubuntu0.20.04.3 <span class="p">|</span> http://mirrors.tuna.tsinghua.edu.cn/ubuntu focal-security/main amd64 Packages
</span></span><span class="line"><span class="cl">  ceph-mon <span class="p">|</span> 15.2.1-0ubuntu1 <span class="p">|</span> http://mirrors.tuna.tsinghua.edu.cn/ubuntu focal/main amd64 Packages
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="c1">#指定版本</span>
</span></span><span class="line"><span class="cl">apt -y install 16.2.13-1focal 
</span></span><span class="line"><span class="cl">xceo@ceph-mon1:~/ceph-cluster$ ceph-deploy mon create-initial
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.conf<span class="o">][</span>DEBUG <span class="o">]</span> found configuration file at: /home/xceo/.cephdeploy.conf
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> Invoked <span class="o">(</span>2.0.1<span class="o">)</span>: /usr/bin/ceph-deploy mon create-initial
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> ceph-deploy options:
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  verbose                       : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  quiet                         : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  username                      : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  overwrite_conf                : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  ceph_conf                     : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cluster                       : ceph
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  subcommand                    : create-initial
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cd_conf                       : &lt;ceph_deploy.conf.cephdeploy.Conf object at 0x7fb775ca7a60&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  default_release               : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  func                          : &lt;<span class="k">function</span> mon at 0x7fb775d12700&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  keyrings                      : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>DEBUG <span class="o">]</span> Deploying mon, cluster ceph hosts ceph-mon1
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>DEBUG <span class="o">]</span> detecting platform <span class="k">for</span> host ceph-mon1 ...
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span> connection detected need <span class="k">for</span> sudo
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: ceph-mon1 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>INFO  <span class="o">]</span> distro info: ubuntu 20.04 focal
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span> determining <span class="k">if</span> provided host has same hostname in remote
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span> deploying mon to ceph-mon1
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span> remote hostname: ceph-mon1
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span> checking <span class="k">for</span> <span class="k">done</span> path: /var/lib/ceph/mon/ceph-ceph-mon1/done
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span> <span class="k">done</span> path does not exist: /var/lib/ceph/mon/ceph-ceph-mon1/done
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>INFO  <span class="o">]</span> creating keyring file: /var/lib/ceph/tmp/ceph-ceph-mon1.mon.keyring
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo ceph-mon --cluster ceph --mkfs -i ceph-mon1 --keyring /var/lib/ceph/tmp/ceph-ceph-mon1.mon.keyring --setuser <span class="m">64045</span> --setgroup <span class="m">64045</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>INFO  <span class="o">]</span> unlinking keyring file /var/lib/ceph/tmp/ceph-ceph-mon1.mon.keyring
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo systemctl <span class="nb">enable</span> ceph.target
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo systemctl <span class="nb">enable</span> ceph-mon@ceph-mon1
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>WARNIN<span class="o">]</span> Created symlink /etc/systemd/system/ceph-mon.target.wants/ceph-mon@ceph-mon1.service → /lib/systemd/system/ceph-mon@.service.
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo systemctl start ceph-mon@ceph-mon1
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo ceph --cluster<span class="o">=</span>ceph --admin-daemon /var/run/ceph/ceph-mon.ceph-mon1.asok mon_status
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span> ********************************************************************************
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span> status <span class="k">for</span> monitor: mon.ceph-mon1
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;election_epoch&#34;</span>: 3,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;extra_probe_peers&#34;</span>: <span class="o">[]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;feature_map&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;mon&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;features&#34;</span>: <span class="s2">&#34;0x3f01cfbdfffdffff&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;num&#34;</span>: 1,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;release&#34;</span>: <span class="s2">&#34;luminous&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;features&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;quorum_con&#34;</span>: <span class="s2">&#34;4540138314316775423&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;quorum_mon&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;kraken&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;luminous&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;mimic&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;osdmap-prune&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;nautilus&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;octopus&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;pacific&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;elector-pinging&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;required_con&#34;</span>: <span class="s2">&#34;2449958747317026820&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;required_mon&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;kraken&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;luminous&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;mimic&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;osdmap-prune&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;nautilus&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;octopus&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;pacific&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;elector-pinging&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;monmap&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;created&#34;</span>: <span class="s2">&#34;2023-05-29T04:19:43.502249Z&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;disallowed_leaders: &#34;</span>: <span class="s2">&#34;&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;election_strategy&#34;</span>: 1,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;epoch&#34;</span>: 1,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;features&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;optional&#34;</span>: <span class="o">[]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;persistent&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;kraken&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;luminous&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;mimic&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;osdmap-prune&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;nautilus&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;octopus&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;pacific&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;elector-pinging&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;fsid&#34;</span>: <span class="s2">&#34;62be32df-9cb4-474f-8727-d5c4bbceaf97&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;min_mon_release&#34;</span>: 16,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;min_mon_release_name&#34;</span>: <span class="s2">&#34;pacific&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;modified&#34;</span>: <span class="s2">&#34;2023-05-29T04:19:43.502249Z&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;mons&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;addr&#34;</span>: <span class="s2">&#34;10.1.0.39:6789/0&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;crush_location&#34;</span>: <span class="s2">&#34;{}&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;ceph-mon1&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;priority&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;public_addr&#34;</span>: <span class="s2">&#34;10.1.0.39:6789/0&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;public_addrs&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>           <span class="s2">&#34;addrvec&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>             <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;addr&#34;</span>: <span class="s2">&#34;10.1.0.39:3300&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;nonce&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;type&#34;</span>: <span class="s2">&#34;v2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>             <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>             <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;addr&#34;</span>: <span class="s2">&#34;10.1.0.39:6789&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;nonce&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;type&#34;</span>: <span class="s2">&#34;v1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>             <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>           <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;rank&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;weight&#34;</span>: <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;removed_ranks: &#34;</span>: <span class="s2">&#34;&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;stretch_mode&#34;</span>: false,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;tiebreaker_mon&#34;</span>: <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;ceph-mon1&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;outside_quorum&#34;</span>: <span class="o">[]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;quorum&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;quorum_age&#34;</span>: 3,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;rank&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;state&#34;</span>: <span class="s2">&#34;leader&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;stretch_mode&#34;</span>: false,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;sync_provider&#34;</span>: <span class="o">[]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span> ********************************************************************************
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>INFO  <span class="o">]</span> monitor: mon.ceph-mon1 is running
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo ceph --cluster<span class="o">=</span>ceph --admin-daemon /var/run/ceph/ceph-mon.ceph-mon1.asok mon_status
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>INFO  <span class="o">]</span> processing monitor mon.ceph-mon1
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span> connection detected need <span class="k">for</span> sudo
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: ceph-mon1 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo ceph --cluster<span class="o">=</span>ceph --admin-daemon /var/run/ceph/ceph-mon.ceph-mon1.asok mon_status
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>INFO  <span class="o">]</span> mon.ceph-mon1 monitor has reached quorum!
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>INFO  <span class="o">]</span> all initial monitors are running and have formed quorum
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>INFO  <span class="o">]</span> Running gatherkeys...
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.gatherkeys<span class="o">][</span>INFO  <span class="o">]</span> Storing keys in temp directory /tmp/tmpcsuc00de
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span> connection detected need <span class="k">for</span> sudo
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: ceph-mon1 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo /usr/bin/ceph --connect-timeout<span class="o">=</span><span class="m">25</span> --cluster<span class="o">=</span>ceph --admin-daemon<span class="o">=</span>/var/run/ceph/ceph-mon.ceph-mon1.asok mon_status
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo /usr/bin/ceph --connect-timeout<span class="o">=</span><span class="m">25</span> --cluster<span class="o">=</span>ceph --name mon. --keyring<span class="o">=</span>/var/lib/ceph/mon/ceph-ceph-mon1/keyring auth get client.admin
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo /usr/bin/ceph --connect-timeout<span class="o">=</span><span class="m">25</span> --cluster<span class="o">=</span>ceph --name mon. --keyring<span class="o">=</span>/var/lib/ceph/mon/ceph-ceph-mon1/keyring auth get client.bootstrap-mds
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo /usr/bin/ceph --connect-timeout<span class="o">=</span><span class="m">25</span> --cluster<span class="o">=</span>ceph --name mon. --keyring<span class="o">=</span>/var/lib/ceph/mon/ceph-ceph-mon1/keyring auth get client.bootstrap-mgr
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo /usr/bin/ceph --connect-timeout<span class="o">=</span><span class="m">25</span> --cluster<span class="o">=</span>ceph --name mon. --keyring<span class="o">=</span>/var/lib/ceph/mon/ceph-ceph-mon1/keyring auth get client.bootstrap-osd
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon1<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo /usr/bin/ceph --connect-timeout<span class="o">=</span><span class="m">25</span> --cluster<span class="o">=</span>ceph --name mon. --keyring<span class="o">=</span>/var/lib/ceph/mon/ceph-ceph-mon1/keyring auth get client.bootstrap-rgw
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.gatherkeys<span class="o">][</span>INFO  <span class="o">]</span> Storing ceph.client.admin.keyring
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.gatherkeys<span class="o">][</span>INFO  <span class="o">]</span> Storing ceph.bootstrap-mds.keyring
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.gatherkeys<span class="o">][</span>INFO  <span class="o">]</span> Storing ceph.bootstrap-mgr.keyring
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.gatherkeys<span class="o">][</span>INFO  <span class="o">]</span> keyring <span class="s1">&#39;ceph.mon.keyring&#39;</span> already exists
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.gatherkeys<span class="o">][</span>INFO  <span class="o">]</span> Storing ceph.bootstrap-osd.keyring
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.gatherkeys<span class="o">][</span>INFO  <span class="o">]</span> Storing ceph.bootstrap-rgw.keyring
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.gatherkeys<span class="o">][</span>INFO  <span class="o">]</span> Destroy temp directory /tmp/tmpcsuc00de
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#查看生成ceph.client.admin.keyring的配置文件 （在哪台ceph机器管理集群，这个文件就放在哪里）</span>
</span></span><span class="line"><span class="cl">xceo@ceph-mon1:~/ceph-cluster$ ls
</span></span><span class="line"><span class="cl">ceph.bootstrap-mds.keyring  ceph.bootstrap-osd.keyring  ceph.client.admin.keyring  ceph-deploy-ceph.log
</span></span><span class="line"><span class="cl">ceph.bootstrap-mgr.keyring  ceph.bootstrap-rgw.keyring  ceph.conf                  ceph.mon.keyring
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#查看mon服务状态</span>
</span></span><span class="line"><span class="cl">xceo@ceph-mon1:~/ceph-cluster$ ps -ef <span class="p">|</span> grep ceph-mon
</span></span><span class="line"><span class="cl">ceph      <span class="m">898964</span>       <span class="m">1</span>  <span class="m">1</span> May29 ?        00:28:37 /usr/bin/ceph-mon -f --cluster ceph --id ceph-mon1 --setuser ceph --setgroup ceph</span></span></code></pre></div><h3 id="46-分发admin密钥到node节点非必须">4.6 分发admin密钥到node节点（非必须）</h3>
<p>保存好生成的<code>ceph.client.admin.keyring</code>文件
在deploy和node节点上安装 <strong>ceph- common</strong></p>
<div class="highlight" id="id-33"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt install ceph-common -y</span></span></code></pre></div><div class="highlight" id="id-34"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">xceo@ceph-mon1:~/ceph-cluster$ ceph-deploy --overwrite-conf admin ceph-node1 ceph-node2 ceph-node3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.conf<span class="o">][</span>DEBUG <span class="o">]</span> found configuration file at: /home/xceo/.cephdeploy.conf
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> Invoked <span class="o">(</span>2.0.1<span class="o">)</span>: /usr/bin/ceph-deploy --overwrite-conf admin ceph-node1 ceph-node2 ceph-node3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> ceph-deploy options:
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  verbose                       : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  quiet                         : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  username                      : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  overwrite_conf                : True
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  ceph_conf                     : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cluster                       : ceph
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  client                        : <span class="o">[</span><span class="s1">&#39;ceph-node1&#39;</span>, <span class="s1">&#39;ceph-node2&#39;</span>, <span class="s1">&#39;ceph-node3&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cd_conf                       : &lt;ceph_deploy.conf.cephdeploy.Conf object at 0x7f19678e51f0&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  default_release               : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  func                          : &lt;<span class="k">function</span> admin at 0x7f1967e2f040&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.admin<span class="o">][</span>DEBUG <span class="o">]</span> Pushing admin keys and conf to ceph-node1
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>DEBUG <span class="o">]</span> connection detected need <span class="k">for</span> sudo
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: ceph-node1 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.admin<span class="o">][</span>DEBUG <span class="o">]</span> Pushing admin keys and conf to ceph-node2
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node2<span class="o">][</span>DEBUG <span class="o">]</span> connection detected need <span class="k">for</span> sudo
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node2<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: ceph-node2 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.admin<span class="o">][</span>DEBUG <span class="o">]</span> Pushing admin keys and conf to ceph-node3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node3<span class="o">][</span>DEBUG <span class="o">]</span> connection detected need <span class="k">for</span> sudo
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node3<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: ceph-node3 </span></span></code></pre></div><p><img loading="lazy" src="http://cdn1.ryanxin.live/1685340529539-a5f5aa54-59e7-4d83-80d5-fe7f359f2ce8.png" srcset="http://cdn1.ryanxin.live/1685340529539-a5f5aa54-59e7-4d83-80d5-fe7f359f2ce8.png, http://cdn1.ryanxin.live/1685340529539-a5f5aa54-59e7-4d83-80d5-fe7f359f2ce8.png 1.5x, http://cdn1.ryanxin.live/1685340529539-a5f5aa54-59e7-4d83-80d5-fe7f359f2ce8.png 2x" sizes="auto" data-title="http://cdn1.ryanxin.live/1685340529539-a5f5aa54-59e7-4d83-80d5-fe7f359f2ce8.png" data-alt="http://cdn1.ryanxin.live/1685340529539-a5f5aa54-59e7-4d83-80d5-fe7f359f2ce8.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="http://cdn1.ryanxin.live/1685340558088-3db6d1c8-71bb-49dd-a203-2e04463ff3ef.png" srcset="http://cdn1.ryanxin.live/1685340558088-3db6d1c8-71bb-49dd-a203-2e04463ff3ef.png, http://cdn1.ryanxin.live/1685340558088-3db6d1c8-71bb-49dd-a203-2e04463ff3ef.png 1.5x, http://cdn1.ryanxin.live/1685340558088-3db6d1c8-71bb-49dd-a203-2e04463ff3ef.png 2x" sizes="auto" data-title="http://cdn1.ryanxin.live/1685340558088-3db6d1c8-71bb-49dd-a203-2e04463ff3ef.png" data-alt="http://cdn1.ryanxin.live/1685340558088-3db6d1c8-71bb-49dd-a203-2e04463ff3ef.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>认证文件的属主和属组为了安全考虑，默认设置为了root 用户和root组，如果需要ceph用户也能执行ceph 命令,那么就需要对ceph 用户进行授权<br>
<code>setfacl -m u:ceph:rw /etc/ceph/ceph.client.admin.keyring</code>
在deploy主机执行</p>
<div class="highlight" id="id-35"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">xceo@ceph-mon1:~$ sudo apt install acl
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root@ceph-mon1<span class="o">[</span>14:11:31<span class="o">]</span>~ <span class="c1">#:setfacl -m u:xceo:rw /etc/ceph/ceph.client.admin.keyring</span>
</span></span><span class="line"><span class="cl">xceo@ceph-mon1:~$ ceph -s
</span></span><span class="line"><span class="cl">  cluster:
</span></span><span class="line"><span class="cl">    id:     62be32df-9cb4-474f-8727-d5c4bbceaf97
</span></span><span class="line"><span class="cl">    health: HEALTH_WARN
</span></span><span class="line"><span class="cl">            mon is allowing insecure global_id reclaim
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  services:
</span></span><span class="line"><span class="cl">    mon: <span class="m">1</span> daemons, quorum ceph-mon1 <span class="o">(</span>age 112m<span class="o">)</span>
</span></span><span class="line"><span class="cl">    mgr: no daemons active
</span></span><span class="line"><span class="cl">    osd: <span class="m">0</span> osds: <span class="m">0</span> up, <span class="m">0</span> in
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  data:
</span></span><span class="line"><span class="cl">    pools:   <span class="m">0</span> pools, <span class="m">0</span> pgs
</span></span><span class="line"><span class="cl">    objects: <span class="m">0</span> objects, <span class="m">0</span> B
</span></span><span class="line"><span class="cl">    usage:   <span class="m">0</span> B used, <span class="m">0</span> B / <span class="m">0</span> B avail
</span></span><span class="line"><span class="cl">    pgs:     </span></span></code></pre></div><h3 id="47-部署ceph-mgr节点">4.7 部署Ceph-Mgr节点</h3>
<p>mgr节点需要读取ceph的配置文件，即/etc/ceph目录中的配置文件</p>
<div class="highlight" id="id-36"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#在mgr节点提前将mgr服务安装</span>
</span></span><span class="line"><span class="cl">apt install ceph-mgr -y
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">xceo@ceph-mon1:~/ceph-cluster$ ceph-deploy mgr create ceph-mgr1
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.conf<span class="o">][</span>DEBUG <span class="o">]</span> found configuration file at: /home/xceo/.cephdeploy.conf
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> Invoked <span class="o">(</span>2.0.1<span class="o">)</span>: /usr/bin/ceph-deploy mgr create ceph-mgr1
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> ceph-deploy options:
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  verbose                       : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  quiet                         : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  username                      : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  overwrite_conf                : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  ceph_conf                     : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cluster                       : ceph
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  subcommand                    : create
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cd_conf                       : &lt;ceph_deploy.conf.cephdeploy.Conf object at 0x7fd8738734c0&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  default_release               : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  func                          : &lt;<span class="k">function</span> mgr at 0x7fd87392ec10&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  mgr                           : <span class="o">[(</span><span class="s1">&#39;ceph-mgr1&#39;</span>, <span class="s1">&#39;ceph-mgr1&#39;</span><span class="o">)]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mgr<span class="o">][</span>DEBUG <span class="o">]</span> Deploying mgr, cluster ceph hosts ceph-mgr1:ceph-mgr1
</span></span><span class="line"><span class="cl">The authenticity of host <span class="s1">&#39;ceph-mgr1 (10.1.0.40)&#39;</span> can<span class="s1">&#39;t be established.
</span></span></span><span class="line"><span class="cl"><span class="s1">ECDSA key fingerprint is SHA256:lhRjKQBhgEhjbqcfKBb6oyle8C9EIOzu48QUoaeISIE.
</span></span></span><span class="line"><span class="cl"><span class="s1">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span></span></span><span class="line"><span class="cl"><span class="s1">Warning: Permanently added &#39;</span>ceph-mgr1<span class="s1">&#39; (ECDSA) to the list of known hosts.
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph-mgr1][DEBUG ] connection detected need for sudo
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph-mgr1][DEBUG ] connected to host: ceph-mgr1 
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.mgr][INFO  ] Distro info: ubuntu 20.04 focal
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.mgr][DEBUG ] remote host will use systemd
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.mgr][DEBUG ] deploying mgr bootstrap to ceph-mgr1
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph-mgr1][WARNIN] mgr keyring does not exist yet, creating one
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph-mgr1][INFO  ] Running command: sudo ceph --cluster ceph --name client.bootstrap-mgr --keyring /var/lib/ceph/bootstrap-mgr/ceph.keyring auth get-or-create mgr.ceph-mgr1 mon allow profile mgr osd allow * mds allow * -o /var/lib/ceph/mgr/ceph-ceph-mgr1/keyring
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph-mgr1][INFO  ] Running command: sudo systemctl enable ceph-mgr@ceph-mgr1
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph-mgr1][WARNIN] Created symlink /etc/systemd/system/ceph-mgr.target.wants/ceph-mgr@ceph-mgr1.service → /lib/systemd/system/ceph-mgr@.service.
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph-mgr1][INFO  ] Running command: sudo systemctl start ceph-mgr@ceph-mgr1
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph-mgr1][INFO  ] Running command: sudo systemctl enable ceph.target
</span></span></span><span class="line"><span class="cl"><span class="s1">xceo@ceph-mon1:~/ceph-cluster$ ceph-deploy mgr create ceph-mgr2
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.conf][DEBUG ] found configuration file at: /home/xceo/.cephdeploy.conf
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ] Invoked (2.0.1): /usr/bin/ceph-deploy mgr create ceph-mgr2
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ] ceph-deploy options:
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  verbose                       : False
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  quiet                         : False
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  username                      : None
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  overwrite_conf                : False
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  ceph_conf                     : None
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  cluster                       : ceph
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  subcommand                    : create
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  cd_conf                       : &lt;ceph_deploy.conf.cephdeploy.Conf object at 0x7f5b7f96b4c0&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  default_release               : False
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  func                          : &lt;function mgr at 0x7f5b7fa26c10&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  mgr                           : [(&#39;</span>ceph-mgr2<span class="s1">&#39;, &#39;</span>ceph-mgr2<span class="s1">&#39;)]
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.mgr][DEBUG ] Deploying mgr, cluster ceph hosts ceph-mgr2:ceph-mgr2
</span></span></span><span class="line"><span class="cl"><span class="s1">The authenticity of host &#39;</span>ceph-mgr2 <span class="o">(</span>10.1.0.41<span class="o">)</span><span class="s1">&#39; can&#39;</span>t be established.
</span></span><span class="line"><span class="cl">ECDSA key fingerprint is SHA256:lhRjKQBhgEhjbqcfKBb6oyle8C9EIOzu48QUoaeISIE.
</span></span><span class="line"><span class="cl">Are you sure you want to <span class="k">continue</span> connecting <span class="o">(</span>yes/no/<span class="o">[</span>fingerprint<span class="o">])</span>? yes
</span></span><span class="line"><span class="cl">Warning: Permanently added <span class="s1">&#39;ceph-mgr2&#39;</span> <span class="o">(</span>ECDSA<span class="o">)</span> to the list of known hosts.
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mgr2<span class="o">][</span>DEBUG <span class="o">]</span> connection detected need <span class="k">for</span> sudo
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mgr2<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: ceph-mgr2 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mgr<span class="o">][</span>INFO  <span class="o">]</span> Distro info: ubuntu 20.04 focal
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mgr<span class="o">][</span>DEBUG <span class="o">]</span> remote host will use systemd
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mgr<span class="o">][</span>DEBUG <span class="o">]</span> deploying mgr bootstrap to ceph-mgr2
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mgr2<span class="o">][</span>WARNIN<span class="o">]</span> mgr keyring does not exist yet, creating one
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mgr2<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo ceph --cluster ceph --name client.bootstrap-mgr --keyring /var/lib/ceph/bootstrap-mgr/ceph.keyring auth get-or-create mgr.ceph-mgr2 mon allow profile mgr osd allow * mds allow * -o /var/lib/ceph/mgr/ceph-ceph-mgr2/keyring
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mgr2<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo systemctl <span class="nb">enable</span> ceph-mgr@ceph-mgr2
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mgr2<span class="o">][</span>WARNIN<span class="o">]</span> Created symlink /etc/systemd/system/ceph-mgr.target.wants/ceph-mgr@ceph-mgr2.service → /lib/systemd/system/ceph-mgr@.service.
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mgr2<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo systemctl start ceph-mgr@ceph-mgr2
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mgr2<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo systemctl <span class="nb">enable</span> ceph.target</span></span></code></pre></div><p><strong>验证Mgr服务</strong></p>
<p><img loading="lazy" src="http://cdn1.ryanxin.live/1685340969835-70f851f8-f0eb-41ef-95cf-64ac614503ea.png" srcset="http://cdn1.ryanxin.live/1685340969835-70f851f8-f0eb-41ef-95cf-64ac614503ea.png, http://cdn1.ryanxin.live/1685340969835-70f851f8-f0eb-41ef-95cf-64ac614503ea.png 1.5x, http://cdn1.ryanxin.live/1685340969835-70f851f8-f0eb-41ef-95cf-64ac614503ea.png 2x" sizes="auto" data-title="http://cdn1.ryanxin.live/1685340969835-70f851f8-f0eb-41ef-95cf-64ac614503ea.png" data-alt="http://cdn1.ryanxin.live/1685340969835-70f851f8-f0eb-41ef-95cf-64ac614503ea.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="http://cdn1.ryanxin.live/1685340995744-eb4dc0e2-c70f-4c33-b924-1278ee9d9dc4.png" srcset="http://cdn1.ryanxin.live/1685340995744-eb4dc0e2-c70f-4c33-b924-1278ee9d9dc4.png, http://cdn1.ryanxin.live/1685340995744-eb4dc0e2-c70f-4c33-b924-1278ee9d9dc4.png 1.5x, http://cdn1.ryanxin.live/1685340995744-eb4dc0e2-c70f-4c33-b924-1278ee9d9dc4.png 2x" sizes="auto" data-title="img" data-alt="img" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><strong>在deploy上 查看 ceph -s</strong></p>
<p><img loading="lazy" src="http://cdn1.ryanxin.live/1685341057072-8c8cc7f4-f1ea-431d-981f-7fa5c95a4d59.png" srcset="http://cdn1.ryanxin.live/1685341057072-8c8cc7f4-f1ea-431d-981f-7fa5c95a4d59.png, http://cdn1.ryanxin.live/1685341057072-8c8cc7f4-f1ea-431d-981f-7fa5c95a4d59.png 1.5x, http://cdn1.ryanxin.live/1685341057072-8c8cc7f4-f1ea-431d-981f-7fa5c95a4d59.png 2x" sizes="auto" data-title="http://cdn1.ryanxin.live/1685341057072-8c8cc7f4-f1ea-431d-981f-7fa5c95a4d59.png" data-alt="http://cdn1.ryanxin.live/1685341057072-8c8cc7f4-f1ea-431d-981f-7fa5c95a4d59.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>图中目前有这个健康警告 <strong>mons are allowing…</strong></p>
<div class="highlight" id="id-37"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#由于启用了不安全信道，执行改完后没有该警告了</span>
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> mon auth_allow_insecure_global_id_reclaim false</span></span></code></pre></div><p><img loading="lazy" src="http://cdn1.ryanxin.live/1685341193126-32816fe4-3dd0-445b-bac5-7479fdc702e6.png" srcset="http://cdn1.ryanxin.live/1685341193126-32816fe4-3dd0-445b-bac5-7479fdc702e6.png, http://cdn1.ryanxin.live/1685341193126-32816fe4-3dd0-445b-bac5-7479fdc702e6.png 1.5x, http://cdn1.ryanxin.live/1685341193126-32816fe4-3dd0-445b-bac5-7479fdc702e6.png 2x" sizes="auto" data-title="http://cdn1.ryanxin.live/1685341193126-32816fe4-3dd0-445b-bac5-7479fdc702e6.png" data-alt="http://cdn1.ryanxin.live/1685341193126-32816fe4-3dd0-445b-bac5-7479fdc702e6.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="48-初始化-osd-节点">4.8 初始化 OSD 节点</h3>
<div class="highlight" id="id-38"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#在deploy主机执行</span>
</span></span><span class="line"><span class="cl">ceph-deploy install --release pacific ceph-node1 ceph-node2 ceph-node3 <span class="c1">#这步在初始化node节点已经做过</span>
</span></span><span class="line"><span class="cl"><span class="c1">#擦除磁盘之前通过deploy节点对node节点执行安装ceph基本运行环境 </span></span></span></code></pre></div><p><strong>报错</strong> <code>File &quot;/usr/lib/python3/dist-packages/ceph_deploy/util/decorators.py&quot;, line 69, in newfunc</code></p>
<div class="highlight" id="id-39"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#列出远端存储node节点的磁盘信息</span>
</span></span><span class="line"><span class="cl">xceo@ceph-mon1:~/ceph-cluster$ sudo ceph-deploy disk list ceph-node2 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.conf<span class="o">][</span>DEBUG <span class="o">]</span> found configuration file at: /root/.cephdeploy.conf
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> Invoked <span class="o">(</span>2.0.1<span class="o">)</span>: /usr/bin/ceph-deploy disk list ceph-node2
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> ceph-deploy options:
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  verbose                       : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  quiet                         : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  username                      : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  overwrite_conf                : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  ceph_conf                     : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cluster                       : ceph
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  subcommand                    : list
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cd_conf                       : &lt;ceph_deploy.conf.cephdeploy.Conf object at 0x7ff31b4353a0&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  default_release               : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  func                          : &lt;<span class="k">function</span> disk at 0x7ff31b4d2a60&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  host                          : <span class="o">[</span><span class="s1">&#39;ceph-node2&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  debug                         : False
</span></span><span class="line"><span class="cl">The authenticity of host <span class="s1">&#39;ceph-node2 (10.1.0.40)&#39;</span> can<span class="s1">&#39;t be established.
</span></span></span><span class="line"><span class="cl"><span class="s1">ECDSA key fingerprint is SHA256:lhRjKQBhgEhjbqcfKBb6oyle8C9EIOzu48QUoaeISIE.
</span></span></span><span class="line"><span class="cl"><span class="s1">Are you sure you want to continue connecting (yes/no/[fingerprint])? ^C[ceph_deploy][ERROR ] KeyboardInterrupt
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">xceo@ceph-mon1:~/ceph-cluster$ ceph-deploy disk list ceph-node2
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.conf][DEBUG ] found configuration file at: /home/xceo/.cephdeploy.conf
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ] Invoked (2.0.1): /usr/bin/ceph-deploy disk list ceph-node2
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ] ceph-deploy options:
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  verbose                       : False
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  quiet                         : False
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  username                      : None
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  overwrite_conf                : False
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  ceph_conf                     : None
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  cluster                       : ceph
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  subcommand                    : list
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  cd_conf                       : &lt;ceph_deploy.conf.cephdeploy.Conf object at 0x7f4c4cac53d0&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  default_release               : False
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  func                          : &lt;function disk at 0x7f4c4cb62af0&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  host                          : [&#39;</span>ceph-node2<span class="s1">&#39;]
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy.cli][INFO  ]  debug                         : False
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph-node2][DEBUG ] connection detected need for sudo
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph-node2][DEBUG ] connected to host: ceph-node2 
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph-node2][INFO  ] Running command: sudo fdisk -l
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy][ERROR ] Traceback (most recent call last):
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy][ERROR ]   File &#34;/usr/lib/python3/dist-packages/ceph_deploy/util/decorators.py&#34;, line 69, in newfunc
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy][ERROR ]     return f(*a, **kw)
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy][ERROR ]   File &#34;/usr/lib/python3/dist-packages/ceph_deploy/cli.py&#34;, line 166, in _main
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy][ERROR ]     return args.func(args)
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy][ERROR ]   File &#34;/usr/lib/python3/dist-packages/ceph_deploy/osd.py&#34;, line 434, in disk
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy][ERROR ]     disk_list(args, cfg)
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy][ERROR ]   File &#34;/usr/lib/python3/dist-packages/ceph_deploy/osd.py&#34;, line 375, in disk_list
</span></span></span><span class="line"><span class="cl"><span class="s1">[ceph_deploy][ERROR ]     if line.startswith(&#39;</span>Disk /<span class="err">&#39;</span><span class="o">)</span>:
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy<span class="o">][</span>ERROR <span class="o">]</span> TypeError: startswith first arg must be bytes or a tuple of bytes, not str
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy<span class="o">][</span>ERROR <span class="o">]</span> </span></span></code></pre></div><p><strong>解决方法</strong></p>
<div class="highlight" id="id-40"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">vim</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">/</span><span class="n">dist</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">ceph_deploy</span><span class="o">/</span><span class="n">osd</span><span class="o">.</span><span class="n">py中</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Disk /&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="c1">#替换为</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Disk /&#39;</span><span class="p">):</span>  </span></span></code></pre></div><div class="highlight" id="id-41"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ceph-deploy disk list ceph-node1   
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.conf<span class="o">][</span>DEBUG <span class="o">]</span> found configuration file at: /home/xceo/.cephdeploy.conf
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> Invoked <span class="o">(</span>2.0.1<span class="o">)</span>: /usr/bin/ceph-deploy disk list ceph-node1
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> ceph-deploy options:
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  verbose                       : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  quiet                         : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  username                      : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  overwrite_conf                : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  ceph_conf                     : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cluster                       : ceph
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  subcommand                    : list
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cd_conf                       : &lt;ceph_deploy.conf.cephdeploy.Conf object at 0x7f90a9868310&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  default_release               : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  func                          : &lt;<span class="k">function</span> disk at 0x7f90a9906af0&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  host                          : <span class="o">[</span><span class="s1">&#39;ceph-node1&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  debug                         : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>DEBUG <span class="o">]</span> connection detected need <span class="k">for</span> sudo
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: ceph-node1 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo fdisk -l
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>INFO  <span class="o">]</span> b<span class="s1">&#39;Disk /dev/loop0: 55.45 MiB, 58130432 bytes, 113536 sectors&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>INFO  <span class="o">]</span> b<span class="s1">&#39;Disk /dev/loop1: 55.65 MiB, 58339328 bytes, 113944 sectors&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>INFO  <span class="o">]</span> b<span class="s1">&#39;Disk /dev/loop2: 70.32 MiB, 73728000 bytes, 144000 sectors&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>INFO  <span class="o">]</span> b<span class="s1">&#39;Disk /dev/loop3: 91.85 MiB, 96292864 bytes, 188072 sectors&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>INFO  <span class="o">]</span> b<span class="s1">&#39;Disk /dev/loop4: 53.24 MiB, 55824384 bytes, 109032 sectors&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>INFO  <span class="o">]</span> b<span class="s1">&#39;Disk /dev/loop5: 63.46 MiB, 66535424 bytes, 129952 sectors&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>INFO  <span class="o">]</span> b<span class="s1">&#39;Disk /dev/vda: 1 TiB, 1099511627776 bytes, 2147483648 sectors&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>INFO  <span class="o">]</span> b<span class="s1">&#39;Disk /dev/vdb: 120 GiB, 128849018880 bytes, 251658240 sectors&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>INFO  <span class="o">]</span> b<span class="s1">&#39;Disk /dev/vdc: 120 GiB, 128849018880 bytes, 251658240 sectors&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>INFO  <span class="o">]</span> b<span class="s1">&#39;Disk /dev/vdd: 120 GiB, 128849018880 bytes, 251658240 sectors&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>INFO  <span class="o">]</span> b<span class="s1">&#39;Disk /dev/vde: 120 GiB, 128849018880 bytes, 251658240 sectors&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>INFO  <span class="o">]</span> b<span class="s1">&#39;Disk /dev/vdf: 120 GiB, 128849018880 bytes, 251658240 sectors&#39;</span></span></span></code></pre></div><p>使用<code>ceph-deploy disk zap </code>擦除各<strong>ceph-osd</strong>节点的ceph数据磁盘</p>
<div class="highlight" id="id-42"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">xceo@ceph-mon1:~/ceph-cluster$ ceph-deploy disk zap  ceph-node1 /dev/vdb
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.conf<span class="o">][</span>DEBUG <span class="o">]</span> found configuration file at: /home/xceo/.cephdeploy.conf
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> Invoked <span class="o">(</span>2.0.1<span class="o">)</span>: /usr/bin/ceph-deploy disk zap ceph-node1 /dev/vdb
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> ceph-deploy options:
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  verbose                       : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  quiet                         : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  username                      : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  overwrite_conf                : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  ceph_conf                     : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cluster                       : ceph
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  subcommand                    : zap
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cd_conf                       : &lt;ceph_deploy.conf.cephdeploy.Conf object at 0x7fc53b4543a0&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  default_release               : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  func                          : &lt;<span class="k">function</span> disk at 0x7fc53b4f1af0&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  host                          : ceph-node1
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  disk                          : <span class="o">[</span><span class="s1">&#39;/dev/vdb&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  debug                         : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.osd<span class="o">][</span>DEBUG <span class="o">]</span> zapping /dev/vdb on ceph-node1
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>DEBUG <span class="o">]</span> connection detected need <span class="k">for</span> sudo
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: ceph-node1 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.osd<span class="o">][</span>INFO  <span class="o">]</span> Distro info: ubuntu 20.04 focal
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo /usr/sbin/ceph-volume lvm zap /dev/vdb
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> --&gt; Zapping: /dev/vdb
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> --&gt; --destroy was not specified, but zapping a whole device will remove the partition table
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>/dev/vdb <span class="nv">bs</span><span class="o">=</span>1M <span class="nv">count</span><span class="o">=</span><span class="m">10</span> <span class="nv">conv</span><span class="o">=</span>fsync
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span>  stderr: 10+0 records in
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> 10+0 records out
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span>  stderr: <span class="m">10485760</span> bytes <span class="o">(</span><span class="m">10</span> MB, <span class="m">10</span> MiB<span class="o">)</span> copied, 0.103617 s, <span class="m">101</span> MB/s
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> --&gt; Zapping successful <span class="k">for</span>: &lt;Raw Device: /dev/vdb&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">xceo@ceph-mon1:~/ceph-cluster$ ceph-deploy disk zap  ceph-node1 /dev/vdc
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.conf<span class="o">][</span>DEBUG <span class="o">]</span> found configuration file at: /home/xceo/.cephdeploy.conf
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> Invoked <span class="o">(</span>2.0.1<span class="o">)</span>: /usr/bin/ceph-deploy disk zap ceph-node1 /dev/vdc
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> ceph-deploy options:
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  verbose                       : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  quiet                         : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  username                      : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  overwrite_conf                : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  ceph_conf                     : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cluster                       : ceph
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  subcommand                    : zap
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cd_conf                       : &lt;ceph_deploy.conf.cephdeploy.Conf object at 0x7f9c0700b3a0&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  default_release               : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  func                          : &lt;<span class="k">function</span> disk at 0x7f9c070a9af0&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  host                          : ceph-node1
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  disk                          : <span class="o">[</span><span class="s1">&#39;/dev/vdc&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  debug                         : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.osd<span class="o">][</span>DEBUG <span class="o">]</span> zapping /dev/vdc on ceph-node1
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>DEBUG <span class="o">]</span> connection detected need <span class="k">for</span> sudo
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: ceph-node1 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.osd<span class="o">][</span>INFO  <span class="o">]</span> Distro info: ubuntu 20.04 focal
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo /usr/sbin/ceph-volume lvm zap /dev/vdc
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> --&gt; Zapping: /dev/vdc
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> --&gt; --destroy was not specified, but zapping a whole device will remove the partition table
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>/dev/vdc <span class="nv">bs</span><span class="o">=</span>1M <span class="nv">count</span><span class="o">=</span><span class="m">10</span> <span class="nv">conv</span><span class="o">=</span>fsync
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span>  stderr: 10+0 records in
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> 10+0 records out
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span>  stderr: <span class="m">10485760</span> bytes <span class="o">(</span><span class="m">10</span> MB, <span class="m">10</span> MiB<span class="o">)</span> copied, 0.106743 s, 98.2 MB/s
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> --&gt; Zapping successful <span class="k">for</span>: &lt;Raw Device: /dev/vdc&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">xceo@ceph-mon1:~/ceph-cluster$ ceph-deploy disk zap  ceph-node1 /dev/vdd
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.conf<span class="o">][</span>DEBUG <span class="o">]</span> found configuration file at: /home/xceo/.cephdeploy.conf
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> Invoked <span class="o">(</span>2.0.1<span class="o">)</span>: /usr/bin/ceph-deploy disk zap ceph-node1 /dev/vdd
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> ceph-deploy options:
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  verbose                       : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  quiet                         : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  username                      : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  overwrite_conf                : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  ceph_conf                     : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cluster                       : ceph
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  subcommand                    : zap
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cd_conf                       : &lt;ceph_deploy.conf.cephdeploy.Conf object at 0x7f719c0fa3a0&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  default_release               : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  func                          : &lt;<span class="k">function</span> disk at 0x7f719c197af0&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  host                          : ceph-node1
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  disk                          : <span class="o">[</span><span class="s1">&#39;/dev/vdd&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  debug                         : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.osd<span class="o">][</span>DEBUG <span class="o">]</span> zapping /dev/vdd on ceph-node1
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>DEBUG <span class="o">]</span> connection detected need <span class="k">for</span> sudo
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: ceph-node1 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.osd<span class="o">][</span>INFO  <span class="o">]</span> Distro info: ubuntu 20.04 focal
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo /usr/sbin/ceph-volume lvm zap /dev/vdd
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> --&gt; Zapping: /dev/vdd
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> --&gt; --destroy was not specified, but zapping a whole device will remove the partition table
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>/dev/vdd <span class="nv">bs</span><span class="o">=</span>1M <span class="nv">count</span><span class="o">=</span><span class="m">10</span> <span class="nv">conv</span><span class="o">=</span>fsync
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span>  stderr: 10+0 records in
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> 10+0 records out
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span>  stderr: <span class="m">10485760</span> bytes <span class="o">(</span><span class="m">10</span> MB, <span class="m">10</span> MiB<span class="o">)</span> copied, 0.122102 s, 85.9 MB/s
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> --&gt; Zapping successful <span class="k">for</span>: &lt;Raw Device: /dev/vdd&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">.....</span></span></code></pre></div><p><strong>擦除成功的提示</strong></p>
<p><img loading="lazy" src="http://cdn1.ryanxin.live/1685342554033-94f633d3-3be6-4522-a4b6-c0049fa78c2b.png" srcset="http://cdn1.ryanxin.live/1685342554033-94f633d3-3be6-4522-a4b6-c0049fa78c2b.png, http://cdn1.ryanxin.live/1685342554033-94f633d3-3be6-4522-a4b6-c0049fa78c2b.png 1.5x, http://cdn1.ryanxin.live/1685342554033-94f633d3-3be6-4522-a4b6-c0049fa78c2b.png 2x" sizes="auto" data-title="http://cdn1.ryanxin.live/1685342554033-94f633d3-3be6-4522-a4b6-c0049fa78c2b.png" data-alt="http://cdn1.ryanxin.live/1685342554033-94f633d3-3be6-4522-a4b6-c0049fa78c2b.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="49-添加osd-节点">4.9 添加OSD 节点</h3>
<ul>
<li><strong>Data</strong>：即ceph保存的对象数据</li>
<li>block：rocks DB 数据即元数据</li>
<li><strong>block-wal</strong>： 数据库的 wal 日志</li>
</ul>
<!-- raw HTML omitted -->
<p><strong>添加OSD节点前的告警</strong></p>
<p><img loading="lazy" src="http://cdn1.ryanxin.live/1685342766168-79dbda16-51c5-48fa-9374-daf989f4d94d.png" srcset="http://cdn1.ryanxin.live/1685342766168-79dbda16-51c5-48fa-9374-daf989f4d94d.png, http://cdn1.ryanxin.live/1685342766168-79dbda16-51c5-48fa-9374-daf989f4d94d.png 1.5x, http://cdn1.ryanxin.live/1685342766168-79dbda16-51c5-48fa-9374-daf989f4d94d.png 2x" sizes="auto" data-title="http://cdn1.ryanxin.live/1685342766168-79dbda16-51c5-48fa-9374-daf989f4d94d.png" data-alt="http://cdn1.ryanxin.live/1685342766168-79dbda16-51c5-48fa-9374-daf989f4d94d.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<div class="highlight" id="id-43"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#添加磁盘</span>
</span></span><span class="line"><span class="cl">xceo@ceph-mon1:~/ceph-cluster$ ceph-deploy osd create ceph-node1 --data /dev/vdb
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.conf<span class="o">][</span>DEBUG <span class="o">]</span> found configuration file at: /home/xceo/.cephdeploy.conf
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> Invoked <span class="o">(</span>2.0.1<span class="o">)</span>: /usr/bin/ceph-deploy osd create ceph-node1 --data /dev/vdb
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> ceph-deploy options:
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  verbose                       : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  quiet                         : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  username                      : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  overwrite_conf                : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  ceph_conf                     : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cluster                       : ceph
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  subcommand                    : create
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cd_conf                       : &lt;ceph_deploy.conf.cephdeploy.Conf object at 0x7fef2b8bbfa0&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  default_release               : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  func                          : &lt;<span class="k">function</span> osd at 0x7fef2b959a60&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  data                          : /dev/vdb
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  journal                       : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  zap_disk                      : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  fs_type                       : xfs
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  dmcrypt                       : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  dmcrypt_key_dir               : /etc/ceph/dmcrypt-keys
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  filestore                     : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  bluestore                     : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  block_db                      : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  block_wal                     : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  host                          : ceph-node1
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  debug                         : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.osd<span class="o">][</span>DEBUG <span class="o">]</span> Creating OSD on cluster ceph with data device /dev/vdb
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>DEBUG <span class="o">]</span> connection detected need <span class="k">for</span> sudo
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: ceph-node1 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.osd<span class="o">][</span>INFO  <span class="o">]</span> Distro info: ubuntu 20.04 focal
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.osd<span class="o">][</span>DEBUG <span class="o">]</span> Deploying osd to ceph-node1
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo /usr/sbin/ceph-volume --cluster ceph lvm create --bluestore --data /dev/vdb
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/ceph-authtool --gen-print-key
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/ceph --cluster ceph --name client.bootstrap-osd --keyring /var/lib/ceph/bootstrap-osd/ceph.keyring -i - osd new d9637751-9b7f-42d6-b9d8-2718039162b5
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: vgcreate --force --yes ceph-ac4ab09d-3655-4447-a0e3-d0d79f3b326a /dev/vdb
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span>  stdout: Physical volume <span class="s2">&#34;/dev/vdb&#34;</span> successfully created.
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span>  stdout: Volume group <span class="s2">&#34;ceph-ac4ab09d-3655-4447-a0e3-d0d79f3b326a&#34;</span> successfully created
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: lvcreate --yes -l <span class="m">30719</span> -n osd-block-d9637751-9b7f-42d6-b9d8-2718039162b5 ceph-ac4ab09d-3655-4447-a0e3-d0d79f3b326a
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span>  stdout: Logical volume <span class="s2">&#34;osd-block-d9637751-9b7f-42d6-b9d8-2718039162b5&#34;</span> created.
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/ceph-authtool --gen-print-key
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/mount -t tmpfs tmpfs /var/lib/ceph/osd/ceph-0
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> --&gt; Executable selinuxenabled not in PATH: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/chown -h ceph:ceph /dev/ceph-ac4ab09d-3655-4447-a0e3-d0d79f3b326a/osd-block-d9637751-9b7f-42d6-b9d8-2718039162b5
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/chown -R ceph:ceph /dev/dm-0
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/ln -s /dev/ceph-ac4ab09d-3655-4447-a0e3-d0d79f3b326a/osd-block-d9637751-9b7f-42d6-b9d8-2718039162b5 /var/lib/ceph/osd/ceph-0/block
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/ceph --cluster ceph --name client.bootstrap-osd --keyring /var/lib/ceph/bootstrap-osd/ceph.keyring mon getmap -o /var/lib/ceph/osd/ceph-0/activate.monmap
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span>  stderr: 2023-05-29T14:48:36.998+0800 7f3b7f4e2700 -1 auth: unable to find a keyring on /etc/ceph/ceph.client.bootstrap-osd.keyring,/etc/ceph/ceph.keyring,/etc/ceph/keyring,/etc/ceph/keyring.bin,: <span class="o">(</span>2<span class="o">)</span> No such file or directory
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> 2023-05-29T14:48:36.998+0800 7f3b7f4e2700 -1 AuthRegistry<span class="o">(</span>0x7f3b7805bc18<span class="o">)</span> no keyring found at /etc/ceph/ceph.client.bootstrap-osd.keyring,/etc/ceph/ceph.keyring,/etc/ceph/keyring,/etc/ceph/keyring.bin,, disabling cephx
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span>  stderr: got monmap epoch <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> --&gt; Creating keyring file <span class="k">for</span> osd.0
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/chown -R ceph:ceph /var/lib/ceph/osd/ceph-0/keyring
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/chown -R ceph:ceph /var/lib/ceph/osd/ceph-0/
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/ceph-osd --cluster ceph --osd-objectstore bluestore --mkfs -i <span class="m">0</span> --monmap /var/lib/ceph/osd/ceph-0/activate.monmap --keyfile - --osd-data /var/lib/ceph/osd/ceph-0/ --osd-uuid d9637751-9b7f-42d6-b9d8-2718039162b5 --setuser ceph --setgroup ceph
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span>  stderr: 2023-05-29T14:48:37.374+0800 7ff803100080 -1 bluestore<span class="o">(</span>/var/lib/ceph/osd/ceph-0/<span class="o">)</span> _read_fsid unparsable uuid
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> --&gt; ceph-volume lvm prepare successful <span class="k">for</span>: /dev/vdb
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/chown -R ceph:ceph /var/lib/ceph/osd/ceph-0
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/ceph-bluestore-tool --cluster<span class="o">=</span>ceph prime-osd-dir --dev /dev/ceph-ac4ab09d-3655-4447-a0e3-d0d79f3b326a/osd-block-d9637751-9b7f-42d6-b9d8-2718039162b5 --path /var/lib/ceph/osd/ceph-0 --no-mon-config
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/ln -snf /dev/ceph-ac4ab09d-3655-4447-a0e3-d0d79f3b326a/osd-block-d9637751-9b7f-42d6-b9d8-2718039162b5 /var/lib/ceph/osd/ceph-0/block
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/chown -h ceph:ceph /var/lib/ceph/osd/ceph-0/block
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/chown -R ceph:ceph /dev/dm-0
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/chown -R ceph:ceph /var/lib/ceph/osd/ceph-0
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/systemctl <span class="nb">enable</span> ceph-volume@lvm-0-d9637751-9b7f-42d6-b9d8-2718039162b5
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span>  stderr: Created symlink /etc/systemd/system/multi-user.target.wants/ceph-volume@lvm-0-d9637751-9b7f-42d6-b9d8-2718039162b5.service → /lib/systemd/system/ceph-volume@.service.
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/systemctl <span class="nb">enable</span> --runtime ceph-osd@0
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span>  stderr: Created symlink /run/systemd/system/ceph-osd.target.wants/ceph-osd@0.service → /lib/systemd/system/ceph-osd@.service.
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> Running command: /usr/bin/systemctl start ceph-osd@0
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> --&gt; ceph-volume lvm activate successful <span class="k">for</span> osd ID: <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> --&gt; ceph-volume lvm create successful <span class="k">for</span>: /dev/vdb
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>INFO  <span class="o">]</span> checking OSD status...
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo /bin/ceph --cluster<span class="o">=</span>ceph osd stat --format<span class="o">=</span>json
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-node1<span class="o">][</span>WARNIN<span class="o">]</span> there is <span class="m">1</span> OSD down
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.osd<span class="o">][</span>DEBUG <span class="o">]</span> Host ceph-node1 is now ready <span class="k">for</span> osd use.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">......</span></span></code></pre></div><p><strong>需要添加的磁盘如下</strong>：</p>
<div class="highlight" id="id-44"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#ceph-node1:</span>
</span></span><span class="line"><span class="cl">ceph-deploy osd create ceph-node1 --data /dev/vdb
</span></span><span class="line"><span class="cl">ceph-deploy osd create ceph-node1 --data /dev/vdc
</span></span><span class="line"><span class="cl">ceph-deploy osd create ceph-node1 --data /dev/vdd
</span></span><span class="line"><span class="cl">ceph-deploy osd create ceph-node1 --data /dev/vde
</span></span><span class="line"><span class="cl">ceph-deploy osd create ceph-node1 --data /dev/vdf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#ceph-node2:</span>
</span></span><span class="line"><span class="cl">ceph-deploy osd create ceph-node2 --data /dev/vdb
</span></span><span class="line"><span class="cl">ceph-deploy osd create ceph-node2 --data /dev/vdc
</span></span><span class="line"><span class="cl">ceph-deploy osd create ceph-node2 --data /dev/vdd
</span></span><span class="line"><span class="cl">ceph-deploy osd create ceph-node2 --data /dev/vde
</span></span><span class="line"><span class="cl">ceph-deploy osd create ceph-node2 --data /dev/vdf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#ceph-node3:</span>
</span></span><span class="line"><span class="cl">ceph-deploy osd create ceph-node3 --data /dev/vdb
</span></span><span class="line"><span class="cl">ceph-deploy osd create ceph-node3 --data /dev/vdc
</span></span><span class="line"><span class="cl">ceph-deploy osd create ceph-node3 --data /dev/vdd
</span></span><span class="line"><span class="cl">ceph-deploy osd create ceph-node3 --data /dev/vde
</span></span><span class="line"><span class="cl">ceph-deploy osd create ceph-node3 --data /dev/vdf</span></span></code></pre></div><p><strong>全部添加后再次检查ceph集群</strong></p>
<p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2023/png/33538388/1685343308038-5a612c63-5f1b-4f80-80d5-c64ce10cab81.png" srcset="https://cdn.nlark.com/yuque/0/2023/png/33538388/1685343308038-5a612c63-5f1b-4f80-80d5-c64ce10cab81.png, https://cdn.nlark.com/yuque/0/2023/png/33538388/1685343308038-5a612c63-5f1b-4f80-80d5-c64ce10cab81.png 1.5x, https://cdn.nlark.com/yuque/0/2023/png/33538388/1685343308038-5a612c63-5f1b-4f80-80d5-c64ce10cab81.png 2x" sizes="auto" data-title="https://cdn.nlark.com/yuque/0/2023/png/33538388/1685343308038-5a612c63-5f1b-4f80-80d5-c64ce10cab81.png" data-alt="https://cdn.nlark.com/yuque/0/2023/png/33538388/1685343308038-5a612c63-5f1b-4f80-80d5-c64ce10cab81.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><strong>在OSD节点上查看进程</strong></p>
<p><img loading="lazy" src="http://cdn1.ryanxin.live/1685343473333-7a63dcf3-c194-4799-bad1-40ed2251a362.png" srcset="http://cdn1.ryanxin.live/1685343473333-7a63dcf3-c194-4799-bad1-40ed2251a362.png, http://cdn1.ryanxin.live/1685343473333-7a63dcf3-c194-4799-bad1-40ed2251a362.png 1.5x, http://cdn1.ryanxin.live/1685343473333-7a63dcf3-c194-4799-bad1-40ed2251a362.png 2x" sizes="auto" data-title="http://cdn1.ryanxin.live/1685343473333-7a63dcf3-c194-4799-bad1-40ed2251a362.png" data-alt="http://cdn1.ryanxin.live/1685343473333-7a63dcf3-c194-4799-bad1-40ed2251a362.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><strong>备注</strong>：特别要注意 添加一定要记录 每个硬盘对应的数字， 以免后续故障后排查</p>
<p><img loading="lazy" src="http://cdn1.ryanxin.live/1685343405077-d33e4517-b9c3-48e4-b3b9-99fc1c69bbfe.png" srcset="http://cdn1.ryanxin.live/1685343405077-d33e4517-b9c3-48e4-b3b9-99fc1c69bbfe.png, http://cdn1.ryanxin.live/1685343405077-d33e4517-b9c3-48e4-b3b9-99fc1c69bbfe.png 1.5x, http://cdn1.ryanxin.live/1685343405077-d33e4517-b9c3-48e4-b3b9-99fc1c69bbfe.png 2x" sizes="auto" data-title="http://cdn1.ryanxin.live/1685343405077-d33e4517-b9c3-48e4-b3b9-99fc1c69bbfe.png" data-alt="http://cdn1.ryanxin.live/1685343405077-d33e4517-b9c3-48e4-b3b9-99fc1c69bbfe.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h2 id="五-验证-ceph-集群">五、 验证 Ceph 集群</h2>
<h3 id="51-从rados-移除osd">5.1 从RADOS 移除OSD</h3>
<p><strong>这个步骤主要做了解，一般不常用</strong></p>
<p>Ceph集群中的一个OSD是一个node节点的服务进程且对应于一个物理磁盘设备，是一个专用的守护进程。 <!-- raw HTML omitted --></p>
<p>在某OSD设备出现故障，或管理员处于管理之需确实要移除特定的OSD设备时，需要先停止相关的守护进程，而后再进行移除操作，对于linux以及以后的版本来说，停止和移除命令的格式分别如下：</p>
<div class="highlight" id="id-45"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"> 停用设备： ceph osd out <span class="o">{</span>osd-num<span class="o">}</span>
</span></span><span class="line"><span class="cl"> 停止进程： sudo systemctl stop ceph-osd@<span class="o">{</span>osd-num<span class="o">}</span>
</span></span><span class="line"><span class="cl"> 移除设备： ceph osd purge <span class="o">{</span>id<span class="o">}</span> --yes-i-really-mean-it</span></span></code></pre></div><p>OSD 的配置信息存在于 <code>ceph.conf</code> 配置文件中， 管理员在删除 OSD 之后手动将其删除</p>
<div class="highlight" id="id-46"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#于 CRUSH 运行图中移除设备</span>
</span></span><span class="line"><span class="cl">ceph osd crush remove <span class="o">{</span>name<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">#移除 OSD 的认证 key： </span>
</span></span><span class="line"><span class="cl">ceph auth del osd.<span class="o">{</span>osd-num<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">#最后移除 OSD 设备：</span>
</span></span><span class="line"><span class="cl">ceph osd rm <span class="o">{</span>osd-num<span class="o">}</span></span></span></code></pre></div><h3 id="52-测试上传和下载数据">5.2 测试上传和下载数据</h3>
<p>RADOS命令
存取数据时， 客户端必须首先连接至 RADOS 集群上某存储池， 然后根据对象名称由相关的CRUSH 规则完成数据对象寻址。 于是， 为了测试集群的数据存取功能， 这里首先创建一个用于测试的存储池 <strong>mypool</strong>， 并设定其 PG 数量为 32 个</p>
<p><strong>创建pool</strong></p>
<div class="highlight" id="id-47"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@ceph-mon1<span class="o">[</span>20:03:36<span class="o">]</span>~ <span class="c1">#:ceph osd pool create mypool 32 32 #创建</span>
</span></span><span class="line"><span class="cl">pool <span class="s1">&#39;mypool&#39;</span> created
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="c1">#或者rados lspools #验证  </span>
</span></span><span class="line"><span class="cl">root@ceph-mon1<span class="o">[</span>20:44:54<span class="o">]</span>~ <span class="c1">#:ceph osd pool ls</span>
</span></span><span class="line"><span class="cl">device_health_metrics
</span></span><span class="line"><span class="cl">mypool
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ceph pg ls-by-pool mypool <span class="p">|</span> awk <span class="s1">&#39;{print $1,$2,$15}&#39;</span> <span class="c1">#验证PG 与 PGP 组合</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root@ceph-mon1<span class="o">[</span>20:45:22<span class="o">]</span>~ <span class="c1">#:ceph pg ls-by-pool mypool | awk &#39;{print $1,$2,$15}&#39;</span>
</span></span><span class="line"><span class="cl">PG OBJECTS ACTING
</span></span><span class="line"><span class="cl">2.0 <span class="m">0</span> <span class="o">[</span>8,10,3<span class="o">]</span>p8
</span></span><span class="line"><span class="cl">2.1 <span class="m">0</span> <span class="o">[</span>2,13,9<span class="o">]</span>p2
</span></span><span class="line"><span class="cl">2.2 <span class="m">0</span> <span class="o">[</span>5,1,10<span class="o">]</span>p5
</span></span><span class="line"><span class="cl">2.3 <span class="m">0</span> <span class="o">[</span>5,4,14<span class="o">]</span>p5
</span></span><span class="line"><span class="cl">2.4 <span class="m">0</span> <span class="o">[</span>1,12,6<span class="o">]</span>p1
</span></span><span class="line"><span class="cl">2.5 <span class="m">0</span> <span class="o">[</span>12,4,8<span class="o">]</span>p12
</span></span><span class="line"><span class="cl">2.6 <span class="m">0</span> <span class="o">[</span>1,13,9<span class="o">]</span>p1
</span></span><span class="line"><span class="cl">2.7 <span class="m">0</span> <span class="o">[</span>6,13,2<span class="o">]</span>p6
</span></span><span class="line"><span class="cl">2.8 <span class="m">0</span> <span class="o">[</span>8,13,0<span class="o">]</span>p8
</span></span><span class="line"><span class="cl">2.9 <span class="m">0</span> <span class="o">[</span>4,9,12<span class="o">]</span>p4
</span></span><span class="line"><span class="cl">2.a <span class="m">0</span> <span class="o">[</span>11,4,8<span class="o">]</span>p11
</span></span><span class="line"><span class="cl">2.b <span class="m">0</span> <span class="o">[</span>13,7,4<span class="o">]</span>p13
</span></span><span class="line"><span class="cl">2.c <span class="m">0</span> <span class="o">[</span>12,0,5<span class="o">]</span>p12
</span></span><span class="line"><span class="cl">2.d <span class="m">0</span> <span class="o">[</span>12,8,3<span class="o">]</span>p12
</span></span><span class="line"><span class="cl">2.e <span class="m">0</span> <span class="o">[</span>2,13,8<span class="o">]</span>p2
</span></span><span class="line"><span class="cl">2.f <span class="m">0</span> <span class="o">[</span>11,8,0<span class="o">]</span>p11
</span></span><span class="line"><span class="cl">2.10 <span class="m">0</span> <span class="o">[</span>10,1,8<span class="o">]</span>p10
</span></span><span class="line"><span class="cl">2.11 <span class="m">0</span> <span class="o">[</span>6,1,12<span class="o">]</span>p6
</span></span><span class="line"><span class="cl">2.12 <span class="m">0</span> <span class="o">[</span>10,3,9<span class="o">]</span>p10
</span></span><span class="line"><span class="cl">2.13 <span class="m">0</span> <span class="o">[</span>13,6,3<span class="o">]</span>p13
</span></span><span class="line"><span class="cl">2.14 <span class="m">0</span> <span class="o">[</span>8,13,0<span class="o">]</span>p8
</span></span><span class="line"><span class="cl">2.15 <span class="m">0</span> <span class="o">[</span>10,1,5<span class="o">]</span>p10
</span></span><span class="line"><span class="cl">2.16 <span class="m">0</span> <span class="o">[</span>8,12,1<span class="o">]</span>p8
</span></span><span class="line"><span class="cl">2.17 <span class="m">0</span> <span class="o">[</span>6,14,2<span class="o">]</span>p6
</span></span><span class="line"><span class="cl">2.18 <span class="m">0</span> <span class="o">[</span>13,9,2<span class="o">]</span>p13
</span></span><span class="line"><span class="cl">2.19 <span class="m">0</span> <span class="o">[</span>3,6,13<span class="o">]</span>p3
</span></span><span class="line"><span class="cl">2.1a <span class="m">0</span> <span class="o">[</span>6,14,2<span class="o">]</span>p6
</span></span><span class="line"><span class="cl">2.1b <span class="m">0</span> <span class="o">[</span>11,7,3<span class="o">]</span>p11
</span></span><span class="line"><span class="cl">2.1c <span class="m">0</span> <span class="o">[</span>10,7,1<span class="o">]</span>p10
</span></span><span class="line"><span class="cl">2.1d <span class="m">0</span> <span class="o">[</span>10,7,0<span class="o">]</span>p10
</span></span><span class="line"><span class="cl">2.1e <span class="m">0</span> <span class="o">[</span>3,13,5<span class="o">]</span>p3
</span></span><span class="line"><span class="cl">2.1f <span class="m">0</span> <span class="o">[</span>4,7,14<span class="o">]</span>p4
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">* NOTE: afterwards</span></span></code></pre></div><p><strong>上传文件</strong></p>
<div class="highlight" id="id-48"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo rados put msg1 /var/log/syslog --pool<span class="o">=</span>mypool
</span></span><span class="line"><span class="cl"><span class="c1">#把消息文件上传到 mypool 并指定对象 id 为 msg1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">rados ls --pool<span class="o">=</span>mypool <span class="c1">#列出文件</span>
</span></span><span class="line"><span class="cl">root@ceph-mon1<span class="o">[</span>20:58:42<span class="o">]</span>~ <span class="c1">#:rados ls --pool=mypool</span>
</span></span><span class="line"><span class="cl">msg1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#可以获取到存储池中数据对象的具体位置信息：</span>
</span></span><span class="line"><span class="cl">root@ceph-mon1<span class="o">[</span>21:00:22<span class="o">]</span>~ <span class="c1">#:ceph osd map mypool msg1</span>
</span></span><span class="line"><span class="cl">osdmap e86 pool <span class="s1">&#39;mypool&#39;</span> <span class="o">(</span>2<span class="o">)</span> object <span class="s1">&#39;msg1&#39;</span> -&gt; pg 2.c833d430 <span class="o">(</span>2.10<span class="o">)</span> -&gt; up <span class="o">([</span>10,1,8<span class="o">]</span>, p10<span class="o">)</span> acting <span class="o">([</span>10,1,8<span class="o">]</span>, p10<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-------------------------------------------------------------------------------</span></span></code></pre></div><blockquote>
<p>表示文件存储了存储池 id 为 2 的 <strong>c833d430</strong> 的 PG 上,10 为当前 PG 的 id, 2.10 表示数据是在
id 为 2 的存储池中 id 为 10 的 PG 中存储，在线的 OSD 编号 <strong>10,1,8</strong>，<strong>主 OSD 为 10</strong>，活动
的OSD 10,1,8，三个OSD表示数据放一共3个副本，PG中的OSD是ceph的crush算法计算
算出三份数据保存在哪些OSD。</p>
</blockquote>
<p><strong>下载文件</strong></p>
<div class="highlight" id="id-49"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1">#下载mypool里的msg1文件 放在本地目录的名字</span>
</span></span><span class="line"><span class="cl">sudo rados get msg1 --pool<span class="o">=</span>mypool /opt/my.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">xceo@ceph-mon1:~/ceph-cluster$ sudo rados get msg1 --pool<span class="o">=</span>mypool /opt/my.txt
</span></span><span class="line"><span class="cl">xceo@ceph-mon1:~/ceph-cluster$ ll -ls /opt/my.txt 
</span></span><span class="line"><span class="cl"><span class="m">860</span> -rw-r--r-- <span class="m">1</span> root root <span class="m">879881</span> May <span class="m">30</span> 09:10 /opt/my.txt</span></span></code></pre></div><p><strong>修改文件</strong></p>
<div class="highlight" id="id-50"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#将/etc/passwd 上传到mypool下的 msg1文件中</span>
</span></span><span class="line"><span class="cl">xceo@ceph-mon1:~/ceph-cluster$ sudo rados put  msg1 /etc/passwd --pool<span class="o">=</span>mypool 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#重新从mypool里下载msg1 并存放本地目录重命名为/opt/my3.txt</span>
</span></span><span class="line"><span class="cl">xceo@ceph-mon1:~/ceph-cluster$ sudo rados get  msg1  --pool<span class="o">=</span>mypool /opt/my3.txt 
</span></span><span class="line"><span class="cl">xceo@ceph-mon1:~/ceph-cluster$ head /opt/my3.txt
</span></span><span class="line"><span class="cl">root:x:0:0:root:/root:/bin/bash
</span></span><span class="line"><span class="cl">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">sync:x:4:65534:sync:/bin:/bin/sync
</span></span><span class="line"><span class="cl">games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span></span><span class="line"><span class="cl">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span></span></code></pre></div><p><strong>删除文件</strong></p>
<div class="highlight" id="id-51"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo rados rm msg1 --pool<span class="o">=</span>mypool
</span></span><span class="line"><span class="cl">rados ls  --pool<span class="o">=</span>mypool</span></span></code></pre></div><h2 id="六扩展-ceph-实现高可用">六、扩展 ceph 实现高可用</h2>
<p>主要是扩展ceph集群的mon节点以及mgr节点 以实现集群高可用</p>
<h3 id="61-扩展-ceph-mon-节点">6.1 <strong>扩展 ceph-mon 节点</strong></h3>
<p>在mon2 mon3 上安装<strong>ceph-mon</strong>
Ceph-mon 是原生具备自噬以实现高可用机制的 ceph 服务，节点数量通常是奇数</p>
<div class="highlight" id="id-52"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#ubuntu上安装指定版本</span>
</span></span><span class="line"><span class="cl">apt install ceph-mon<span class="o">=</span>16.2.13-1focal
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#在ceph-deploy操作将mon3添加</span>
</span></span><span class="line"><span class="cl">ceph-deploy mon add ceph-mon2 ceph-mon3 </span></span></code></pre></div><div class="highlight" id="id-53"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#添加ceph-mon2 </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">xceo@ceph-mon1:~/ceph-cluster$ ceph-deploy mon add ceph-mon2
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.conf<span class="o">][</span>DEBUG <span class="o">]</span> found configuration file at: /home/xceo/.cephdeploy.conf
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> Invoked <span class="o">(</span>2.0.1<span class="o">)</span>: /usr/bin/ceph-deploy mon add ceph-mon2
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> ceph-deploy options:
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  verbose                       : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  quiet                         : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  username                      : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  overwrite_conf                : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  ceph_conf                     : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cluster                       : ceph
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  subcommand                    : add
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cd_conf                       : &lt;ceph_deploy.conf.cephdeploy.Conf object at 0x7f4eea93da90&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  default_release               : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  func                          : &lt;<span class="k">function</span> mon at 0x7f4eea9a8700&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  address                       : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  mon                           : <span class="o">[</span><span class="s1">&#39;ceph-mon2&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>INFO  <span class="o">]</span> ensuring configuration of new mon host: ceph-mon2
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.admin<span class="o">][</span>DEBUG <span class="o">]</span> Pushing admin keys and conf to ceph-mon2
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span> connection detected need <span class="k">for</span> sudo
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: ceph-mon2 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>DEBUG <span class="o">]</span> Adding mon to cluster ceph, host ceph-mon2
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>DEBUG <span class="o">]</span> using mon address by resolving host: 10.1.0.40
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>DEBUG <span class="o">]</span> detecting platform <span class="k">for</span> host ceph-mon2 ...
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span> connection detected need <span class="k">for</span> sudo
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: ceph-mon2 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>INFO  <span class="o">]</span> distro info: ubuntu 20.04 focal
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span> determining <span class="k">if</span> provided host has same hostname in remote
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span> adding mon to ceph-mon2
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span> checking <span class="k">for</span> <span class="k">done</span> path: /var/lib/ceph/mon/ceph-ceph-mon2/done
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo systemctl <span class="nb">enable</span> ceph.target
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo systemctl <span class="nb">enable</span> ceph-mon@ceph-mon2
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo systemctl start ceph-mon@ceph-mon2
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo ceph --cluster<span class="o">=</span>ceph --admin-daemon /var/run/ceph/ceph-mon.ceph-mon2.asok mon_status
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>WARNIN<span class="o">]</span> ceph-mon2 is not defined in <span class="sb">`</span>mon initial members<span class="sb">`</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>WARNIN<span class="o">]</span> monitor ceph-mon2 does not exist in monmap
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo ceph --cluster<span class="o">=</span>ceph --admin-daemon /var/run/ceph/ceph-mon.ceph-mon2.asok mon_status
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span> ********************************************************************************
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span> status <span class="k">for</span> monitor: mon.ceph-mon2
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;election_epoch&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;extra_probe_peers&#34;</span>: <span class="o">[]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;feature_map&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;mon&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;features&#34;</span>: <span class="s2">&#34;0x3f01cfbdfffdffff&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;num&#34;</span>: 1,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;release&#34;</span>: <span class="s2">&#34;luminous&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;features&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;quorum_con&#34;</span>: <span class="s2">&#34;0&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;quorum_mon&#34;</span>: <span class="o">[]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;required_con&#34;</span>: <span class="s2">&#34;2449958197560098820&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;required_mon&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;kraken&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;luminous&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;mimic&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;osdmap-prune&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;nautilus&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;octopus&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;pacific&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;elector-pinging&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;monmap&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;created&#34;</span>: <span class="s2">&#34;2023-05-29T04:19:43.502249Z&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;disallowed_leaders: &#34;</span>: <span class="s2">&#34;&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;election_strategy&#34;</span>: 1,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;epoch&#34;</span>: 1,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;features&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;optional&#34;</span>: <span class="o">[]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;persistent&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;kraken&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;luminous&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;mimic&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;osdmap-prune&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;nautilus&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;octopus&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;pacific&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;elector-pinging&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;fsid&#34;</span>: <span class="s2">&#34;62be32df-9cb4-474f-8727-d5c4bbceaf97&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;min_mon_release&#34;</span>: 16,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;min_mon_release_name&#34;</span>: <span class="s2">&#34;pacific&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;modified&#34;</span>: <span class="s2">&#34;2023-05-29T04:19:43.502249Z&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;mons&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;addr&#34;</span>: <span class="s2">&#34;10.1.0.39:6789/0&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;crush_location&#34;</span>: <span class="s2">&#34;{}&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;ceph-mon1&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;priority&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;public_addr&#34;</span>: <span class="s2">&#34;10.1.0.39:6789/0&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;public_addrs&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>           <span class="s2">&#34;addrvec&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>             <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;addr&#34;</span>: <span class="s2">&#34;10.1.0.39:3300&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;nonce&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;type&#34;</span>: <span class="s2">&#34;v2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>             <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>             <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;addr&#34;</span>: <span class="s2">&#34;10.1.0.39:6789&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;nonce&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;type&#34;</span>: <span class="s2">&#34;v1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>             <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>           <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;rank&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;weight&#34;</span>: <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;removed_ranks: &#34;</span>: <span class="s2">&#34;&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;stretch_mode&#34;</span>: false,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;tiebreaker_mon&#34;</span>: <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;ceph-mon2&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;outside_quorum&#34;</span>: <span class="o">[]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;quorum&#34;</span>: <span class="o">[]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;rank&#34;</span>: -1,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;state&#34;</span>: <span class="s2">&#34;probing&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;stretch_mode&#34;</span>: false,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;sync_provider&#34;</span>: <span class="o">[]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>DEBUG <span class="o">]</span> ********************************************************************************
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon2<span class="o">][</span>INFO  <span class="o">]</span> monitor: mon.ceph-mon2 is currently at the state of probing</span></span></code></pre></div><div class="highlight" id="id-54"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#添加ceph-mon2</span>
</span></span><span class="line"><span class="cl">xceo@ceph-mon1:~/ceph-cluster$ ceph-deploy mon add ceph-mon3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.conf<span class="o">][</span>DEBUG <span class="o">]</span> found configuration file at: /home/xceo/.cephdeploy.conf
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> Invoked <span class="o">(</span>2.0.1<span class="o">)</span>: /usr/bin/ceph-deploy mon add ceph-mon3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> ceph-deploy options:
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  verbose                       : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  quiet                         : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  username                      : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  overwrite_conf                : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  ceph_conf                     : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cluster                       : ceph
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  subcommand                    : add
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cd_conf                       : &lt;ceph_deploy.conf.cephdeploy.Conf object at 0x7fd7bb83da90&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  default_release               : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  func                          : &lt;<span class="k">function</span> mon at 0x7fd7bb8a8700&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  address                       : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  mon                           : <span class="o">[</span><span class="s1">&#39;ceph-mon3&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>INFO  <span class="o">]</span> ensuring configuration of new mon host: ceph-mon3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.admin<span class="o">][</span>DEBUG <span class="o">]</span> Pushing admin keys and conf to ceph-mon3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> connection detected need <span class="k">for</span> sudo
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: ceph-mon3 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>DEBUG <span class="o">]</span> Adding mon to cluster ceph, host ceph-mon3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>DEBUG <span class="o">]</span> using mon address by resolving host: 10.1.0.41
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>DEBUG <span class="o">]</span> detecting platform <span class="k">for</span> host ceph-mon3 ...
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> connection detected need <span class="k">for</span> sudo
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: ceph-mon3 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>INFO  <span class="o">]</span> distro info: ubuntu 20.04 focal
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> determining <span class="k">if</span> provided host has same hostname in remote
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> adding mon to ceph-mon3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> checking <span class="k">for</span> <span class="k">done</span> path: /var/lib/ceph/mon/ceph-ceph-mon3/done
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo systemctl <span class="nb">enable</span> ceph.target
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo systemctl <span class="nb">enable</span> ceph-mon@ceph-mon3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo systemctl start ceph-mon@ceph-mon3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo ceph --cluster<span class="o">=</span>ceph --admin-daemon /var/run/ceph/ceph-mon.ceph-mon3.asok mon_status
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>WARNIN<span class="o">]</span> ceph-mon3 is not defined in <span class="sb">`</span>mon initial members<span class="sb">`</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>WARNIN<span class="o">]</span> monitor ceph-mon3 does not exist in monmap
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo ceph --cluster<span class="o">=</span>ceph --admin-daemon /var/run/ceph/ceph-mon.ceph-mon3.asok mon_status
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> ********************************************************************************
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> status <span class="k">for</span> monitor: mon.ceph-mon3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;election_epoch&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;extra_probe_peers&#34;</span>: <span class="o">[]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;feature_map&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;mon&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;features&#34;</span>: <span class="s2">&#34;0x3f01cfbdfffdffff&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;num&#34;</span>: 1,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;release&#34;</span>: <span class="s2">&#34;luminous&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;features&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;quorum_con&#34;</span>: <span class="s2">&#34;0&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;quorum_mon&#34;</span>: <span class="o">[]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;required_con&#34;</span>: <span class="s2">&#34;2449958197560098820&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;required_mon&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;kraken&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;luminous&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;mimic&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;osdmap-prune&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;nautilus&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;octopus&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;pacific&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;elector-pinging&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;monmap&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;created&#34;</span>: <span class="s2">&#34;2023-05-29T04:19:43.502249Z&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;disallowed_leaders: &#34;</span>: <span class="s2">&#34;&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;election_strategy&#34;</span>: 1,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;epoch&#34;</span>: 2,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;features&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;optional&#34;</span>: <span class="o">[]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;persistent&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;kraken&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;luminous&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;mimic&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;osdmap-prune&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;nautilus&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;octopus&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;pacific&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;elector-pinging&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;fsid&#34;</span>: <span class="s2">&#34;62be32df-9cb4-474f-8727-d5c4bbceaf97&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;min_mon_release&#34;</span>: 16,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;min_mon_release_name&#34;</span>: <span class="s2">&#34;pacific&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;modified&#34;</span>: <span class="s2">&#34;2023-05-30T07:32:19.726912Z&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;mons&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;addr&#34;</span>: <span class="s2">&#34;10.1.0.39:6789/0&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;crush_location&#34;</span>: <span class="s2">&#34;{}&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;ceph-mon1&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;priority&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;public_addr&#34;</span>: <span class="s2">&#34;10.1.0.39:6789/0&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;public_addrs&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>           <span class="s2">&#34;addrvec&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>             <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;addr&#34;</span>: <span class="s2">&#34;10.1.0.39:3300&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;nonce&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;type&#34;</span>: <span class="s2">&#34;v2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>             <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>             <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;addr&#34;</span>: <span class="s2">&#34;10.1.0.39:6789&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;nonce&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;type&#34;</span>: <span class="s2">&#34;v1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>             <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>           <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;rank&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;weight&#34;</span>: <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;addr&#34;</span>: <span class="s2">&#34;10.1.0.40:6789/0&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;crush_location&#34;</span>: <span class="s2">&#34;{}&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;ceph-mon2&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;priority&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;public_addr&#34;</span>: <span class="s2">&#34;10.1.0.40:6789/0&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;public_addrs&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>           <span class="s2">&#34;addrvec&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>             <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;addr&#34;</span>: <span class="s2">&#34;10.1.0.40:3300&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;nonce&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;type&#34;</span>: <span class="s2">&#34;v2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>             <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>             <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;addr&#34;</span>: <span class="s2">&#34;10.1.0.40:6789&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;nonce&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;type&#34;</span>: <span class="s2">&#34;v1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>             <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>           <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;rank&#34;</span>: 1,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;weight&#34;</span>: <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;removed_ranks: &#34;</span>: <span class="s2">&#34;&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;stretch_mode&#34;</span>: false,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;tiebreaker_mon&#34;</span>: <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;ceph-mon3&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;outside_quorum&#34;</span>: <span class="o">[]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;quorum&#34;</span>: <span class="o">[]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;rank&#34;</span>: -1,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;state&#34;</span>: <span class="s2">&#34;probing&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;stretch_mode&#34;</span>: false,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;sync_provider&#34;</span>: <span class="o">[]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> ********************************************************************************
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>INFO  <span class="o">]</span> monitor: mon.ceph-mon3 is currently at the state of probing</span></span></code></pre></div><p><strong>验证集群ceph-mon状态</strong></p>
<div class="highlight" id="id-55"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ceph quorum_status --format json-pretty</span></span></code></pre></div><p><img loading="lazy" src="http://cdn1.ryanxin.live/1685432625919-a9560c77-28a0-4a8d-a356-bfee1b09a8a4.png" srcset="http://cdn1.ryanxin.live/1685432625919-a9560c77-28a0-4a8d-a356-bfee1b09a8a4.png, http://cdn1.ryanxin.live/1685432625919-a9560c77-28a0-4a8d-a356-bfee1b09a8a4.png 1.5x, http://cdn1.ryanxin.live/1685432625919-a9560c77-28a0-4a8d-a356-bfee1b09a8a4.png 2x" sizes="auto" data-title="http://cdn1.ryanxin.live/1685432625919-a9560c77-28a0-4a8d-a356-bfee1b09a8a4.png" data-alt="http://cdn1.ryanxin.live/1685432625919-a9560c77-28a0-4a8d-a356-bfee1b09a8a4.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><strong>在添加mon节点是出现问题如下</strong>：</p>
<div class="highlight" id="id-56"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">xceo@ceph-mon1:~/ceph-cluster$ ceph-deploy mon add ceph-mon3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.conf<span class="o">][</span>DEBUG <span class="o">]</span> found configuration file at: /home/xceo/.cephdeploy.conf
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> Invoked <span class="o">(</span>2.0.1<span class="o">)</span>: /usr/bin/ceph-deploy mon add ceph-mon3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span> ceph-deploy options:
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  verbose                       : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  quiet                         : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  username                      : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  overwrite_conf                : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  ceph_conf                     : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cluster                       : ceph
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  subcommand                    : add
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  cd_conf                       : &lt;ceph_deploy.conf.cephdeploy.Conf object at 0x7f068934ca90&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  default_release               : False
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  func                          : &lt;<span class="k">function</span> mon at 0x7f06893b7700&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  address                       : None
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.cli<span class="o">][</span>INFO  <span class="o">]</span>  mon                           : <span class="o">[</span><span class="s1">&#39;ceph-mon3&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>INFO  <span class="o">]</span> ensuring configuration of new mon host: ceph-mon3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.admin<span class="o">][</span>DEBUG <span class="o">]</span> Pushing admin keys and conf to ceph-mon3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> connection detected need <span class="k">for</span> sudo
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: ceph-mon3 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>DEBUG <span class="o">]</span> Adding mon to cluster ceph, host ceph-mon3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>DEBUG <span class="o">]</span> using mon address by resolving host: 10.1.0.41
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>DEBUG <span class="o">]</span> detecting platform <span class="k">for</span> host ceph-mon3 ...
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> connection detected need <span class="k">for</span> sudo
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> connected to host: ceph-mon3 
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph_deploy.mon<span class="o">][</span>INFO  <span class="o">]</span> distro info: ubuntu 20.04 focal
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> determining <span class="k">if</span> provided host has same hostname in remote
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> adding mon to ceph-mon3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> checking <span class="k">for</span> <span class="k">done</span> path: /var/lib/ceph/mon/ceph-ceph-mon3/done
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> <span class="k">done</span> path does not exist: /var/lib/ceph/mon/ceph-ceph-mon3/done
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>INFO  <span class="o">]</span> creating keyring file: /var/lib/ceph/tmp/ceph-ceph-mon3.mon.keyring
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo ceph --cluster ceph mon getmap -o /var/lib/ceph/tmp/ceph.ceph-mon3.monmap
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>WARNIN<span class="o">]</span> got monmap epoch <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo ceph-mon --cluster ceph --mkfs -i ceph-mon3 --monmap /var/lib/ceph/tmp/ceph.ceph-mon3.monmap --keyring /var/lib/ceph/tmp/ceph-ceph-mon3.mon.keyring --setuser <span class="m">64045</span> --setgroup <span class="m">64045</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>INFO  <span class="o">]</span> unlinking keyring file /var/lib/ceph/tmp/ceph-ceph-mon3.mon.keyring
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo systemctl <span class="nb">enable</span> ceph.target
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo systemctl <span class="nb">enable</span> ceph-mon@ceph-mon3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>WARNIN<span class="o">]</span> Created symlink /etc/systemd/system/ceph-mon.target.wants/ceph-mon@ceph-mon3.service → /lib/systemd/system/ceph-mon@.service.
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo systemctl start ceph-mon@ceph-mon3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo ceph --cluster<span class="o">=</span>ceph --admin-daemon /var/run/ceph/ceph-mon.ceph-mon3.asok mon_status
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>WARNIN<span class="o">]</span> ceph-mon3 is not defined in <span class="sb">`</span>mon initial members<span class="sb">`</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>WARNIN<span class="o">]</span> monitor ceph-mon3 does not exist in monmap
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>INFO  <span class="o">]</span> Running command: sudo ceph --cluster<span class="o">=</span>ceph --admin-daemon /var/run/ceph/ceph-mon.ceph-mon3.asok mon_status
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> ********************************************************************************
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> status <span class="k">for</span> monitor: mon.ceph-mon3
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;election_epoch&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;extra_probe_peers&#34;</span>: <span class="o">[]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;feature_map&#34;</span>: <span class="o">{}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;features&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;quorum_con&#34;</span>: <span class="s2">&#34;0&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;quorum_mon&#34;</span>: <span class="o">[]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;required_con&#34;</span>: <span class="s2">&#34;2449958197560098820&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;required_mon&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;kraken&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;luminous&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;mimic&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;osdmap-prune&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;nautilus&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;octopus&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;pacific&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;elector-pinging&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;monmap&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;created&#34;</span>: <span class="s2">&#34;2023-05-29T04:19:43.502249Z&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;disallowed_leaders: &#34;</span>: <span class="s2">&#34;&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;election_strategy&#34;</span>: 1,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;epoch&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;features&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;optional&#34;</span>: <span class="o">[]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="s2">&#34;persistent&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;kraken&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;luminous&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;mimic&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;osdmap-prune&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;nautilus&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;octopus&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;pacific&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;elector-pinging&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;fsid&#34;</span>: <span class="s2">&#34;62be32df-9cb4-474f-8727-d5c4bbceaf97&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;min_mon_release&#34;</span>: 16,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;min_mon_release_name&#34;</span>: <span class="s2">&#34;pacific&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;modified&#34;</span>: <span class="s2">&#34;2023-05-29T04:19:43.502249Z&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;mons&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;addr&#34;</span>: <span class="s2">&#34;10.1.0.39:6789/0&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;crush_location&#34;</span>: <span class="s2">&#34;{}&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;ceph-mon1&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;priority&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;public_addr&#34;</span>: <span class="s2">&#34;10.1.0.39:6789/0&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;public_addrs&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>           <span class="s2">&#34;addrvec&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>             <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;addr&#34;</span>: <span class="s2">&#34;10.1.0.39:3300&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;nonce&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;type&#34;</span>: <span class="s2">&#34;v2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>             <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>             <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;addr&#34;</span>: <span class="s2">&#34;10.1.0.39:6789&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;nonce&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>               <span class="s2">&#34;type&#34;</span>: <span class="s2">&#34;v1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>             <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>           <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;rank&#34;</span>: 0,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>         <span class="s2">&#34;weight&#34;</span>: <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>       <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;removed_ranks: &#34;</span>: <span class="s2">&#34;&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;stretch_mode&#34;</span>: false,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>     <span class="s2">&#34;tiebreaker_mon&#34;</span>: <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="o">}</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;ceph-mon3&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;outside_quorum&#34;</span>: <span class="o">[]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;quorum&#34;</span>: <span class="o">[]</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;rank&#34;</span>: -1,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;state&#34;</span>: <span class="s2">&#34;???&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;stretch_mode&#34;</span>: false,
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span>   <span class="s2">&#34;sync_provider&#34;</span>: <span class="o">[]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>DEBUG <span class="o">]</span> ********************************************************************************
</span></span><span class="line"><span class="cl"><span class="o">[</span>ceph-mon3<span class="o">][</span>INFO  <span class="o">]</span> monitor: mon.ceph-mon3 is currently at the state of ???
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#状态是？？？ </span></span></span></code></pre></div><p>查看日志</p>
<div class="highlight" id="id-57"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">May <span class="m">30</span> 15:30:45 ceph-mon2 ceph-mon<span class="o">[</span>3434060<span class="o">]</span>: 2023-05-30T15:30:45.027+0800 7f3d9ff07700 -1 mon.ceph-node2@-1<span class="o">(</span>probing<span class="o">)</span> e0 handle_auth_bad_method hmm, they didn<span class="s1">&#39;t like 2 result (13) Permission denied
</span></span></span><span class="line"><span class="cl"><span class="s1">May 30 15:31:00 ceph-mon2 ceph-mon[3434060]: 2023-05-30T15:31:00.044+0800 7f3d9ff07700 -1 mon.ceph-node2@-1(probing) e0 handle_auth_bad_method hmm, they didn&#39;</span>t like <span class="m">2</span> result <span class="o">(</span>13<span class="o">)</span> Permission denied
</span></span><span class="line"><span class="cl">May <span class="m">30</span> 15:31:15 ceph-mon2 ceph-mon<span class="o">[</span>3434060<span class="o">]</span>: 2023-05-30T15:31:15.057+0800 7f3d9ff07700 -1 mon.ceph-node2@-1<span class="o">(</span>probing<span class="o">)</span> e0 handle_auth_bad_method hmm, they didn<span class="s1">&#39;t like 2 result (13) Permission denied
</span></span></span><span class="line"><span class="cl"><span class="s1">May 30 15:31:30 ceph-mon2 ceph-mon[3434060]: 2023-05-30T15:31:30.073+0800 7f3d9ff07700 -1 mon.ceph-node2@-1(probing) e0 handle_auth_bad_method hmm, they didn&#39;</span>t like <span class="m">2</span> result <span class="o">(</span>13<span class="o">)</span> Permission denied
</span></span><span class="line"><span class="cl">May <span class="m">30</span> 15:31:45 ceph-mon2 ceph-mon<span class="o">[</span>3434060<span class="o">]</span>: 2023-05-30T15:31:45.090+0800 7f3d9ff07700 -1 mon.ceph-node2@-1<span class="o">(</span>probing<span class="o">)</span> e0 handle_auth_bad_method hmm, they didn<span class="err">&#39;</span>t like <span class="m">2</span> result <span class="o">(</span>13<span class="o">)</span> Permission denied</span></span></code></pre></div><div class="highlight" id="id-58"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">May <span class="m">31</span> 11:20:25 ceph-mon2 systemd<span class="o">[</span>1<span class="o">]</span>: Started Ceph cluster monitor daemon.
</span></span><span class="line"><span class="cl">May <span class="m">31</span> 11:20:26 ceph-mon2 ceph-mon<span class="o">[</span>2463379<span class="o">]</span>: 2023-05-31T11:20:26.133+0800 7f2df3583700 -1  Processor -- <span class="nb">bind</span> unable to <span class="nb">bind</span> to v2:10.1.0.40:3300/0: <span class="o">(</span>98<span class="o">)</span> Address already in use
</span></span><span class="line"><span class="cl">May <span class="m">31</span> 11:20:26 ceph-mon2 ceph-mon<span class="o">[</span>2463379<span class="o">]</span>: 2023-05-31T11:20:26.133+0800 7f2df3583700 -1  Processor -- <span class="nb">bind</span> was unable to bind. Trying again in <span class="m">5</span> seconds
</span></span><span class="line"><span class="cl">May <span class="m">31</span> 11:20:31 ceph-mon2 ceph-mon<span class="o">[</span>2463379<span class="o">]</span>: 2023-05-31T11:20:31.133+0800 7f2df3583700 -1  Processor -- <span class="nb">bind</span> unable to <span class="nb">bind</span> to v2:10.1.0.40:3300/0: <span class="o">(</span>98<span class="o">)</span> Address already in use
</span></span><span class="line"><span class="cl">May <span class="m">31</span> 11:20:31 ceph-mon2 ceph-mon<span class="o">[</span>2463379<span class="o">]</span>: 2023-05-31T11:20:31.133+0800 7f2df3583700 -1  Processor -- <span class="nb">bind</span> was unable to bind. Trying again in <span class="m">5</span> seconds</span></span></code></pre></div><p>解决方法：</p>
<div class="highlight" id="id-59"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#删除相同的服务</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">root@ceph-mon2<span class="o">[</span>15:32:07<span class="o">]</span>/etc/systemd/system/ceph-mon.target.wants <span class="c1">#:ls</span>
</span></span><span class="line"><span class="cl">ceph-mon@ceph-mon2.service  ceph-mon@ceph-node2.service.bak
</span></span><span class="line"><span class="cl">root@ceph-mon2<span class="o">[</span>15:31:21<span class="o">]</span>/etc/systemd/system/ceph-mon.target.wants <span class="c1">#:mv ceph-mon@ceph-node2.service ceph-mon@ceph-node2.service.bak</span>
</span></span><span class="line"><span class="cl">root@ceph-mon2<span class="o">[</span>15:31:44<span class="o">]</span>/etc/systemd/system/ceph-mon.target.wants <span class="c1">#:systemctl disable ceph-mon@ceph-node2.service </span>
</span></span><span class="line"><span class="cl">root@ceph-mon2<span class="o">[</span>15:31:49<span class="o">]</span>/etc/systemd/system/ceph-mon.target.wants <span class="c1">#:systemctl stop ceph-mon@ceph-node2.service </span></span></span></code></pre></div><p><strong>问题</strong>：</p>
<p>health: HEALTH_WARN</p>
<p>​           <code> clock skew detected on mon.ceph-mon2, mon.ceph-mon3</code></p>
<p>由于集群之间时间不同步导致，ceph严格要求时间同步</p>
<h3 id="62-扩展ceph-mgr-节点">6.2 扩展Ceph-Mgr 节点</h3>
<div class="highlight" id="id-60"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#在mgr主机安装mgr</span>
</span></span><span class="line"><span class="cl">apt install ceph-mgr -y
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 同步配 置文件到ceph-mg2 节点</span>
</span></span><span class="line"><span class="cl">ceph-deploy admin ceph-mgr2
</span></span><span class="line"><span class="cl">ceph-deploy mgr create ceph-mgr2</span></span></code></pre></div><p><img loading="lazy" src="http://cdn1.ryanxin.live/1685341057072-8c8cc7f4-f1ea-431d-981f-7fa5c95a4d59.png" srcset="http://cdn1.ryanxin.live/1685341057072-8c8cc7f4-f1ea-431d-981f-7fa5c95a4d59.png, http://cdn1.ryanxin.live/1685341057072-8c8cc7f4-f1ea-431d-981f-7fa5c95a4d59.png 1.5x, http://cdn1.ryanxin.live/1685341057072-8c8cc7f4-f1ea-431d-981f-7fa5c95a4d59.png 2x" sizes="auto" data-title="http://cdn1.ryanxin.live/1685341057072-8c8cc7f4-f1ea-431d-981f-7fa5c95a4d59.png" data-alt="http://cdn1.ryanxin.live/1685341057072-8c8cc7f4-f1ea-431d-981f-7fa5c95a4d59.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
</div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="更新于 2023-05-31 00:00:00">更新于 2023-05-31&nbsp;</span>
      </div><div class="post-info-license">
          <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>
        </div></div>
    <div class="post-info-line">
      <div class="post-info-md"><span><a href="/posts/ceph/2.ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/index.md" title="阅读原始文档" class="link-to-markdown">阅读原始文档</a></span></div>
      <div class="post-info-share">
        <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://hg-xnlog.github.io/posts/ceph/2.ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/" data-title="Ceph 集群部署 （二）" data-hashtags="分布式存储"><i class="fa-brands fa-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://hg-xnlog.github.io/posts/ceph/2.ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/" data-hashtag="分布式存储"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 WhatsApp" data-sharer="whatsapp" data-url="https://hg-xnlog.github.io/posts/ceph/2.ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/" data-title="Ceph 集群部署 （二）" data-web><i class="fa-brands fa-whatsapp fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://hg-xnlog.github.io/posts/ceph/2.ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/" data-title="Ceph 集群部署 （二）"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://hg-xnlog.github.io/posts/ceph/2.ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/" data-title="Ceph 集群部署 （二）"><i class="fa-brands fa-weibo fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Myspace" data-sharer="myspace" data-url="https://hg-xnlog.github.io/posts/ceph/2.ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/" data-title="Ceph 集群部署 （二）" data-description=""><i data-svg-src="/lib/simple-icons/icons/myspace.min.svg" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Blogger" data-sharer="blogger" data-url="https://hg-xnlog.github.io/posts/ceph/2.ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/" data-title="Ceph 集群部署 （二）" data-description=""><i class="fa-brands fa-blogger fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Evernote" data-sharer="evernote" data-url="https://hg-xnlog.github.io/posts/ceph/2.ceph%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/" data-title="Ceph 集群部署 （二）"><i class="fa-brands fa-evernote fa-fw" aria-hidden="true"></i></a>
  </span>
      </div>
    </div>
  </div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/' class="post-tag">分布式存储</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/kubernetes/primary/kubernetes-1/" class="post-nav-item" rel="prev" title="Kubernetes 二进制部署 (一)"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>Kubernetes 二进制部署 (一)</a>
      <a href="/posts/ceph/3.ceph-fs%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8/" class="post-nav-item" rel="next" title="Ceph 集群维护 （三）">Ceph 集群维护 （三）<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></main><footer class="footer">
    <div class="footer-container"><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2021 - 2023</span><span class="author" itemprop="copyrightHolder">
              <a href="https://github.com/ryanxin7"target="_blank" rel="external nofollow noopener noreferrer">Ryan</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div><div class="footer-line statistics"><span class="site-time" title='网站运行中……'><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden="true"></i><span class="run-times ms-1">网站运行中……</span></span></div><div class="footer-line visitor">
          <span id="busuanzi_container_site_uv" title='总访客数'><i class="fa-regular fa-user fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='总访问量'><i class="fa-regular fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><a href="https://github.com/ryanxin7" title="在 GitHub 上查看源代码"target="_blank" rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><div id="mask"></div><noscript>
    <div class="noscript-warning">FixIt 主题在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/algoliasearch/algoliasearch-lite.umd.min.js" defer></script><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async defer></script><script src="/lib/pace/pace.min.js" async defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","editLockTitle":"锁定可编辑代码块","editUnLockTitle":"解锁可编辑代码块","editable":true,"maxShownLines":10},"comment":{"enable":false},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验。"},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"enablePWA":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"HFAFNY4NX2","algoliaIndex":"xn-log","algoliaSearchKey":"bd08388586b2f88b20753c17c60ba92f","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"siteTime":"2021-09-09T09:09:09+09:00"};</script><script src="/js/theme.min.js" defer></script></body>
</html>
